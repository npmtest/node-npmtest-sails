{"/home/travis/build/npmtest/node-npmtest-sails/test.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/test.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":1,"12":1,"13":1,"14":1,"15":2,"16":2,"17":2,"18":2,"19":1,"20":1,"21":2,"22":2,"23":2,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":2,"38":2,"39":1,"40":2,"41":2,"42":1,"43":2,"44":2,"45":1,"46":2,"47":2,"48":1,"49":1,"50":1,"51":1,"52":1},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[1,1],"5":[1,1],"6":[1,1],"7":[1,1],"8":[1,1],"9":[1,1,1],"10":[1,1],"11":[1,1],"12":[1,1],"13":[1,1],"14":[1,1],"15":[1,1],"16":[1,1]},"f":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":1,"7":1,"8":2,"9":2,"10":2,"11":2,"12":1},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":1},"end":{"line":12,"column":13}}},"2":{"name":"(anonymous_2)","line":19,"loc":{"start":{"line":19,"column":5},"end":{"line":19,"column":17}}},"3":{"name":"(anonymous_3)","line":23,"loc":{"start":{"line":23,"column":24},"end":{"line":23,"column":36}}},"4":{"name":"(anonymous_4)","line":61,"loc":{"start":{"line":61,"column":5},"end":{"line":61,"column":17}}},"5":{"name":"(anonymous_5)","line":82,"loc":{"start":{"line":82,"column":5},"end":{"line":82,"column":17}}},"6":{"name":"(anonymous_6)","line":102,"loc":{"start":{"line":102,"column":83},"end":{"line":105,"column":10}},"skip":true},"7":{"name":"(anonymous_7)","line":113,"loc":{"start":{"line":113,"column":77},"end":{"line":116,"column":10}},"skip":true},"8":{"name":"(anonymous_8)","line":129,"loc":{"start":{"line":129,"column":12},"end":{"line":129,"column":40}},"skip":true},"9":{"name":"(anonymous_9)","line":137,"loc":{"start":{"line":137,"column":77},"end":{"line":140,"column":10}},"skip":true},"10":{"name":"(anonymous_10)","line":148,"loc":{"start":{"line":148,"column":83},"end":{"line":151,"column":10}},"skip":true},"11":{"name":"(anonymous_11)","line":159,"loc":{"start":{"line":159,"column":79},"end":{"line":162,"column":10}},"skip":true},"12":{"name":"(anonymous_12)","line":170,"loc":{"start":{"line":170,"column":75},"end":{"line":173,"column":10}},"skip":true}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":185,"column":5}},"2":{"start":{"line":14,"column":4},"end":{"line":14,"column":14}},"3":{"start":{"line":19,"column":4},"end":{"line":56,"column":9}},"4":{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":8},"end":{"line":35,"column":13}},"6":{"start":{"line":24,"column":12},"end":{"line":34,"column":13}},"7":{"start":{"line":25,"column":16},"end":{"line":28,"column":30}},"8":{"start":{"line":30,"column":16},"end":{"line":33,"column":27}},"9":{"start":{"line":37,"column":8},"end":{"line":39,"column":21}},"10":{"start":{"line":40,"column":8},"end":{"line":53,"column":9}},"11":{"start":{"line":43,"column":12},"end":{"line":46,"column":14}},"12":{"start":{"line":47,"column":12},"end":{"line":47,"column":18}},"13":{"start":{"line":50,"column":12},"end":{"line":51,"column":46}},"14":{"start":{"line":52,"column":12},"end":{"line":52,"column":18}},"15":{"start":{"line":55,"column":8},"end":{"line":55,"column":35}},"16":{"start":{"line":61,"column":4},"end":{"line":63,"column":9}},"17":{"start":{"line":62,"column":8},"end":{"line":62,"column":15}},"18":{"start":{"line":64,"column":4},"end":{"line":77,"column":5}},"19":{"start":{"line":70,"column":8},"end":{"line":70,"column":14}},"20":{"start":{"line":76,"column":8},"end":{"line":76,"column":14}},"21":{"start":{"line":82,"column":4},"end":{"line":84,"column":9}},"22":{"start":{"line":83,"column":8},"end":{"line":83,"column":15}},"23":{"start":{"line":85,"column":4},"end":{"line":184,"column":5}},"24":{"start":{"line":92,"column":8},"end":{"line":94,"column":63}},"25":{"start":{"line":95,"column":8},"end":{"line":95,"column":14}},"26":{"start":{"line":102,"column":8},"end":{"line":111,"column":10},"skip":true},"27":{"start":{"line":109,"column":12},"end":{"line":109,"column":55},"skip":true},"28":{"start":{"line":110,"column":12},"end":{"line":110,"column":48},"skip":true},"29":{"start":{"line":113,"column":8},"end":{"line":126,"column":10},"skip":true},"30":{"start":{"line":120,"column":12},"end":{"line":120,"column":76},"skip":true},"31":{"start":{"line":121,"column":12},"end":{"line":121,"column":73},"skip":true},"32":{"start":{"line":122,"column":12},"end":{"line":122,"column":74},"skip":true},"33":{"start":{"line":123,"column":12},"end":{"line":123,"column":79},"skip":true},"34":{"start":{"line":124,"column":12},"end":{"line":124,"column":25},"skip":true},"35":{"start":{"line":125,"column":12},"end":{"line":125,"column":45},"skip":true},"36":{"start":{"line":128,"column":8},"end":{"line":135,"column":14},"skip":true},"37":{"start":{"line":133,"column":16},"end":{"line":133,"column":29},"skip":true},"38":{"start":{"line":134,"column":16},"end":{"line":134,"column":55},"skip":true},"39":{"start":{"line":137,"column":8},"end":{"line":146,"column":10},"skip":true},"40":{"start":{"line":144,"column":12},"end":{"line":144,"column":25},"skip":true},"41":{"start":{"line":145,"column":12},"end":{"line":145,"column":45},"skip":true},"42":{"start":{"line":148,"column":8},"end":{"line":157,"column":10},"skip":true},"43":{"start":{"line":155,"column":12},"end":{"line":155,"column":25},"skip":true},"44":{"start":{"line":156,"column":12},"end":{"line":156,"column":48},"skip":true},"45":{"start":{"line":159,"column":8},"end":{"line":168,"column":10},"skip":true},"46":{"start":{"line":166,"column":12},"end":{"line":166,"column":25},"skip":true},"47":{"start":{"line":167,"column":12},"end":{"line":167,"column":46},"skip":true},"48":{"start":{"line":170,"column":8},"end":{"line":179,"column":10},"skip":true},"49":{"start":{"line":177,"column":12},"end":{"line":177,"column":94},"skip":true},"50":{"start":{"line":178,"column":12},"end":{"line":178,"column":48},"skip":true},"51":{"start":{"line":182,"column":8},"end":{"line":182,"column":35},"skip":true},"52":{"start":{"line":183,"column":8},"end":{"line":183,"column":14},"skip":true}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":62}},{"start":{"line":26,"column":20},"end":{"line":26,"column":70}},{"start":{"line":27,"column":20},"end":{"line":27,"column":71}},{"start":{"line":28,"column":20},"end":{"line":28,"column":29}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":23},"end":{"line":30,"column":37}},{"start":{"line":31,"column":20},"end":{"line":31,"column":61}},{"start":{"line":32,"column":20},"end":{"line":32,"column":70}},{"start":{"line":33,"column":20},"end":{"line":33,"column":26}}]},"3":{"line":37,"type":"cond-expr","locations":[{"start":{"line":38,"column":14},"end":{"line":38,"column":20}},{"start":{"line":39,"column":14},"end":{"line":39,"column":20}}]},"4":{"line":40,"type":"switch","locations":[{"start":{"line":42,"column":8},"end":{"line":47,"column":18}},{"start":{"line":49,"column":8},"end":{"line":52,"column":18}}]},"5":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":16},"end":{"line":44,"column":44}},{"start":{"line":44,"column":48},"end":{"line":44,"column":66}}]},"6":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":21},"end":{"line":50,"column":49}},{"start":{"line":50,"column":53},"end":{"line":50,"column":72}}]},"7":{"line":64,"type":"switch","locations":[{"start":{"line":69,"column":4},"end":{"line":70,"column":14}},{"start":{"line":75,"column":4},"end":{"line":76,"column":14}}]},"8":{"line":85,"type":"switch","locations":[{"start":{"line":90,"column":4},"end":{"line":95,"column":14}},{"start":{"line":101,"column":4},"end":{"line":183,"column":14},"skip":true}]},"9":{"line":92,"type":"binary-expr","locations":[{"start":{"line":92,"column":18},"end":{"line":92,"column":32}},{"start":{"line":93,"column":12},"end":{"line":93,"column":53}},{"start":{"line":94,"column":12},"end":{"line":94,"column":61}}]},"10":{"line":102,"type":"binary-expr","locations":[{"start":{"line":102,"column":45},"end":{"line":102,"column":79},"skip":true},{"start":{"line":102,"column":83},"end":{"line":111,"column":9},"skip":true}]},"11":{"line":113,"type":"binary-expr","locations":[{"start":{"line":113,"column":42},"end":{"line":113,"column":73},"skip":true},{"start":{"line":113,"column":77},"end":{"line":126,"column":9},"skip":true}]},"12":{"line":128,"type":"binary-expr","locations":[{"start":{"line":128,"column":48},"end":{"line":128,"column":85},"skip":true},{"start":{"line":129,"column":12},"end":{"line":135,"column":13},"skip":true}]},"13":{"line":137,"type":"binary-expr","locations":[{"start":{"line":137,"column":42},"end":{"line":137,"column":73},"skip":true},{"start":{"line":137,"column":77},"end":{"line":146,"column":9},"skip":true}]},"14":{"line":148,"type":"binary-expr","locations":[{"start":{"line":148,"column":45},"end":{"line":148,"column":79},"skip":true},{"start":{"line":148,"column":83},"end":{"line":157,"column":9},"skip":true}]},"15":{"line":159,"type":"binary-expr","locations":[{"start":{"line":159,"column":43},"end":{"line":159,"column":75},"skip":true},{"start":{"line":159,"column":79},"end":{"line":168,"column":9},"skip":true}]},"16":{"line":170,"type":"binary-expr","locations":[{"start":{"line":170,"column":41},"end":{"line":170,"column":71},"skip":true},{"start":{"line":170,"column":75},"end":{"line":179,"column":9},"skip":true}]}},"code":["/* istanbul instrument in package npmtest_sails */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - pre-init","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        switch (local.modeJs) {","        // re-init local from window.local","        case 'browser':","            local = local.global.utility2.objectSetDefault(","                local.global.utility2_rollup || local.global.local,","                local.global.utility2","            );","            break;","        // re-init local from example.js","        case 'node':","            local = (local.global.utility2_rollup || require('utility2'))","                .requireExampleJsFromReadme();","            break;","        }","        // export local","        local.global.local = local;","    }());","","","","    // run shared js-env code - function","    (function () {","        return;","    }());","    switch (local.modeJs) {","","","","    // run browser js-env code - function","    case 'browser':","        break;","","","","    // run node js-env code - function","    case 'node':","        break;","    }","","","","    // run shared js-env code - post-init","    (function () {","        return;","    }());","    switch (local.modeJs) {","","","","    // run browser js-env code - post-init","    case 'browser':","        // run tests","        local.nop(local.modeTest &&","            document.querySelector('#testRunButton1') &&","            document.querySelector('#testRunButton1').click());","        break;","","","","    // run node js-env code - post-init","    /* istanbul ignore next */","    case 'node':","        local.testCase_buildApidoc_default = local.testCase_buildApidoc_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildApidoc's default handling-behavior-behavior","         */","            options = { modulePathList: module.paths };","            local.buildApidoc(options, onError);","        };","","        local.testCase_buildApp_default = local.testCase_buildApp_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildApp's default handling-behavior-behavior","         */","            local.testCase_buildReadme_default(options, local.onErrorThrow);","            local.testCase_buildLib_default(options, local.onErrorThrow);","            local.testCase_buildTest_default(options, local.onErrorThrow);","            local.testCase_buildCustomOrg_default(options, local.onErrorThrow);","            options = [];","            local.buildApp(options, onError);","        };","","        local.testCase_buildCustomOrg_default = local.testCase_buildCustomOrg_default ||","            function (options, onError) {","            /*","             * this function will test buildCustomOrg's default handling-behavior","             */","                options = {};","                local.buildCustomOrg(options, onError);","            };","","        local.testCase_buildLib_default = local.testCase_buildLib_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildLib's default handling-behavior","         */","            options = {};","            local.buildLib(options, onError);","        };","","        local.testCase_buildReadme_default = local.testCase_buildReadme_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildReadme's default handling-behavior-behavior","         */","            options = {};","            local.buildReadme(options, onError);","        };","","        local.testCase_buildTest_default = local.testCase_buildTest_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildTest's default handling-behavior","         */","            options = {};","            local.buildTest(options, onError);","        };","","        local.testCase_webpage_default = local.testCase_webpage_default || function (","            options,","            onError","        ) {","        /*","         * this function will test webpage's default handling-behavior","         */","            options = { modeCoverageMerge: true, url: local.serverLocalHost + '?modeTest=1' };","            local.browserTest(options, onError);","        };","","        // run test-server","        local.testRunServer(local);","        break;","    }","}());",""],"l":{"12":2,"14":2,"19":2,"21":2,"23":2,"24":2,"25":2,"30":1,"37":2,"40":2,"43":1,"47":1,"50":1,"52":1,"55":2,"61":2,"62":2,"64":2,"70":1,"76":1,"82":2,"83":2,"85":2,"92":1,"95":1,"102":1,"109":1,"110":1,"113":1,"120":1,"121":1,"122":1,"123":1,"124":1,"125":1,"128":1,"133":2,"134":2,"137":1,"144":2,"145":2,"148":1,"155":2,"156":2,"159":1,"166":2,"167":2,"170":1,"177":1,"178":1,"182":1,"183":1}},"/home/travis/build/npmtest/node-npmtest-sails/lib.npmtest_sails.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/lib.npmtest_sails.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1,"14":1,"15":1,"16":1},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[2,2],"5":[1,1]},"f":{"1":2,"2":2,"3":2},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":1},"end":{"line":12,"column":13}}},"2":{"name":"(anonymous_2)","line":19,"loc":{"start":{"line":19,"column":5},"end":{"line":19,"column":17}}},"3":{"name":"(anonymous_3)","line":23,"loc":{"start":{"line":23,"column":24},"end":{"line":23,"column":36}}}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":53,"column":5}},"2":{"start":{"line":14,"column":4},"end":{"line":14,"column":14}},"3":{"start":{"line":19,"column":4},"end":{"line":52,"column":9}},"4":{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":8},"end":{"line":35,"column":13}},"6":{"start":{"line":24,"column":12},"end":{"line":34,"column":13}},"7":{"start":{"line":25,"column":16},"end":{"line":28,"column":30}},"8":{"start":{"line":30,"column":16},"end":{"line":33,"column":27}},"9":{"start":{"line":37,"column":8},"end":{"line":39,"column":21}},"10":{"start":{"line":41,"column":8},"end":{"line":41,"column":54}},"11":{"start":{"line":43,"column":8},"end":{"line":43,"column":50}},"12":{"start":{"line":45,"column":8},"end":{"line":51,"column":9}},"13":{"start":{"line":46,"column":12},"end":{"line":46,"column":56}},"14":{"start":{"line":48,"column":12},"end":{"line":48,"column":35}},"15":{"start":{"line":49,"column":12},"end":{"line":49,"column":49}},"16":{"start":{"line":50,"column":12},"end":{"line":50,"column":43}}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":62}},{"start":{"line":26,"column":20},"end":{"line":26,"column":70}},{"start":{"line":27,"column":20},"end":{"line":27,"column":71}},{"start":{"line":28,"column":20},"end":{"line":28,"column":29}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":23},"end":{"line":30,"column":37}},{"start":{"line":31,"column":20},"end":{"line":31,"column":61}},{"start":{"line":32,"column":20},"end":{"line":32,"column":70}},{"start":{"line":33,"column":20},"end":{"line":33,"column":26}}]},"3":{"line":37,"type":"cond-expr","locations":[{"start":{"line":38,"column":14},"end":{"line":38,"column":20}},{"start":{"line":39,"column":14},"end":{"line":39,"column":20}}]},"4":{"line":41,"type":"binary-expr","locations":[{"start":{"line":41,"column":16},"end":{"line":41,"column":44}},{"start":{"line":41,"column":48},"end":{"line":41,"column":53}}]},"5":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":45,"column":8}},{"start":{"line":45,"column":8},"end":{"line":45,"column":8}}]}},"code":["/* istanbul instrument in package npmtest_sails */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - pre-init","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        // init utility2_rollup","        local = local.global.utility2_rollup || local;","        // init lib","        local.local = local.npmtest_sails = local;","        // init exports","        if (local.modeJs === 'browser') {","            local.global.utility2_npmtest_sails = local;","        } else {","            module.exports = local;","            module.exports.__dirname = __dirname;","            module.exports.module = module;","        }","    }());","}());",""],"l":{"12":2,"14":2,"19":2,"21":2,"23":2,"24":2,"25":2,"30":1,"37":2,"41":2,"43":2,"45":2,"46":1,"48":1,"49":1,"50":1}},"/home/travis/build/npmtest/node-npmtest-sails/example.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/example.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1,"14":2,"15":2,"16":2,"17":2,"18":2,"19":0,"20":2,"21":1,"22":1,"23":1,"24":1,"25":1,"26":0,"27":0,"28":1,"29":1,"30":2,"31":0,"32":0,"33":0,"34":1,"35":2,"36":2,"37":2,"38":2,"39":2,"40":2,"41":0,"42":2,"43":2,"44":2,"45":1,"46":3,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":0,"58":1,"59":6,"60":6,"61":1,"62":2,"63":0,"64":2,"65":1,"66":1,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[2,2],"5":[1,1],"6":[1,1],"7":[2,0],"8":[2,1,1,1,1,1],"9":[0,2,0],"10":[1,1],"11":[2,1,1],"12":[1,0],"13":[0,2],"14":[2,0,0,0,0,0,0],"15":[0,2],"16":[2,0],"17":[1,1],"18":[0,1],"19":[1,2,0,2],"20":[1,0],"21":[1,1],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0]},"f":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":2,"9":3,"10":1,"11":6,"12":0},"fnMap":{"1":{"name":"(anonymous_1)","line":26,"loc":{"start":{"line":26,"column":1},"end":{"line":26,"column":13}}},"2":{"name":"(anonymous_2)","line":33,"loc":{"start":{"line":33,"column":5},"end":{"line":33,"column":17}}},"3":{"name":"(anonymous_3)","line":37,"loc":{"start":{"line":37,"column":24},"end":{"line":37,"column":36}}},"4":{"name":"(anonymous_4)","line":69,"loc":{"start":{"line":69,"column":31},"end":{"line":69,"column":48}},"skip":true},"5":{"name":"(anonymous_5)","line":78,"loc":{"start":{"line":78,"column":26},"end":{"line":78,"column":45}},"skip":true},"6":{"name":"(anonymous_6)","line":123,"loc":{"start":{"line":123,"column":33},"end":{"line":123,"column":48}},"skip":true},"7":{"name":"(anonymous_7)","line":125,"loc":{"start":{"line":125,"column":27},"end":{"line":125,"column":39}},"skip":true},"8":{"name":"(anonymous_8)","line":133,"loc":{"start":{"line":133,"column":59},"end":{"line":133,"column":74}},"skip":true},"9":{"name":"(anonymous_9)","line":143,"loc":{"start":{"line":143,"column":45},"end":{"line":143,"column":62}},"skip":true},"10":{"name":"(anonymous_10)","line":144,"loc":{"start":{"line":144,"column":73},"end":{"line":144,"column":92}},"skip":true},"11":{"name":"(anonymous_11)","line":272,"loc":{"start":{"line":272,"column":51},"end":{"line":272,"column":77}},"skip":true},"12":{"name":"(anonymous_12)","line":314,"loc":{"start":{"line":314,"column":32},"end":{"line":314,"column":61}},"skip":true}},"statementMap":{"1":{"start":{"line":26,"column":0},"end":{"line":325,"column":5}},"2":{"start":{"line":28,"column":4},"end":{"line":28,"column":14}},"3":{"start":{"line":33,"column":4},"end":{"line":60,"column":9}},"4":{"start":{"line":35,"column":8},"end":{"line":35,"column":19}},"5":{"start":{"line":37,"column":8},"end":{"line":49,"column":13}},"6":{"start":{"line":38,"column":12},"end":{"line":48,"column":13}},"7":{"start":{"line":39,"column":16},"end":{"line":42,"column":30}},"8":{"start":{"line":44,"column":16},"end":{"line":47,"column":27}},"9":{"start":{"line":51,"column":8},"end":{"line":53,"column":21}},"10":{"start":{"line":55,"column":8},"end":{"line":57,"column":45}},"11":{"start":{"line":59,"column":8},"end":{"line":59,"column":35}},"12":{"start":{"line":61,"column":4},"end":{"line":324,"column":5}},"13":{"start":{"line":69,"column":8},"end":{"line":121,"column":10},"skip":true},"14":{"start":{"line":70,"column":12},"end":{"line":88,"column":13},"skip":true},"15":{"start":{"line":76,"column":16},"end":{"line":87,"column":19},"skip":true},"16":{"start":{"line":79,"column":20},"end":{"line":86,"column":21},"skip":true},"17":{"start":{"line":82,"column":24},"end":{"line":82,"column":43},"skip":true},"18":{"start":{"line":83,"column":24},"end":{"line":83,"column":30},"skip":true},"19":{"start":{"line":85,"column":24},"end":{"line":85,"column":49},"skip":true},"20":{"start":{"line":89,"column":12},"end":{"line":107,"column":13},"skip":true},"21":{"start":{"line":92,"column":16},"end":{"line":102,"column":17},"skip":true},"22":{"start":{"line":93,"column":20},"end":{"line":93,"column":86},"skip":true},"23":{"start":{"line":94,"column":20},"end":{"line":95,"column":45},"skip":true},"24":{"start":{"line":96,"column":20},"end":{"line":96,"column":42},"skip":true},"25":{"start":{"line":97,"column":20},"end":{"line":97,"column":48},"skip":true},"26":{"start":{"line":100,"column":20},"end":{"line":100,"column":85},"skip":true},"27":{"start":{"line":101,"column":20},"end":{"line":101,"column":96},"skip":true},"28":{"start":{"line":103,"column":16},"end":{"line":103,"column":22},"skip":true},"29":{"start":{"line":106,"column":16},"end":{"line":106,"column":22},"skip":true},"30":{"start":{"line":108,"column":12},"end":{"line":120,"column":13},"skip":true},"31":{"start":{"line":114,"column":16},"end":{"line":119,"column":17},"skip":true},"32":{"start":{"line":116,"column":20},"end":{"line":116,"column":78},"skip":true},"33":{"start":{"line":118,"column":20},"end":{"line":118,"column":47},"skip":true},"34":{"start":{"line":123,"column":8},"end":{"line":141,"column":11},"skip":true},"35":{"start":{"line":124,"column":12},"end":{"line":124,"column":54},"skip":true},"36":{"start":{"line":125,"column":12},"end":{"line":140,"column":14},"skip":true},"37":{"start":{"line":126,"column":16},"end":{"line":126,"column":28},"skip":true},"38":{"start":{"line":127,"column":16},"end":{"line":127,"column":69},"skip":true},"39":{"start":{"line":128,"column":16},"end":{"line":128,"column":75},"skip":true},"40":{"start":{"line":129,"column":16},"end":{"line":131,"column":17},"skip":true},"41":{"start":{"line":130,"column":20},"end":{"line":130,"column":27},"skip":true},"42":{"start":{"line":133,"column":16},"end":{"line":137,"column":36},"skip":true},"43":{"start":{"line":134,"column":20},"end":{"line":136,"column":55},"skip":true},"44":{"start":{"line":139,"column":16},"end":{"line":139,"column":57},"skip":true},"45":{"start":{"line":143,"column":8},"end":{"line":147,"column":11},"skip":true},"46":{"start":{"line":144,"column":12},"end":{"line":146,"column":15},"skip":true},"47":{"start":{"line":145,"column":16},"end":{"line":145,"column":70},"skip":true},"48":{"start":{"line":149,"column":8},"end":{"line":149,"column":31},"skip":true},"49":{"start":{"line":150,"column":8},"end":{"line":150,"column":14},"skip":true},"50":{"start":{"line":158,"column":8},"end":{"line":158,"column":31},"skip":true},"51":{"start":{"line":160,"column":8},"end":{"line":160,"column":33},"skip":true},"52":{"start":{"line":161,"column":8},"end":{"line":161,"column":37},"skip":true},"53":{"start":{"line":162,"column":8},"end":{"line":162,"column":35},"skip":true},"54":{"start":{"line":164,"column":8},"end":{"line":164,"column":50},"skip":true},"55":{"start":{"line":166,"column":8},"end":{"line":256,"column":2},"skip":true},"56":{"start":{"line":258,"column":8},"end":{"line":286,"column":9},"skip":true},"57":{"start":{"line":259,"column":12},"end":{"line":269,"column":14},"skip":true},"58":{"start":{"line":271,"column":12},"end":{"line":285,"column":19},"skip":true},"59":{"start":{"line":274,"column":20},"end":{"line":274,"column":35},"skip":true},"60":{"start":{"line":275,"column":20},"end":{"line":284,"column":21},"skip":true},"61":{"start":{"line":277,"column":24},"end":{"line":277,"column":64},"skip":true},"62":{"start":{"line":279,"column":24},"end":{"line":279,"column":40},"skip":true},"63":{"start":{"line":281,"column":24},"end":{"line":281,"column":40},"skip":true},"64":{"start":{"line":283,"column":24},"end":{"line":283,"column":39},"skip":true},"65":{"start":{"line":288,"column":8},"end":{"line":290,"column":9},"skip":true},"66":{"start":{"line":289,"column":12},"end":{"line":289,"column":18},"skip":true},"67":{"start":{"line":291,"column":8},"end":{"line":293,"column":54},"skip":true},"68":{"start":{"line":294,"column":8},"end":{"line":301,"column":37},"skip":true},"69":{"start":{"line":302,"column":8},"end":{"line":302,"column":82},"skip":true},"70":{"start":{"line":305,"column":8},"end":{"line":307,"column":9},"skip":true},"71":{"start":{"line":306,"column":12},"end":{"line":306,"column":82},"skip":true},"72":{"start":{"line":309,"column":8},"end":{"line":311,"column":9},"skip":true},"73":{"start":{"line":310,"column":12},"end":{"line":310,"column":18},"skip":true},"74":{"start":{"line":312,"column":8},"end":{"line":312,"column":54},"skip":true},"75":{"start":{"line":313,"column":8},"end":{"line":313,"column":69},"skip":true},"76":{"start":{"line":314,"column":8},"end":{"line":322,"column":36},"skip":true},"77":{"start":{"line":315,"column":12},"end":{"line":315,"column":61},"skip":true},"78":{"start":{"line":316,"column":12},"end":{"line":319,"column":13},"skip":true},"79":{"start":{"line":317,"column":16},"end":{"line":317,"column":75},"skip":true},"80":{"start":{"line":318,"column":16},"end":{"line":318,"column":23},"skip":true},"81":{"start":{"line":320,"column":12},"end":{"line":320,"column":38},"skip":true},"82":{"start":{"line":321,"column":12},"end":{"line":321,"column":27},"skip":true},"83":{"start":{"line":323,"column":8},"end":{"line":323,"column":14},"skip":true}},"branchMap":{"1":{"line":39,"type":"binary-expr","locations":[{"start":{"line":39,"column":23},"end":{"line":39,"column":62}},{"start":{"line":40,"column":20},"end":{"line":40,"column":70}},{"start":{"line":41,"column":20},"end":{"line":41,"column":71}},{"start":{"line":42,"column":20},"end":{"line":42,"column":29}}]},"2":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":23},"end":{"line":44,"column":37}},{"start":{"line":45,"column":20},"end":{"line":45,"column":61}},{"start":{"line":46,"column":20},"end":{"line":46,"column":70}},{"start":{"line":47,"column":20},"end":{"line":47,"column":26}}]},"3":{"line":51,"type":"cond-expr","locations":[{"start":{"line":52,"column":14},"end":{"line":52,"column":20}},{"start":{"line":53,"column":14},"end":{"line":53,"column":20}}]},"4":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":16},"end":{"line":55,"column":44}},{"start":{"line":55,"column":49},"end":{"line":57,"column":43}}]},"5":{"line":55,"type":"cond-expr","locations":[{"start":{"line":56,"column":14},"end":{"line":56,"column":49}},{"start":{"line":57,"column":14},"end":{"line":57,"column":43}}]},"6":{"line":61,"type":"switch","locations":[{"start":{"line":68,"column":4},"end":{"line":150,"column":14},"skip":true},{"start":{"line":156,"column":4},"end":{"line":323,"column":14},"skip":true}]},"7":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":12},"end":{"line":70,"column":12},"skip":true},{"start":{"line":70,"column":12},"end":{"line":70,"column":12},"skip":true}]},"8":{"line":70,"type":"binary-expr","locations":[{"start":{"line":70,"column":16},"end":{"line":70,"column":22},"skip":true},{"start":{"line":70,"column":27},"end":{"line":70,"column":32},"skip":true},{"start":{"line":71,"column":20},"end":{"line":71,"column":39},"skip":true},{"start":{"line":72,"column":20},"end":{"line":72,"column":49},"skip":true},{"start":{"line":73,"column":20},"end":{"line":73,"column":58},"skip":true},{"start":{"line":74,"column":20},"end":{"line":74,"column":69},"skip":true}]},"9":{"line":79,"type":"switch","locations":[{"start":{"line":80,"column":20},"end":{"line":80,"column":33},"skip":true},{"start":{"line":81,"column":20},"end":{"line":83,"column":30},"skip":true},{"start":{"line":84,"column":20},"end":{"line":85,"column":49},"skip":true}]},"10":{"line":89,"type":"switch","locations":[{"start":{"line":90,"column":12},"end":{"line":103,"column":22},"skip":true},{"start":{"line":105,"column":12},"end":{"line":106,"column":22},"skip":true}]},"11":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":20},"end":{"line":89,"column":25},"skip":true},{"start":{"line":89,"column":29},"end":{"line":89,"column":48},"skip":true},{"start":{"line":89,"column":52},"end":{"line":89,"column":74},"skip":true}]},"12":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":16},"end":{"line":92,"column":16},"skip":true},{"start":{"line":92,"column":16},"end":{"line":92,"column":16},"skip":true}]},"13":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":12},"end":{"line":108,"column":12},"skip":true},{"start":{"line":108,"column":12},"end":{"line":108,"column":12},"skip":true}]},"14":{"line":108,"type":"binary-expr","locations":[{"start":{"line":108,"column":16},"end":{"line":108,"column":61},"skip":true},{"start":{"line":108,"column":66},"end":{"line":108,"column":72},"skip":true},{"start":{"line":108,"column":77},"end":{"line":108,"column":82},"skip":true},{"start":{"line":109,"column":20},"end":{"line":109,"column":39},"skip":true},{"start":{"line":110,"column":20},"end":{"line":110,"column":49},"skip":true},{"start":{"line":111,"column":20},"end":{"line":111,"column":58},"skip":true},{"start":{"line":112,"column":20},"end":{"line":112,"column":68},"skip":true}]},"15":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":16},"end":{"line":129,"column":16},"skip":true},{"start":{"line":129,"column":16},"end":{"line":129,"column":16},"skip":true}]},"16":{"line":134,"type":"cond-expr","locations":[{"start":{"line":135,"column":26},"end":{"line":135,"column":29},"skip":true},{"start":{"line":136,"column":26},"end":{"line":136,"column":54},"skip":true}]},"17":{"line":164,"type":"binary-expr","locations":[{"start":{"line":164,"column":27},"end":{"line":164,"column":43},"skip":true},{"start":{"line":164,"column":47},"end":{"line":164,"column":49},"skip":true}]},"18":{"line":258,"type":"if","locations":[{"start":{"line":258,"column":8},"end":{"line":258,"column":8},"skip":true},{"start":{"line":258,"column":8},"end":{"line":258,"column":8},"skip":true}]},"19":{"line":275,"type":"switch","locations":[{"start":{"line":276,"column":20},"end":{"line":277,"column":64},"skip":true},{"start":{"line":278,"column":20},"end":{"line":279,"column":40},"skip":true},{"start":{"line":280,"column":20},"end":{"line":281,"column":40},"skip":true},{"start":{"line":282,"column":20},"end":{"line":283,"column":39},"skip":true}]},"20":{"line":288,"type":"if","locations":[{"start":{"line":288,"column":8},"end":{"line":288,"column":8},"skip":true},{"start":{"line":288,"column":8},"end":{"line":288,"column":8},"skip":true}]},"21":{"line":288,"type":"binary-expr","locations":[{"start":{"line":288,"column":12},"end":{"line":288,"column":40},"skip":true},{"start":{"line":288,"column":44},"end":{"line":288,"column":67},"skip":true}]},"22":{"line":292,"type":"binary-expr","locations":[{"start":{"line":292,"column":12},"end":{"line":292,"column":50},"skip":true},{"start":{"line":293,"column":12},"end":{"line":293,"column":53},"skip":true}]},"23":{"line":295,"type":"binary-expr","locations":[{"start":{"line":295,"column":12},"end":{"line":295,"column":63},"skip":true},{"start":{"line":296,"column":12},"end":{"line":301,"column":36},"skip":true}]},"24":{"line":302,"type":"binary-expr","locations":[{"start":{"line":302,"column":43},"end":{"line":302,"column":75},"skip":true},{"start":{"line":302,"column":79},"end":{"line":302,"column":81},"skip":true}]},"25":{"line":305,"type":"if","locations":[{"start":{"line":305,"column":8},"end":{"line":305,"column":8},"skip":true},{"start":{"line":305,"column":8},"end":{"line":305,"column":8},"skip":true}]},"26":{"line":309,"type":"if","locations":[{"start":{"line":309,"column":8},"end":{"line":309,"column":8},"skip":true},{"start":{"line":309,"column":8},"end":{"line":309,"column":8},"skip":true}]},"27":{"line":312,"type":"binary-expr","locations":[{"start":{"line":312,"column":27},"end":{"line":312,"column":43},"skip":true},{"start":{"line":312,"column":47},"end":{"line":312,"column":53},"skip":true}]},"28":{"line":316,"type":"if","locations":[{"start":{"line":316,"column":12},"end":{"line":316,"column":12},"skip":true},{"start":{"line":316,"column":12},"end":{"line":316,"column":12},"skip":true}]}},"code":["/*","example.js","","quickstart example","","instruction","    1. save this script as example.js","    2. run the shell command:","        $ npm install npmtest-sails && PORT=8081 node example.js","    3. play with the browser-demo on http://127.0.0.1:8081","*/","","","","/* istanbul instrument in package npmtest_sails */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - pre-init","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        // init utility2_rollup","        local = local.global.utility2_rollup || (local.modeJs === 'browser'","            ? local.global.utility2_npmtest_sails","            : global.utility2_moduleExports);","        // export local","        local.global.local = local;","    }());","    switch (local.modeJs) {","","","","    // post-init","    // run browser js-env code - post-init","    /* istanbul ignore next */","    case 'browser':","        local.testRunBrowser = function (event) {","            if (!event || (event &&","                    event.currentTarget &&","                    event.currentTarget.className &&","                    event.currentTarget.className.includes &&","                    event.currentTarget.className.includes('onreset'))) {","                // reset output","                Array.from(","                    document.querySelectorAll('body > .resettable')","                ).forEach(function (element) {","                    switch (element.tagName) {","                    case 'INPUT':","                    case 'TEXTAREA':","                        element.value = '';","                        break;","                    default:","                        element.textContent = '';","                    }","                });","            }","            switch (event && event.currentTarget && event.currentTarget.id) {","            case 'testRunButton1':","                // show tests","                if (document.querySelector('#testReportDiv1').style.display === 'none') {","                    document.querySelector('#testReportDiv1').style.display = 'block';","                    document.querySelector('#testRunButton1').textContent =","                        'hide internal test';","                    local.modeTest = true;","                    local.testRunDefault(local);","                // hide tests","                } else {","                    document.querySelector('#testReportDiv1').style.display = 'none';","                    document.querySelector('#testRunButton1').textContent = 'run internal test';","                }","                break;","            // custom-case","            default:","                break;","            }","            if (document.querySelector('#inputTextareaEval1') && (!event || (event &&","                    event.currentTarget &&","                    event.currentTarget.className &&","                    event.currentTarget.className.includes &&","                    event.currentTarget.className.includes('oneval')))) {","                // try to eval input-code","                try {","                    /*jslint evil: true*/","                    eval(document.querySelector('#inputTextareaEval1').value);","                } catch (errorCaught) {","                    console.error(errorCaught);","                }","            }","        };","        // log stderr and stdout to #outputTextareaStdout1","        ['error', 'log'].forEach(function (key) {","            console[key + '_original'] = console[key];","            console[key] = function () {","                var element;","                console[key + '_original'].apply(console, arguments);","                element = document.querySelector('#outputTextareaStdout1');","                if (!element) {","                    return;","                }","                // append text to #outputTextareaStdout1","                element.value += Array.from(arguments).map(function (arg) {","                    return typeof arg === 'string'","                        ? arg","                        : JSON.stringify(arg, null, 4);","                }).join(' ') + '\\n';","                // scroll textarea to bottom","                element.scrollTop = element.scrollHeight;","            };","        });","        // init event-handling","        ['change', 'click', 'keyup'].forEach(function (event) {","            Array.from(document.querySelectorAll('.on' + event)).forEach(function (element) {","                element.addEventListener(event, local.testRunBrowser);","            });","        });","        // run tests","        local.testRunBrowser();","        break;","","","","    // run node js-env code - post-init","    /* istanbul ignore next */","    case 'node':","        // export local","        module.exports = local;","        // require modules","        local.fs = require('fs');","        local.http = require('http');","        local.url = require('url');","        // init assets","        local.assetsDict = local.assetsDict || {};","        /* jslint-ignore-begin */","        local.assetsDict['/assets.index.template.html'] = '\\","<!doctype html>\\n\\","<html lang=\"en\">\\n\\","<head>\\n\\","<meta charset=\"UTF-8\">\\n\\","<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\n\\","<title>{{env.npm_package_name}} (v{{env.npm_package_version}})</title>\\n\\","<style>\\n\\","/*csslint\\n\\","    box-sizing: false,\\n\\","    universal-selector: false\\n\\","*/\\n\\","* {\\n\\","    box-sizing: border-box;\\n\\","}\\n\\","body {\\n\\","    background: #dde;\\n\\","    font-family: Arial, Helvetica, sans-serif;\\n\\","    margin: 2rem;\\n\\","}\\n\\","body > * {\\n\\","    margin-bottom: 1rem;\\n\\","}\\n\\",".utility2FooterDiv {\\n\\","    margin-top: 20px;\\n\\","    text-align: center;\\n\\","}\\n\\","</style>\\n\\","<style>\\n\\","/*csslint\\n\\","*/\\n\\","textarea {\\n\\","    font-family: monospace;\\n\\","    height: 10rem;\\n\\","    width: 100%;\\n\\","}\\n\\","textarea[readonly] {\\n\\","    background: #ddd;\\n\\","}\\n\\","</style>\\n\\","</head>\\n\\","<body>\\n\\","<!-- utility2-comment\\n\\","<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 0.5s, width 1.5s; width: 25%;\"></div>\\n\\","utility2-comment -->\\n\\","<h1>\\n\\","<!-- utility2-comment\\n\\","    <a\\n\\","        {{#if env.npm_package_homepage}}\\n\\","        href=\"{{env.npm_package_homepage}}\"\\n\\","        {{/if env.npm_package_homepage}}\\n\\","        target=\"_blank\"\\n\\","    >\\n\\","utility2-comment -->\\n\\","        {{env.npm_package_name}} (v{{env.npm_package_version}})\\n\\","<!-- utility2-comment\\n\\","    </a>\\n\\","utility2-comment -->\\n\\","</h1>\\n\\","<h3>{{env.npm_package_description}}</h3>\\n\\","<!-- utility2-comment\\n\\","<h4><a download href=\"assets.app.js\">download standalone app</a></h4>\\n\\","<button class=\"onclick onreset\" id=\"testRunButton1\">run internal test</button><br>\\n\\","<div id=\"testReportDiv1\" style=\"display: none;\"></div>\\n\\","utility2-comment -->\\n\\","\\n\\","\\n\\","\\n\\","<label>stderr and stdout</label>\\n\\","<textarea class=\"resettable\" id=\"outputTextareaStdout1\" readonly></textarea>\\n\\","<!-- utility2-comment\\n\\","{{#if isRollup}}\\n\\","<script src=\"assets.app.js\"></script>\\n\\","{{#unless isRollup}}\\n\\","utility2-comment -->\\n\\","<script src=\"assets.utility2.rollup.js\"></script>\\n\\","<script src=\"jsonp.utility2._stateInit?callback=window.utility2._stateInit\"></script>\\n\\","<script src=\"assets.npmtest_sails.rollup.js\"></script>\\n\\","<script src=\"assets.example.js\"></script>\\n\\","<script src=\"assets.test.js\"></script>\\n\\","<!-- utility2-comment\\n\\","{{/if isRollup}}\\n\\","utility2-comment -->\\n\\","<div class=\"utility2FooterDiv\">\\n\\","    [ this app was created with\\n\\","    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\","    ]\\n\\","</div>\\n\\","</body>\\n\\","</html>\\n\\","';","        /* jslint-ignore-end */","        if (local.templateRender) {","            local.assetsDict['/'] = local.templateRender(","                local.assetsDict['/assets.index.template.html'],","                {","                    env: local.objectSetDefault(local.env, {","                        npm_package_description: 'the greatest app in the world!',","                        npm_package_name: 'my-app',","                        npm_package_nameAlias: 'my_app',","                        npm_package_version: '0.0.1'","                    })","                }","            );","        } else {","            local.assetsDict['/'] = local.assetsDict['/assets.index.template.html']","                .replace((/\\{\\{env\\.(\\w+?)\\}\\}/g), function (match0, match1) {","                    // jslint-hack","                    String(match0);","                    switch (match1) {","                    case 'npm_package_description':","                        return 'the greatest app in the world!';","                    case 'npm_package_name':","                        return 'my-app';","                    case 'npm_package_nameAlias':","                        return 'my_app';","                    case 'npm_package_version':","                        return '0.0.1';","                    }","                });","        }","        // run the cli","        if (local.global.utility2_rollup || module !== require.main) {","            break;","        }","        local.assetsDict['/assets.example.js'] =","            local.assetsDict['/assets.example.js'] ||","            local.fs.readFileSync(__filename, 'utf8');","        local.assetsDict['/assets.npmtest_sails.rollup.js'] =","            local.assetsDict['/assets.npmtest_sails.rollup.js'] ||","            local.fs.readFileSync(","                // buildCustomOrg-hack","                local.npmtest_sails.__dirname +","                    '/lib.npmtest_sails.js',","                'utf8'","            ).replace((/^#!/), '//');","        local.assetsDict['/favicon.ico'] = local.assetsDict['/favicon.ico'] || '';","        // if $npm_config_timeout_exit exists,","        // then exit this process after $npm_config_timeout_exit ms","        if (Number(process.env.npm_config_timeout_exit)) {","            setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));","        }","        // start server","        if (local.global.utility2_serverHttp1) {","            break;","        }","        process.env.PORT = process.env.PORT || '8081';","        console.error('server starting on port ' + process.env.PORT);","        local.http.createServer(function (request, response) {","            request.urlParsed = local.url.parse(request.url);","            if (local.assetsDict[request.urlParsed.pathname] !== undefined) {","                response.end(local.assetsDict[request.urlParsed.pathname]);","                return;","            }","            response.statusCode = 404;","            response.end();","        }).listen(process.env.PORT);","        break;","    }","}());",""],"l":{"26":2,"28":2,"33":2,"35":2,"37":2,"38":2,"39":2,"44":1,"51":2,"55":2,"59":2,"61":2,"69":1,"70":2,"76":2,"79":2,"82":2,"83":2,"85":1,"89":2,"92":1,"93":1,"94":1,"96":1,"97":1,"100":1,"101":1,"103":1,"106":1,"108":2,"114":1,"116":1,"118":1,"123":1,"124":2,"125":2,"126":2,"127":2,"128":2,"129":2,"130":1,"133":2,"134":2,"139":2,"143":1,"144":3,"145":1,"149":1,"150":1,"158":1,"160":1,"161":1,"162":1,"164":1,"166":1,"258":1,"259":1,"271":1,"274":6,"275":6,"277":1,"279":2,"281":1,"283":2,"288":1,"289":1,"291":1,"294":1,"302":1,"305":1,"306":1,"309":1,"310":1,"312":1,"313":1,"314":1,"315":1,"316":1,"317":1,"318":1,"320":1,"321":1,"323":1}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/index.js","s":{"1":1,"2":1,"3":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":29}},"2":{"start":{"line":11,"column":0},"end":{"line":11,"column":29}},"3":{"start":{"line":14,"column":0},"end":{"line":14,"column":29}}},"branchMap":{},"code":["/**"," * Module dependencies"," */","","var Sails = require('./app');","","","","// Instantiate and expose a Sails singleton","// (maintains legacy support)","module.exports = new Sails();","","// Expose constructor for convenience/tests","module.exports.Sails = Sails;","","","// To access the Sails app constructor, do:","// var Sails = require('sails').constructor;","// or:","// var Sails = require('sails').Sails;","//","// Then:","// var newApp = new Sails();",""],"l":{"5":1,"11":1,"14":1}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":2,"6":1,"7":1,"8":1},"b":{},"f":{"1":2},"fnMap":{"1":{"name":"SailsFactory","line":17,"loc":{"start":{"line":17,"column":0},"end":{"line":17,"column":24}}}},"statementMap":{"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":31}},"2":{"start":{"line":7,"column":0},"end":{"line":7,"column":35}},"3":{"start":{"line":15,"column":0},"end":{"line":15,"column":30}},"4":{"start":{"line":17,"column":0},"end":{"line":19,"column":1}},"5":{"start":{"line":18,"column":2},"end":{"line":18,"column":21}},"6":{"start":{"line":23,"column":0},"end":{"line":23,"column":31}},"7":{"start":{"line":24,"column":0},"end":{"line":24,"column":80}},"8":{"start":{"line":25,"column":0},"end":{"line":25,"column":74}}},"branchMap":{},"code":["/**"," * Module dependencies."," */","","// try {console.time('require_core');}catch(e){}","var Sails = require('./Sails');","var _ = require('@sailshq/lodash');","","","/**"," * Expose `Sails` factory"," * (maintains backwards compatibility w/ constructor usage)"," */","","module.exports = SailsFactory;","","function SailsFactory() {","  return new Sails();","}","","","// Backwards compatibility for Sails singleton usage:","var singleton = SailsFactory();","SailsFactory.isLocalSailsValid = _.bind(singleton.isLocalSailsValid, singleton);","SailsFactory.isSailsAppSync = _.bind(singleton.isSailsAppSync, singleton);",""],"l":{"6":1,"7":1,"15":1,"17":1,"18":2,"23":1,"24":1,"25":1}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/Sails.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/Sails.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":2,"10":2,"11":2,"12":2,"13":2,"14":2,"15":2,"16":2,"17":2,"18":2,"19":2,"20":2,"21":2,"22":2,"23":2,"24":2,"25":2,"26":2,"27":2,"28":2,"29":2,"30":2,"31":2,"32":2,"33":2,"34":2,"35":1,"36":1,"37":1,"38":1,"39":1,"40":0,"41":0,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":0,"49":0,"50":1,"51":0,"52":0,"53":1,"54":0,"55":0,"56":1,"57":0,"58":0,"59":1,"60":0,"61":0,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1},"b":{},"f":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"Sails","line":21,"loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":17}}},"2":{"name":"(anonymous_2)","line":81,"loc":{"start":{"line":81,"column":29},"end":{"line":81,"column":40}}},"3":{"name":"(anonymous_3)","line":101,"loc":{"start":{"line":101,"column":22},"end":{"line":101,"column":45}}},"4":{"name":"(anonymous_4)","line":105,"loc":{"start":{"line":105,"column":22},"end":{"line":105,"column":45}}},"5":{"name":"(anonymous_5)","line":109,"loc":{"start":{"line":109,"column":23},"end":{"line":109,"column":46}}},"6":{"name":"(anonymous_6)","line":113,"loc":{"start":{"line":113,"column":22},"end":{"line":113,"column":45}}},"7":{"name":"(anonymous_7)","line":117,"loc":{"start":{"line":117,"column":50},"end":{"line":117,"column":73}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":31}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":35}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":27}},"4":{"start":{"line":8,"column":0},"end":{"line":8,"column":34}},"5":{"start":{"line":9,"column":0},"end":{"line":9,"column":44}},"6":{"start":{"line":10,"column":0},"end":{"line":10,"column":36}},"7":{"start":{"line":11,"column":0},"end":{"line":11,"column":42}},"8":{"start":{"line":21,"column":0},"end":{"line":66,"column":1}},"9":{"start":{"line":24,"column":2},"end":{"line":24,"column":33}},"10":{"start":{"line":28,"column":2},"end":{"line":28,"column":26}},"11":{"start":{"line":31,"column":2},"end":{"line":31,"column":27}},"12":{"start":{"line":34,"column":2},"end":{"line":34,"column":27}},"13":{"start":{"line":37,"column":2},"end":{"line":37,"column":17}},"14":{"start":{"line":41,"column":2},"end":{"line":41,"column":30}},"15":{"start":{"line":44,"column":2},"end":{"line":44,"column":19}},"16":{"start":{"line":47,"column":2},"end":{"line":47,"column":38}},"17":{"start":{"line":48,"column":2},"end":{"line":48,"column":44}},"18":{"start":{"line":49,"column":2},"end":{"line":49,"column":38}},"19":{"start":{"line":50,"column":2},"end":{"line":50,"column":40}},"20":{"start":{"line":51,"column":2},"end":{"line":51,"column":50}},"21":{"start":{"line":52,"column":2},"end":{"line":52,"column":50}},"22":{"start":{"line":53,"column":2},"end":{"line":53,"column":56}},"23":{"start":{"line":54,"column":2},"end":{"line":54,"column":54}},"24":{"start":{"line":55,"column":2},"end":{"line":55,"column":44}},"25":{"start":{"line":56,"column":2},"end":{"line":56,"column":64}},"26":{"start":{"line":57,"column":2},"end":{"line":57,"column":58}},"27":{"start":{"line":58,"column":2},"end":{"line":58,"column":44}},"28":{"start":{"line":59,"column":2},"end":{"line":59,"column":46}},"29":{"start":{"line":60,"column":2},"end":{"line":60,"column":42}},"30":{"start":{"line":61,"column":2},"end":{"line":61,"column":36}},"31":{"start":{"line":62,"column":2},"end":{"line":62,"column":36}},"32":{"start":{"line":63,"column":2},"end":{"line":63,"column":38}},"33":{"start":{"line":64,"column":2},"end":{"line":64,"column":36}},"34":{"start":{"line":65,"column":2},"end":{"line":65,"column":48}},"35":{"start":{"line":70,"column":0},"end":{"line":70,"column":42}},"36":{"start":{"line":76,"column":0},"end":{"line":76,"column":41}},"37":{"start":{"line":78,"column":0},"end":{"line":78,"column":43}},"38":{"start":{"line":80,"column":0},"end":{"line":80,"column":54}},"39":{"start":{"line":81,"column":0},"end":{"line":84,"column":2}},"40":{"start":{"line":82,"column":2},"end":{"line":82,"column":179}},"41":{"start":{"line":83,"column":2},"end":{"line":83,"column":28}},"42":{"start":{"line":85,"column":0},"end":{"line":85,"column":56}},"43":{"start":{"line":86,"column":0},"end":{"line":86,"column":56}},"44":{"start":{"line":89,"column":0},"end":{"line":89,"column":57}},"45":{"start":{"line":90,"column":0},"end":{"line":90,"column":53}},"46":{"start":{"line":97,"column":0},"end":{"line":97,"column":47}},"47":{"start":{"line":101,"column":0},"end":{"line":104,"column":2}},"48":{"start":{"line":102,"column":2},"end":{"line":102,"column":33}},"49":{"start":{"line":103,"column":2},"end":{"line":103,"column":14}},"50":{"start":{"line":105,"column":0},"end":{"line":108,"column":2}},"51":{"start":{"line":106,"column":2},"end":{"line":106,"column":40}},"52":{"start":{"line":107,"column":2},"end":{"line":107,"column":14}},"53":{"start":{"line":109,"column":0},"end":{"line":112,"column":2}},"54":{"start":{"line":110,"column":2},"end":{"line":110,"column":41}},"55":{"start":{"line":111,"column":2},"end":{"line":111,"column":14}},"56":{"start":{"line":113,"column":0},"end":{"line":116,"column":2}},"57":{"start":{"line":114,"column":2},"end":{"line":114,"column":40}},"58":{"start":{"line":115,"column":2},"end":{"line":115,"column":14}},"59":{"start":{"line":117,"column":0},"end":{"line":120,"column":2}},"60":{"start":{"line":118,"column":2},"end":{"line":118,"column":43}},"61":{"start":{"line":119,"column":2},"end":{"line":119,"column":14}},"62":{"start":{"line":125,"column":0},"end":{"line":125,"column":61}},"63":{"start":{"line":126,"column":0},"end":{"line":126,"column":67}},"64":{"start":{"line":127,"column":0},"end":{"line":127,"column":62}},"65":{"start":{"line":128,"column":0},"end":{"line":128,"column":55}},"66":{"start":{"line":129,"column":0},"end":{"line":129,"column":75}},"67":{"start":{"line":130,"column":0},"end":{"line":130,"column":69}},"68":{"start":{"line":133,"column":0},"end":{"line":133,"column":55}},"69":{"start":{"line":134,"column":0},"end":{"line":134,"column":57}},"70":{"start":{"line":135,"column":0},"end":{"line":135,"column":53}},"71":{"start":{"line":141,"column":0},"end":{"line":141,"column":45}},"72":{"start":{"line":144,"column":0},"end":{"line":144,"column":23}}},"branchMap":{},"code":["/**"," * Module dependencies."," */","","var events = require('events');","var _ = require('@sailshq/lodash');","var util = require('util');","var loadSails = require('./load');","var mixinAfter = require('./private/after');","var __Router = require('../router');","var CaptainsLog = require('captains-log');","","","","/**"," * Construct a Sails (app) instance."," *"," * @constructor"," */","","function Sails() {","","  // Inherit methods from EventEmitter","  events.EventEmitter.call(this);","","  // Remove memory-leak warning about max listeners","  // See: http://nodejs.org/docs/latest/api/events.html#events_emitter_setmaxlisteners_n","  this.setMaxListeners(0);","","  // Keep track of spawned child processes","  this.childProcesses = [];","","  // Ensure CaptainsLog exists","  this.log = CaptainsLog();","","  // Build a Router instance (which will attach itself to the sails object)","  __Router(this);","","  // Mixin `load()` method to load the pieces","  // of a Sails app","  this.load = loadSails(this);","","  // Mixin support for `Sails.prototype.after()`","  mixinAfter(this);","","  // Bind `this` context for all `Sails.prototype.*` methods","  this.load = _.bind(this.load, this);","  this.request = _.bind(this.request, this);","  this.lift = _.bind(this.lift, this);","  this.lower = _.bind(this.lower, this);","  this.getBaseurl = _.bind(this.getBaseurl, this);","  this.initialize = _.bind(this.initialize, this);","  this.exposeGlobals = _.bind(this.exposeGlobals, this);","  this.runBootstrap = _.bind(this.runBootstrap, this);","  this.getHost = _.bind(this.getHost, this);","  this.isLocalSailsValid = _.bind(this.isLocalSailsValid, this);","  this.isSailsAppSync = _.bind(this.isSailsAppSync, this);","  this.inspect = _.bind(this.inspect, this);","  this.toString = _.bind(this.toString, this);","  this.toJSON = _.bind(this.toJSON, this);","  this.all = _.bind(this.all, this);","  this.get = _.bind(this.get, this);","  this.post = _.bind(this.post, this);","  this.put = _.bind(this.put, this);","  this['delete'] = _.bind(this['delete'], this);","}","","","// Extend from EventEmitter to allow hooks to listen to stuff","util.inherits(Sails, events.EventEmitter);","","","// Public methods","////////////////////////////////////////////////////////","","Sails.prototype.lift = require('./lift');","","Sails.prototype.lower = require('./lower');","","Sails.prototype._getBaseUrl = require('./getBaseurl');","Sails.prototype.getBaseurl = function() {","  this.log.warn(\"sails.getBaseUrl() is deprecated and will be removed in Sails v1.0.  See http://sailsjs.org/documentation/reference/application/sails-getbaseurl for more info.\");","  return this._getBaseUrl();","};","Sails.prototype.getBaseURL = Sails.prototype.getBaseurl;","Sails.prototype.getBaseUrl = Sails.prototype.getBaseurl;","","","Sails.prototype.getRouteFor = require('./get-route-for');","Sails.prototype.getUrlFor = require('./get-url-for');","","","","// Experimental methods","////////////////////////////////////////////////////////","","Sails.prototype.request = require('./request');","","","// Expose Express-esque synonyms for low-level usage of router","Sails.prototype.all = function(path, action) {","  this.router.bind(path, action);","  return this;","};","Sails.prototype.get = function(path, action) {","  this.router.bind(path, action, 'get');","  return this;","};","Sails.prototype.post = function(path, action) {","  this.router.bind(path, action, 'post');","  return this;","};","Sails.prototype.put = function(path, action) {","  this.router.bind(path, action, 'put');","  return this;","};","Sails.prototype.del = Sails.prototype['delete'] = function(path, action) {","  this.router.bind(path, action, 'delete');","  return this;","};","","// Private methods:","////////////////////////////////////////////////////////","","Sails.prototype.initialize = require('./private/initialize');","Sails.prototype.exposeGlobals = require('./private/exposeGlobals');","Sails.prototype.runBootstrap = require('./private/bootstrap');","Sails.prototype.getHost = require('./private/getHost');","Sails.prototype.isLocalSailsValid = require('./private/isLocalSailsValid');","Sails.prototype.isSailsAppSync = require('./private/isSailsAppSync');","","// Presentation","Sails.prototype.inspect = require('./private/inspect');","Sails.prototype.toString = require('./private/toString');","Sails.prototype.toJSON = require('./private/toJSON');","","// Utilities","// Includes lodash, node's `util`, and a few additional","// static helper methods.","// (may be deprecated in a future release)","Sails.prototype.util = require('sails-util');","","// Expose Sails constructor","module.exports = Sails;",""],"l":{"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"21":1,"24":2,"28":2,"31":2,"34":2,"37":2,"41":2,"44":2,"47":2,"48":2,"49":2,"50":2,"51":2,"52":2,"53":2,"54":2,"55":2,"56":2,"57":2,"58":2,"59":2,"60":2,"61":2,"62":2,"63":2,"64":2,"65":2,"70":1,"76":1,"78":1,"80":1,"81":1,"82":0,"83":0,"85":1,"86":1,"89":1,"90":1,"97":1,"101":1,"102":0,"103":0,"105":1,"106":0,"107":0,"109":1,"110":0,"111":0,"113":1,"114":0,"115":0,"117":1,"118":0,"119":0,"125":1,"126":1,"127":1,"128":1,"129":1,"130":1,"133":1,"134":1,"135":1,"141":1,"144":1}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/load.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/load.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":2,"9":2,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":1,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":1,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":1,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0,0],"14":[0,0]},"f":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"fnMap":{"1":{"name":"(anonymous_1)","line":7,"loc":{"start":{"line":7,"column":17},"end":{"line":7,"column":33}}},"2":{"name":"load","line":18,"loc":{"start":{"line":18,"column":9},"end":{"line":18,"column":43}}},"3":{"name":"populateRegistry","line":67,"loc":{"start":{"line":67,"column":8},"end":{"line":67,"column":38}}},"4":{"name":"(anonymous_4)","line":76,"loc":{"start":{"line":76,"column":32},"end":{"line":76,"column":67}}},"5":{"name":"loadHooks","line":103,"loc":{"start":{"line":103,"column":2},"end":{"line":103,"column":25}}},"6":{"name":"(anonymous_6)","line":113,"loc":{"start":{"line":113,"column":6},"end":{"line":113,"column":19}}},"7":{"name":"(anonymous_7)","line":116,"loc":{"start":{"line":116,"column":6},"end":{"line":116,"column":19}}},"8":{"name":"(anonymous_8)","line":119,"loc":{"start":{"line":119,"column":7},"end":{"line":119,"column":21}}},"9":{"name":"loadHookDefinitions","line":136,"loc":{"start":{"line":136,"column":2},"end":{"line":136,"column":42}}},"10":{"name":"(anonymous_10)","line":154,"loc":{"start":{"line":154,"column":20},"end":{"line":154,"column":44}}},"11":{"name":"ready__","line":170,"loc":{"start":{"line":170,"column":2},"end":{"line":170,"column":23}}},"12":{"name":"(anonymous_12)","line":171,"loc":{"start":{"line":171,"column":11},"end":{"line":171,"column":25}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":29}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":35}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":49}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":55}},"6":{"start":{"line":7,"column":0},"end":{"line":187,"column":2}},"7":{"start":{"line":9,"column":2},"end":{"line":9,"column":45}},"8":{"start":{"line":10,"column":2},"end":{"line":10,"column":49}},"9":{"start":{"line":18,"column":2},"end":{"line":94,"column":4}},"10":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"11":{"start":{"line":21,"column":6},"end":{"line":21,"column":268}},"12":{"start":{"line":25,"column":4},"end":{"line":28,"column":5}},"13":{"start":{"line":26,"column":6},"end":{"line":26,"column":26}},"14":{"start":{"line":27,"column":6},"end":{"line":27,"column":26}},"15":{"start":{"line":31,"column":4},"end":{"line":31,"column":42}},"16":{"start":{"line":32,"column":4},"end":{"line":32,"column":47}},"17":{"start":{"line":37,"column":4},"end":{"line":39,"column":5}},"18":{"start":{"line":38,"column":6},"end":{"line":38,"column":56}},"19":{"start":{"line":43,"column":4},"end":{"line":43,"column":60}},"20":{"start":{"line":45,"column":4},"end":{"line":90,"column":20}},"21":{"start":{"line":69,"column":10},"end":{"line":69,"column":57}},"22":{"start":{"line":74,"column":10},"end":{"line":79,"column":17}},"23":{"start":{"line":77,"column":12},"end":{"line":77,"column":49}},"24":{"start":{"line":78,"column":12},"end":{"line":78,"column":28}},"25":{"start":{"line":81,"column":10},"end":{"line":81,"column":46}},"26":{"start":{"line":83,"column":10},"end":{"line":83,"column":15}},"27":{"start":{"line":93,"column":4},"end":{"line":93,"column":17}},"28":{"start":{"line":103,"column":2},"end":{"line":128,"column":3}},"29":{"start":{"line":104,"column":4},"end":{"line":104,"column":22}},"30":{"start":{"line":107,"column":4},"end":{"line":109,"column":5}},"31":{"start":{"line":108,"column":6},"end":{"line":108,"column":18}},"32":{"start":{"line":111,"column":4},"end":{"line":127,"column":7}},"33":{"start":{"line":114,"column":8},"end":{"line":114,"column":45}},"34":{"start":{"line":117,"column":8},"end":{"line":117,"column":41}},"35":{"start":{"line":120,"column":6},"end":{"line":120,"column":30}},"36":{"start":{"line":120,"column":15},"end":{"line":120,"column":30}},"37":{"start":{"line":124,"column":6},"end":{"line":124,"column":40}},"38":{"start":{"line":125,"column":6},"end":{"line":125,"column":53}},"39":{"start":{"line":126,"column":6},"end":{"line":126,"column":18}},"40":{"start":{"line":136,"column":2},"end":{"line":163,"column":3}},"41":{"start":{"line":139,"column":4},"end":{"line":139,"column":40}},"42":{"start":{"line":147,"column":4},"end":{"line":160,"column":5}},"43":{"start":{"line":148,"column":6},"end":{"line":152,"column":7}},"44":{"start":{"line":149,"column":8},"end":{"line":151,"column":69}},"45":{"start":{"line":154,"column":6},"end":{"line":158,"column":9}},"46":{"start":{"line":155,"column":8},"end":{"line":157,"column":9}},"47":{"start":{"line":156,"column":10},"end":{"line":156,"column":34}},"48":{"start":{"line":159,"column":6},"end":{"line":159,"column":107}},"49":{"start":{"line":162,"column":4},"end":{"line":162,"column":16}},"50":{"start":{"line":170,"column":2},"end":{"line":186,"column":3}},"51":{"start":{"line":171,"column":4},"end":{"line":185,"column":6}},"52":{"start":{"line":172,"column":6},"end":{"line":174,"column":7}},"53":{"start":{"line":173,"column":8},"end":{"line":173,"column":29}},"54":{"start":{"line":176,"column":6},"end":{"line":176,"column":63}},"55":{"start":{"line":179,"column":6},"end":{"line":182,"column":7}},"56":{"start":{"line":181,"column":12},"end":{"line":181,"column":34}},"57":{"start":{"line":184,"column":6},"end":{"line":184,"column":28}}},"branchMap":{"1":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":4},"end":{"line":20,"column":4}},{"start":{"line":20,"column":4},"end":{"line":20,"column":4}}]},"2":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":4},"end":{"line":25,"column":4}},{"start":{"line":25,"column":4},"end":{"line":25,"column":4}}]},"3":{"line":31,"type":"binary-expr","locations":[{"start":{"line":31,"column":21},"end":{"line":31,"column":35}},{"start":{"line":31,"column":39},"end":{"line":31,"column":41}}]},"4":{"line":37,"type":"if","locations":[{"start":{"line":37,"column":4},"end":{"line":37,"column":4}},{"start":{"line":37,"column":4},"end":{"line":37,"column":4}}]},"5":{"line":107,"type":"if","locations":[{"start":{"line":107,"column":4},"end":{"line":107,"column":4}},{"start":{"line":107,"column":4},"end":{"line":107,"column":4}}]},"6":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":6},"end":{"line":120,"column":6}},{"start":{"line":120,"column":6},"end":{"line":120,"column":6}}]},"7":{"line":147,"type":"if","locations":[{"start":{"line":147,"column":4},"end":{"line":147,"column":4}},{"start":{"line":147,"column":4},"end":{"line":147,"column":4}}]},"8":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":6},"end":{"line":148,"column":6}},{"start":{"line":148,"column":6},"end":{"line":148,"column":6}}]},"9":{"line":155,"type":"if","locations":[{"start":{"line":155,"column":8},"end":{"line":155,"column":8}},{"start":{"line":155,"column":8},"end":{"line":155,"column":8}}]},"10":{"line":172,"type":"if","locations":[{"start":{"line":172,"column":6},"end":{"line":172,"column":6}},{"start":{"line":172,"column":6},"end":{"line":172,"column":6}}]},"11":{"line":173,"type":"binary-expr","locations":[{"start":{"line":173,"column":15},"end":{"line":173,"column":17}},{"start":{"line":173,"column":21},"end":{"line":173,"column":28}}]},"12":{"line":179,"type":"if","locations":[{"start":{"line":179,"column":6},"end":{"line":179,"column":6}},{"start":{"line":179,"column":6},"end":{"line":179,"column":6}}]},"13":{"line":179,"type":"binary-expr","locations":[{"start":{"line":179,"column":10},"end":{"line":179,"column":28}},{"start":{"line":179,"column":32},"end":{"line":179,"column":71}},{"start":{"line":180,"column":12},"end":{"line":180,"column":34}},{"start":{"line":180,"column":38},"end":{"line":180,"column":88}}]},"14":{"line":184,"type":"binary-expr","locations":[{"start":{"line":184,"column":6},"end":{"line":184,"column":8}},{"start":{"line":184,"column":12},"end":{"line":184,"column":27}}]}},"code":["var async = require('async');","var _ = require('@sailshq/lodash');","var util = require('util');","var __Configuration = require('./configuration');","var __initializeHooks = require('./private/loadHooks');","","module.exports = function(sails) {","","  var Configuration = __Configuration(sails);","  var initializeHooks = __initializeHooks(sails);","","  /**","   * Expose loader start point.","   * (idempotent)","   *","   * @api public","   */","  return function load(configOverride, cb) {","","    if (sails._exiting) {","      return cb(new Error('\\n*********\\nCannot load or lift an app after it has already been lowered. \\nYou can make a new app instance with:\\nvar SailsApp = require(\\'sails\\').Sails;\\nvar sails = new SailsApp();\\n\\nAnd then you can do:\\nsails.load([opts,] cb)\\n\\n'));","    }","","    // configOverride is optional","    if (_.isFunction(configOverride)) {","      cb = configOverride;","      configOverride = {};","    }","","    // Ensure override is an object and clone it (or make an empty object if it's not)","    configOverride = configOverride || {};","    sails.config = _.cloneDeep(configOverride);","","","    // If host is explicitly specified, set `explicitHost`","    // (otherwise when host is omitted, Express will accept all connections via INADDR_ANY)","    if (configOverride.host) {","      configOverride.explicitHost = configOverride.host;","    }","","    // Optionally expose services, models, sails, _, async, etc. as globals as soon as the","    // user config loads.","    sails.on('hook:userconfig:loaded', sails.exposeGlobals);","","    async.auto({","","      // Apply core defaults and hook-agnostic configuration,","      // esp. overrides including command-line options, environment variables,","      // and options that were passed in programmatically.","      config: [Configuration.load],","","      // Load hooks into memory, with their middleware and routes","      hooks: ['config', loadHooks],","","      // Populate the \"registry\"","      // Houses \"middleware-esque\" functions bound by various hooks and/or Sails core itself.","      // (i.e. `function (req, res [,next]) {}`)","      //","      // (Basically, that means we grab an exposed `middleware` object,","      // full of functions, from each hook, then make it available as","      // `sails.middleware.[HOOK_ID]`.)","      //","      // TODO: finish refactoring to change \"middleware\" nomenclature","      // to avoid confusion with the more specific (and more common)","      // usage of the term.","      registry: ['hooks',","        function populateRegistry(cb) {","","          sails.log.verbose('Instantiating registry...');","","          // Iterate through hooks and absorb the middleware therein","          // Save a reference to registry and expose it on","          // the Sails instance.","          sails.middleware = sails.registry =","          // Namespace functions by their source hook's identity","          _.reduce(sails.hooks, function(registry, hook, identity) {","            registry[identity] = hook.middleware;","            return registry;","          }, {});","","          sails.emit('middleware:registered');","","          cb();","        }","      ],","","      // Load the router and bind routes in `sails.config.routes`","      router: ['registry', sails.router.load]","","    }, ready__(cb));","","    // Makes `app.load()` chainable","    return sails;","  };","","  /**","   * Load hooks in parallel","   * let them work out dependencies themselves,","   * taking advantage of events fired from the sails object","   *","   * @api private","   */","  function loadHooks(cb) {","    sails.hooks = { };","","    // If config.hooks is disabled, skip hook loading altogether","    if (sails.config.hooks === false) {","      return cb();","    }","","    async.series([","","      function(cb) {","        loadHookDefinitions(sails.hooks, cb);","      },","      function(cb) {","        initializeHooks(sails.hooks, cb);","      }","    ], function(err) {","      if (err) return cb(err);","","      // Inform any listeners that the initial, built-in hooks","      // are finished loading","      sails.emit('hooks:builtIn:ready');","      sails.log.verbose('Built-in hooks are ready.');","      return cb();","    });","  }","","  /**","   * Load built-in hook definitions from `sails.config.hooks`","   * and put them back into `hooks` (probably `sails.hooks`)","   *","   * @api private","   */","  function loadHookDefinitions(hooks, cb) {","","    // Mix in user-configured hook definitions","    _.extend(hooks, sails.config.hooks);","","    // Make sure these changes to the hooks object get applied","    // to sails.config.hooks to keep logic consistent","    // (I think we can get away w/o this, but leaving as a stub)","    // sails.config.hooks = hooks;","","    // If user configured `loadHooks`, only include those.","    if (sails.config.loadHooks) {","      if (!_.isArray(sails.config.loadHooks)) {","        return cb('Invalid `loadHooks` config.  ' +","          'Please specify an array of string hook names.\\n' +","          'You specified ::' + util.inspect(sails.config.loadHooks));","      }","","      _.each(hooks, function(def, hookName) {","        if (!_.contains(sails.config.loadHooks, hookName)) {","          hooks[hookName] = false;","        }","      });","      sails.log.verbose('Deliberate partial load-- will only initialize hooks ::', sails.config.loadHooks);","    }","","    return cb();","  }","","  /**","   * Returns function which is fired when Sails is ready to go","   *","   * @api private","   */","  function ready__(cb) {","    return function(err) {","      if (err) {","        return cb && cb(err);","      }","","      sails.log.verbose('All hooks were loaded successfully.');","","      // If userconfig hook is turned off, still load globals.","      if (sails.config.hooks && sails.config.hooks.userconfig === false ||","           (sails.config.loadHooks && sails.config.loadHooks.indexOf('userconfig') == -1)) {","            sails.exposeGlobals();","      }","","      cb && cb(null, sails);","    };","  }","};",""],"l":{"1":1,"2":1,"3":1,"4":1,"5":1,"7":1,"9":2,"10":2,"18":2,"20":0,"21":0,"25":0,"26":0,"27":0,"31":0,"32":0,"37":0,"38":0,"43":0,"45":0,"69":0,"74":0,"77":0,"78":0,"81":0,"83":0,"93":0,"103":1,"104":0,"107":0,"108":0,"111":0,"114":0,"117":0,"120":0,"124":0,"125":0,"126":0,"136":1,"139":0,"147":0,"148":0,"149":0,"154":0,"155":0,"156":0,"159":0,"162":0,"170":1,"171":0,"172":0,"173":0,"176":0,"179":0,"181":0,"184":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/configuration/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/configuration/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":2,"6":1,"7":2,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":2},"b":{"1":[0,0],"2":[0,0,0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"f":{"1":2,"2":2,"3":0,"4":0},"fnMap":{"1":{"name":"(anonymous_1)","line":9,"loc":{"start":{"line":9,"column":17},"end":{"line":9,"column":33}}},"2":{"name":"Configuration","line":18,"loc":{"start":{"line":18,"column":2},"end":{"line":18,"column":27}}},"3":{"name":"defaultConfig","line":26,"loc":{"start":{"line":26,"column":20},"end":{"line":26,"column":52}}},"4":{"name":"(anonymous_4)","line":53,"loc":{"start":{"line":53,"column":39},"end":{"line":53,"column":82}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":47}},"4":{"start":{"line":9,"column":0},"end":{"line":114,"column":2}},"5":{"start":{"line":15,"column":2},"end":{"line":15,"column":29}},"6":{"start":{"line":18,"column":2},"end":{"line":112,"column":3}},"7":{"start":{"line":26,"column":4},"end":{"line":105,"column":41}},"8":{"start":{"line":28,"column":6},"end":{"line":28,"column":21}},"9":{"start":{"line":31,"column":6},"end":{"line":35,"column":7}},"10":{"start":{"line":34,"column":8},"end":{"line":34,"column":63}},"11":{"start":{"line":39,"column":6},"end":{"line":41,"column":7}},"12":{"start":{"line":40,"column":8},"end":{"line":40,"column":51}},"13":{"start":{"line":44,"column":6},"end":{"line":94,"column":8}},"14":{"start":{"line":57,"column":10},"end":{"line":75,"column":11}},"15":{"start":{"line":58,"column":12},"end":{"line":58,"column":70}},"16":{"start":{"line":62,"column":15},"end":{"line":75,"column":11}},"17":{"start":{"line":63,"column":12},"end":{"line":63,"column":21}},"18":{"start":{"line":64,"column":12},"end":{"line":69,"column":13}},"19":{"start":{"line":65,"column":14},"end":{"line":65,"column":42}},"20":{"start":{"line":68,"column":14},"end":{"line":68,"column":94}},"21":{"start":{"line":70,"column":12},"end":{"line":70,"column":38}},"22":{"start":{"line":74,"column":12},"end":{"line":74,"column":98}},"23":{"start":{"line":76,"column":10},"end":{"line":76,"column":22}},"24":{"start":{"line":110,"column":4},"end":{"line":110,"column":20}}},"branchMap":{"1":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":6},"end":{"line":31,"column":6}},{"start":{"line":31,"column":6},"end":{"line":31,"column":6}}]},"2":{"line":31,"type":"binary-expr","locations":[{"start":{"line":31,"column":10},"end":{"line":31,"column":40}},{"start":{"line":31,"column":44},"end":{"line":31,"column":83}},{"start":{"line":32,"column":10},"end":{"line":32,"column":43}},{"start":{"line":32,"column":47},"end":{"line":32,"column":97}}]},"3":{"line":34,"type":"binary-expr","locations":[{"start":{"line":34,"column":21},"end":{"line":34,"column":45}},{"start":{"line":34,"column":49},"end":{"line":34,"column":62}}]},"4":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":6},"end":{"line":39,"column":6}},{"start":{"line":39,"column":6},"end":{"line":39,"column":6}}]},"5":{"line":53,"type":"binary-expr","locations":[{"start":{"line":53,"column":15},"end":{"line":77,"column":14}},{"start":{"line":77,"column":18},"end":{"line":77,"column":20}}]},"6":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":10},"end":{"line":57,"column":10}},{"start":{"line":57,"column":10},"end":{"line":57,"column":10}}]},"7":{"line":62,"type":"if","locations":[{"start":{"line":62,"column":15},"end":{"line":62,"column":15}},{"start":{"line":62,"column":15},"end":{"line":62,"column":15}}]}},"code":["/**"," * Module dependencies."," */","","var _ = require('@sailshq/lodash');","var path = require('path');","var DEFAULT_HOOKS = require('./default-hooks');","","module.exports = function(sails) {","","  /**","   * Expose new instance of `Configuration`","   */","","  return new Configuration();","","","  function Configuration() {","","","    /**","     * Sails default configuration","     *","     * @api private","     */","    this.defaults = function defaultConfig(appPath) {","","      var defaultEnv;","      // If we're not loading the userconfig hook, which normally takes care","      // of ensuring that we have an environment, then make sure we set one here.","      if (_.isObject(sails.config.hooks) && sails.config.hooks.userconfig === false ||","         (_.isArray(sails.config.loadHooks) && sails.config.loadHooks.indexOf('userconfig') == -1)","      ) {","        defaultEnv = sails.config.environment || \"development\";","      }","","      // If `appPath` not specified, unfortunately, this is a fatal error,","      // since reasonable defaults cannot be assumed","      if (!appPath) {","        throw new Error('No `appPath` specified!');","      }","","      // Set up config defaults","      return {","","        environment: defaultEnv,","","        // Note: to avoid confusion re: timing, `hooks` configuration may eventually be removed","        // from `sails.config` in favor of something more flexible / obvious, e.g. the `app` object","        // itself (i.e. because you can't configure hooks in `userconfig`-- only in `overrides`).","","        // Core (default) hooks","        hooks: _.reduce(DEFAULT_HOOKS, function (memo, hookBundled, hookIdentity) {","","          // if `true`, then the core hook is bundled in the `lib/hooks/` directory","          // as `lib/hooks/HOOK_IDENTITY`.","          if (hookBundled === true) {","            memo[hookIdentity] = require('../../hooks/'+hookIdentity);","          }","          // if it's a string, then the core hook is an NPM dependency of sails,","          // so require it (which grabs it from `node_modules/`)","          else if (_.isString(hookBundled)) {","            var hook;","            try {","              hook = require(hookBundled);","            }","            catch (e) {","              throw new Error('Sails internal error: Could not require(\\''+hookBundled+'\\')');","            }","            memo[hookIdentity] = hook;","          }","          // otherwise freak out","          else {","            throw new Error('Sails internal error: \"'+hookIdentity+'\", a core hook, is invalid!');","          }","          return memo;","        }, {}) || {},","","        // Save appPath in implicit defaults","        // appPath is passed from above in case `sails lift` was used","        // This is the directory where this Sails process is being initiated from.","        // (  usually this means `process.cwd()`  )","        appPath: appPath,","","        // Built-in path defaults","        paths: {","          tmp: path.resolve(appPath, '.tmp')","        },","","        // Start off `routes` and `middleware` as empty objects","        routes: {},","        middleware: {}","","      };","    },","","","","    /**","     * Load the configuration modules","     *","     * @api private","     */","","    this.load = require('./load')(sails);","","","","    // Bind the context of all instance methods","    _.bindAll(this);","","  }","","};",""],"l":{"5":1,"6":1,"7":1,"9":1,"15":2,"18":1,"26":2,"28":0,"31":0,"34":0,"39":0,"40":0,"44":0,"57":0,"58":0,"62":0,"63":0,"64":0,"65":0,"68":0,"70":0,"74":0,"76":0,"110":2}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/configuration/default-hooks.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/configuration/default-hooks.js","s":{"1":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":10,"column":0},"end":{"line":31,"column":2}}},"branchMap":{},"code":["/**"," * Default hooks"," *"," * (order still matters for now for some of these-"," *  but mostly not, due to ouruse of events..."," *  ...but for a few core hooks, e.g. `moduleloader`,"," *  it still does.)"," */","","module.exports = {","  'moduleloader': true,","  'logger': true,","  'request': true,","  'orm': 'sails-hook-orm',","  'views': true,","  'blueprints': true,","  'responses': true,","  'controllers': true,","  'sockets': 'sails-hook-sockets',","  'pubsub': true,","  'policies': true,","  'services': true,","  'csrf': true,","  'cors': true,","  'i18n': true,","  'userconfig': true,","  'session': true,","  'grunt': true,","  'http': true,","  'userhooks': true","};",""],"l":{"10":1}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/loadHooks.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/loadHooks.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":2,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":1,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0},"b":{"1":[0,0],"2":[0,0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0]},"f":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},"fnMap":{"1":{"name":"(anonymous_1)","line":6,"loc":{"start":{"line":6,"column":17},"end":{"line":6,"column":33}}},"2":{"name":"initializeHooks","line":15,"loc":{"start":{"line":15,"column":9},"end":{"line":15,"column":45}}},"3":{"name":"prepareHook","line":17,"loc":{"start":{"line":17,"column":4},"end":{"line":17,"column":29}}},"4":{"name":"applyDefaults","line":60,"loc":{"start":{"line":60,"column":4},"end":{"line":60,"column":33}}},"5":{"name":"loadHook","line":75,"loc":{"start":{"line":75,"column":4},"end":{"line":75,"column":30}}},"6":{"name":"tooLong","line":80,"loc":{"start":{"line":80,"column":33},"end":{"line":80,"column":52}}},"7":{"name":"(anonymous_7)","line":90,"loc":{"start":{"line":90,"column":21},"end":{"line":90,"column":35}}},"8":{"name":"(anonymous_8)","line":113,"loc":{"start":{"line":113,"column":22},"end":{"line":113,"column":35}}},"9":{"name":"(anonymous_9)","line":124,"loc":{"start":{"line":124,"column":20},"end":{"line":124,"column":33}}},"10":{"name":"(anonymous_10)","line":136,"loc":{"start":{"line":136,"column":19},"end":{"line":136,"column":32}}},"11":{"name":"(anonymous_11)","line":147,"loc":{"start":{"line":147,"column":17},"end":{"line":147,"column":30}}},"12":{"name":"(anonymous_12)","line":148,"loc":{"start":{"line":148,"column":90},"end":{"line":148,"column":108}}},"13":{"name":"(anonymous_13)","line":156,"loc":{"start":{"line":156,"column":18},"end":{"line":156,"column":31}}},"14":{"name":"(anonymous_14)","line":157,"loc":{"start":{"line":157,"column":90},"end":{"line":157,"column":108}}},"15":{"name":"(anonymous_15)","line":166,"loc":{"start":{"line":166,"column":19},"end":{"line":166,"column":32}}},"16":{"name":"(anonymous_16)","line":167,"loc":{"start":{"line":167,"column":90},"end":{"line":167,"column":108}}},"17":{"name":"(anonymous_17)","line":180,"loc":{"start":{"line":180,"column":14},"end":{"line":180,"column":27}}},"18":{"name":"(anonymous_18)","line":181,"loc":{"start":{"line":181,"column":90},"end":{"line":181,"column":108}}},"19":{"name":"hooksReady","line":188,"loc":{"start":{"line":188,"column":6},"end":{"line":188,"column":31}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":35}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":29}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":37}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":45}},"5":{"start":{"line":6,"column":0},"end":{"line":192,"column":2}},"6":{"start":{"line":8,"column":2},"end":{"line":8,"column":28}},"7":{"start":{"line":15,"column":2},"end":{"line":191,"column":4}},"8":{"start":{"line":17,"column":4},"end":{"line":57,"column":5}},"9":{"start":{"line":19,"column":6},"end":{"line":19,"column":36}},"10":{"start":{"line":22,"column":6},"end":{"line":25,"column":7}},"11":{"start":{"line":23,"column":8},"end":{"line":23,"column":25}},"12":{"start":{"line":24,"column":8},"end":{"line":24,"column":15}},"13":{"start":{"line":28,"column":6},"end":{"line":30,"column":7}},"14":{"start":{"line":29,"column":8},"end":{"line":29,"column":115}},"15":{"start":{"line":34,"column":6},"end":{"line":36,"column":7}},"16":{"start":{"line":35,"column":8},"end":{"line":35,"column":44}},"17":{"start":{"line":38,"column":6},"end":{"line":42,"column":7}},"18":{"start":{"line":39,"column":8},"end":{"line":39,"column":56}},"19":{"start":{"line":40,"column":8},"end":{"line":40,"column":82}},"20":{"start":{"line":41,"column":8},"end":{"line":41,"column":24}},"21":{"start":{"line":45,"column":6},"end":{"line":45,"column":37}},"22":{"start":{"line":48,"column":6},"end":{"line":48,"column":38}},"23":{"start":{"line":53,"column":6},"end":{"line":53,"column":62}},"24":{"start":{"line":56,"column":6},"end":{"line":56,"column":32}},"25":{"start":{"line":60,"column":4},"end":{"line":72,"column":5}},"26":{"start":{"line":62,"column":6},"end":{"line":64,"column":37}},"27":{"start":{"line":66,"column":6},"end":{"line":69,"column":7}},"28":{"start":{"line":67,"column":8},"end":{"line":67,"column":68}},"29":{"start":{"line":68,"column":8},"end":{"line":68,"column":43}},"30":{"start":{"line":71,"column":6},"end":{"line":71,"column":43}},"31":{"start":{"line":75,"column":4},"end":{"line":108,"column":5}},"32":{"start":{"line":77,"column":6},"end":{"line":77,"column":163}},"33":{"start":{"line":78,"column":6},"end":{"line":78,"column":22}},"34":{"start":{"line":79,"column":6},"end":{"line":89,"column":7}},"35":{"start":{"line":80,"column":8},"end":{"line":88,"column":28}},"36":{"start":{"line":81,"column":10},"end":{"line":84,"column":82}},"37":{"start":{"line":85,"column":10},"end":{"line":85,"column":51}},"38":{"start":{"line":86,"column":10},"end":{"line":86,"column":38}},"39":{"start":{"line":87,"column":10},"end":{"line":87,"column":18}},"40":{"start":{"line":90,"column":6},"end":{"line":107,"column":9}},"41":{"start":{"line":91,"column":8},"end":{"line":93,"column":9}},"42":{"start":{"line":92,"column":10},"end":{"line":92,"column":36}},"43":{"start":{"line":94,"column":8},"end":{"line":100,"column":9}},"44":{"start":{"line":95,"column":10},"end":{"line":97,"column":11}},"45":{"start":{"line":96,"column":12},"end":{"line":96,"column":69}},"46":{"start":{"line":98,"column":10},"end":{"line":98,"column":46}},"47":{"start":{"line":99,"column":10},"end":{"line":99,"column":25}},"48":{"start":{"line":102,"column":8},"end":{"line":102,"column":59}},"49":{"start":{"line":103,"column":8},"end":{"line":103,"column":45}},"50":{"start":{"line":106,"column":8},"end":{"line":106,"column":29}},"51":{"start":{"line":110,"column":4},"end":{"line":190,"column":9}},"52":{"start":{"line":114,"column":10},"end":{"line":116,"column":11}},"53":{"start":{"line":115,"column":12},"end":{"line":115,"column":24}},"54":{"start":{"line":117,"column":10},"end":{"line":117,"column":38}},"55":{"start":{"line":118,"column":10},"end":{"line":118,"column":47}},"56":{"start":{"line":119,"column":10},"end":{"line":119,"column":44}},"57":{"start":{"line":120,"column":10},"end":{"line":120,"column":39}},"58":{"start":{"line":125,"column":10},"end":{"line":127,"column":11}},"59":{"start":{"line":126,"column":12},"end":{"line":126,"column":24}},"60":{"start":{"line":128,"column":10},"end":{"line":128,"column":36}},"61":{"start":{"line":129,"column":10},"end":{"line":129,"column":45}},"62":{"start":{"line":130,"column":10},"end":{"line":130,"column":42}},"63":{"start":{"line":131,"column":10},"end":{"line":131,"column":37}},"64":{"start":{"line":137,"column":10},"end":{"line":139,"column":11}},"65":{"start":{"line":138,"column":12},"end":{"line":138,"column":24}},"66":{"start":{"line":140,"column":10},"end":{"line":140,"column":35}},"67":{"start":{"line":141,"column":10},"end":{"line":141,"column":44}},"68":{"start":{"line":142,"column":10},"end":{"line":142,"column":41}},"69":{"start":{"line":143,"column":10},"end":{"line":143,"column":36}},"70":{"start":{"line":148,"column":10},"end":{"line":152,"column":17}},"71":{"start":{"line":149,"column":12},"end":{"line":149,"column":28}},"72":{"start":{"line":151,"column":12},"end":{"line":151,"column":33}},"73":{"start":{"line":157,"column":10},"end":{"line":162,"column":17}},"74":{"start":{"line":158,"column":12},"end":{"line":158,"column":33}},"75":{"start":{"line":159,"column":12},"end":{"line":159,"column":32}},"76":{"start":{"line":161,"column":12},"end":{"line":161,"column":33}},"77":{"start":{"line":167,"column":10},"end":{"line":176,"column":17}},"78":{"start":{"line":168,"column":12},"end":{"line":168,"column":33}},"79":{"start":{"line":169,"column":12},"end":{"line":173,"column":13}},"80":{"start":{"line":170,"column":14},"end":{"line":170,"column":31}},"81":{"start":{"line":172,"column":14},"end":{"line":172,"column":27}},"82":{"start":{"line":175,"column":12},"end":{"line":175,"column":33}},"83":{"start":{"line":181,"column":10},"end":{"line":184,"column":17}},"84":{"start":{"line":182,"column":12},"end":{"line":182,"column":51}},"85":{"start":{"line":183,"column":12},"end":{"line":183,"column":29}},"86":{"start":{"line":189,"column":8},"end":{"line":189,"column":23}}},"branchMap":{"1":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":6},"end":{"line":22,"column":6}},{"start":{"line":22,"column":6},"end":{"line":22,"column":6}}]},"2":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":10},"end":{"line":22,"column":33}},{"start":{"line":22,"column":37},"end":{"line":22,"column":62}},{"start":{"line":22,"column":66},"end":{"line":22,"column":99}}]},"3":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":6},"end":{"line":28,"column":6}},{"start":{"line":28,"column":6},"end":{"line":28,"column":6}}]},"4":{"line":28,"type":"binary-expr","locations":[{"start":{"line":28,"column":10},"end":{"line":28,"column":26}},{"start":{"line":28,"column":30},"end":{"line":28,"column":49}}]},"5":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":6},"end":{"line":34,"column":6}},{"start":{"line":34,"column":6},"end":{"line":34,"column":6}}]},"6":{"line":34,"type":"binary-expr","locations":[{"start":{"line":34,"column":10},"end":{"line":34,"column":35}},{"start":{"line":34,"column":39},"end":{"line":34,"column":64}},{"start":{"line":34,"column":68},"end":{"line":34,"column":96}}]},"7":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":6},"end":{"line":38,"column":6}},{"start":{"line":38,"column":6},"end":{"line":38,"column":6}}]},"8":{"line":53,"type":"binary-expr","locations":[{"start":{"line":53,"column":22},"end":{"line":53,"column":45}},{"start":{"line":53,"column":49},"end":{"line":53,"column":61}}]},"9":{"line":62,"type":"binary-expr","locations":[{"start":{"line":62,"column":22},"end":{"line":64,"column":29}},{"start":{"line":64,"column":34},"end":{"line":64,"column":36}}]},"10":{"line":62,"type":"cond-expr","locations":[{"start":{"line":63,"column":16},"end":{"line":63,"column":43}},{"start":{"line":64,"column":16},"end":{"line":64,"column":29}}]},"11":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":6},"end":{"line":66,"column":6}},{"start":{"line":66,"column":6},"end":{"line":66,"column":6}}]},"12":{"line":66,"type":"binary-expr","locations":[{"start":{"line":66,"column":10},"end":{"line":66,"column":37}},{"start":{"line":66,"column":41},"end":{"line":66,"column":55}}]},"13":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":29},"end":{"line":77,"column":68}},{"start":{"line":77,"column":72},"end":{"line":77,"column":124}},{"start":{"line":77,"column":129},"end":{"line":77,"column":153}},{"start":{"line":77,"column":157},"end":{"line":77,"column":162}}]},"14":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":42},"end":{"line":77,"column":61}},{"start":{"line":77,"column":65},"end":{"line":77,"column":67}}]},"15":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":85},"end":{"line":77,"column":104}},{"start":{"line":77,"column":108},"end":{"line":77,"column":110}}]},"16":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":6},"end":{"line":79,"column":6}},{"start":{"line":79,"column":6},"end":{"line":79,"column":6}}]},"17":{"line":83,"type":"binary-expr","locations":[{"start":{"line":83,"column":44},"end":{"line":83,"column":63}},{"start":{"line":83,"column":67},"end":{"line":83,"column":69}}]},"18":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":8},"end":{"line":91,"column":8}},{"start":{"line":91,"column":8},"end":{"line":91,"column":8}}]},"19":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":8},"end":{"line":94,"column":8}},{"start":{"line":94,"column":8},"end":{"line":94,"column":8}}]},"20":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":10},"end":{"line":95,"column":10}},{"start":{"line":95,"column":10},"end":{"line":95,"column":10}}]},"21":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":10},"end":{"line":114,"column":10}},{"start":{"line":114,"column":10},"end":{"line":114,"column":10}}]},"22":{"line":125,"type":"if","locations":[{"start":{"line":125,"column":10},"end":{"line":125,"column":10}},{"start":{"line":125,"column":10},"end":{"line":125,"column":10}}]},"23":{"line":137,"type":"if","locations":[{"start":{"line":137,"column":10},"end":{"line":137,"column":10}},{"start":{"line":137,"column":10},"end":{"line":137,"column":10}}]}},"code":["var _ = require('@sailshq/lodash');","var async = require('async');","var __hooks = require('../../hooks');","var defaultsDeep = require('merge-defaults');","","module.exports = function(sails) {","","  var Hook = __hooks(sails);","","  /**","   * Resolve the hook definitions and then finish loading them","   *","   * @api private","   */","  return function initializeHooks(hooks, cb) {","","    function prepareHook(id) {","","      var hookPrototype = hooks[id];","","      // Allow disabling of hooks by setting them to \"false\"","      if (hookPrototype === false || hookPrototype === 'false' || hooks[id.split('.')[0]] === false) {","        delete hooks[id];","        return;","      }","","      // Check for invalid hook config","      if (hooks.userconfig && !hooks.moduleloader) {","        return cb('Invalid configuration:: Cannot use the `userconfig` hook w/o the `moduleloader` hook enabled!');","      }","","      // Handle folder-defined modules (default to index.js)","      // Since a hook definition must be a function","      if (_.isObject(hookPrototype) && !_.isArray(hookPrototype) && !_.isFunction(hookPrototype)) {","        hookPrototype = hookPrototype.index;","      }","","      if (!_.isFunction(hookPrototype)) {","        sails.log.error('Malformed hook! (' + id + ')');","        sails.log.error('Hooks should be a function with one argument (`sails`)');","        process.exit(1);","      }","","      // Instantiate the hook","      var def = hookPrototype(sails);","","      // Mix in an `identity` property to hook definition","      def.identity = id.toLowerCase();","","      // If a config key was defined for this hook when it was loaded,","      // (probably because a user is overridding the default config key)","      // set it on the hook definition","      def.configKey = hookPrototype.configKey || def.identity;","","      // New up an actual Hook instance","      hooks[id] = new Hook(def);","    }","","    // Function to apply a hook's \"defaults\" obj or function","    function applyDefaults(hook) {","      // Get the hook defaults","      var defaults = (_.isFunction(hook.defaults) ?","                hook.defaults(sails.config) :","                hook.defaults) || {};","      // Replace the special __configKey__ key with the actual config key","      if (hook.defaults.__configKey__ && hook.configKey) {","        hook.defaults[hook.configKey] = hook.defaults.__configKey__;","        delete hook.defaults.__configKey__;","      }","","      defaultsDeep(sails.config, defaults);","    }","","    // Load a hook (bind its routes, load any modules and initialize it)","    function loadHook(id, cb) {","","      var timeoutInterval = (sails.config[hooks[id].configKey || id] && sails.config[hooks[id].configKey || id]._hookTimeout) || sails.config.hookTimeout || 20000;","      var hookTimeout;","      if (id != 'userhooks') {","        hookTimeout = setTimeout(function tooLong() {","          var hooksTookTooLongErr = 'The hook `'+id+'` is taking too long to load.\\n' +","            'Make sure it is triggering its `initialize()` callback, ' +","            'or else set `sails.config.' + (hooks[id].configKey || id) +","            '._hookTimeout to a higher value (currently ' + timeoutInterval + ')';","          var err = new Error(hooksTookTooLongErr);","          err.code = 'E_HOOK_TIMEOUT';","          cb(err);","        }, timeoutInterval);","      }","      hooks[id].load(function(err) {","        if (id != 'userhooks') {","          clearTimeout(hookTimeout);","        }","        if (err) {","          if (id != 'userhooks') {","            sails.log.error('A hook (`' + id + '`) failed to load!');","          }","          sails.emit('hook:' + id + ':error');","          return cb(err);","        }","","        sails.log.verbose(id, 'hook loaded successfully.');","        sails.emit('hook:' + id + ':loaded');","","        // Defer to next tick to allow other stuff to happen","        process.nextTick(cb);","      });","    }","","    async.series({","","        // First load the moduleloader (if any)","        moduleloader: function(cb) {","          if (!hooks.moduleloader) {","            return cb();","          }","          prepareHook('moduleloader');","          applyDefaults(hooks['moduleloader']);","          hooks['moduleloader'].configure();","          loadHook('moduleloader', cb);","        },","","        // Next load the user config (if any)","        userconfig: function(cb) {","          if (!hooks.userconfig) {","            return cb();","          }","          prepareHook('userconfig');","          applyDefaults(hooks['userconfig']);","          hooks['userconfig'].configure();","          loadHook('userconfig', cb);","        },","","        // Next get the user hooks (if any), which will be","        // added to the list of hooks to load","        userhooks: function(cb) {","          if (!hooks.userhooks) {","            return cb();","          }","          prepareHook('userhooks');","          applyDefaults(hooks['userhooks']);","          hooks['userhooks'].configure();","          loadHook('userhooks', cb);","        },","","        // Prepare all other hooks","        prepare: function(cb) {","          async.each(_.without(_.keys(hooks), 'userconfig', 'moduleloader', 'userhooks'), function (id, cb) {","            prepareHook(id);","            // Defer to next tick to allow other stuff to happen","            process.nextTick(cb);","          }, cb);","        },","","        // Apply the default config for all other hooks","        defaults: function(cb) {","          async.each(_.without(_.keys(hooks), 'userconfig', 'moduleloader', 'userhooks'), function (id, cb) {","            var hook = hooks[id];","            applyDefaults(hook);","            // Defer to next tick to allow other stuff to happen","            process.nextTick(cb);","          }, cb);","        },","","        // Run configuration method for all other hooks","        configure: function(cb) {","          async.each(_.without(_.keys(hooks), 'userconfig', 'moduleloader', 'userhooks'), function (id, cb) {","            var hook = hooks[id];","            try {","              hook.configure();","            } catch (e) {","              return cb(e);","            }","            // Defer to next tick to allow other stuff to happen","            process.nextTick(cb);","          }, cb);","        },","","        // Load all other hooks","        load: function(cb) {","          async.each(_.without(_.keys(hooks), 'userconfig', 'moduleloader', 'userhooks'), function (id, cb) {","            sails.log.silly('Loading hook: ' + id);","            loadHook(id, cb);","          }, cb);","        }","      },","","      function hooksReady(err) {","        return cb(err);","      });","  };","};",""],"l":{"1":1,"2":1,"3":1,"4":1,"6":1,"8":2,"15":2,"17":1,"19":0,"22":0,"23":0,"24":0,"28":0,"29":0,"34":0,"35":0,"38":0,"39":0,"40":0,"41":0,"45":0,"48":0,"53":0,"56":0,"60":1,"62":0,"66":0,"67":0,"68":0,"71":0,"75":1,"77":0,"78":0,"79":0,"80":0,"81":0,"85":0,"86":0,"87":0,"90":0,"91":0,"92":0,"94":0,"95":0,"96":0,"98":0,"99":0,"102":0,"103":0,"106":0,"110":0,"114":0,"115":0,"117":0,"118":0,"119":0,"120":0,"125":0,"126":0,"128":0,"129":0,"130":0,"131":0,"137":0,"138":0,"140":0,"141":0,"142":0,"143":0,"148":0,"149":0,"151":0,"157":0,"158":0,"159":0,"161":0,"167":0,"168":0,"169":0,"170":0,"172":0,"175":0,"181":0,"182":0,"183":0,"189":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/hooks/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/hooks/index.js","s":{"1":1,"2":1,"3":1,"4":2,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":1,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0]},"f":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},"fnMap":{"1":{"name":"(anonymous_1)","line":11,"loc":{"start":{"line":11,"column":17},"end":{"line":11,"column":33}}},"2":{"name":"Hook","line":20,"loc":{"start":{"line":20,"column":9},"end":{"line":20,"column":35}}},"3":{"name":"(anonymous_3)","line":44,"loc":{"start":{"line":44,"column":16},"end":{"line":44,"column":29}}},"4":{"name":"(anonymous_4)","line":48,"loc":{"start":{"line":48,"column":27},"end":{"line":48,"column":44}}},"5":{"name":"(anonymous_5)","line":49,"loc":{"start":{"line":49,"column":23},"end":{"line":49,"column":51}}},"6":{"name":"(anonymous_6)","line":63,"loc":{"start":{"line":63,"column":32},"end":{"line":63,"column":43}}},"7":{"name":"(anonymous_7)","line":68,"loc":{"start":{"line":68,"column":31},"end":{"line":68,"column":42}}},"8":{"name":"(anonymous_8)","line":75,"loc":{"start":{"line":75,"column":17},"end":{"line":75,"column":30}}},"9":{"name":"(anonymous_9)","line":85,"loc":{"start":{"line":85,"column":9},"end":{"line":85,"column":23}}},"10":{"name":"(anonymous_10)","line":108,"loc":{"start":{"line":108,"column":20},"end":{"line":108,"column":37}}},"11":{"name":"(anonymous_11)","line":124,"loc":{"start":{"line":124,"column":21},"end":{"line":124,"column":32}}},"12":{"name":"(anonymous_12)","line":138,"loc":{"start":{"line":138,"column":23},"end":{"line":138,"column":36}}},"13":{"name":"(anonymous_13)","line":153,"loc":{"start":{"line":153,"column":22},"end":{"line":153,"column":35}}},"14":{"name":"_normalize","line":182,"loc":{"start":{"line":182,"column":4},"end":{"line":182,"column":29}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":29}},"3":{"start":{"line":11,"column":0},"end":{"line":203,"column":2}},"4":{"start":{"line":20,"column":2},"end":{"line":201,"column":4}},"5":{"start":{"line":23,"column":4},"end":{"line":27,"column":5}},"6":{"start":{"line":26,"column":6},"end":{"line":26,"column":36}},"7":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"8":{"start":{"line":30,"column":6},"end":{"line":30,"column":122}},"9":{"start":{"line":32,"column":4},"end":{"line":34,"column":5}},"10":{"start":{"line":33,"column":6},"end":{"line":33,"column":126}},"11":{"start":{"line":44,"column":4},"end":{"line":94,"column":6}},"12":{"start":{"line":46,"column":6},"end":{"line":46,"column":22}},"13":{"start":{"line":48,"column":6},"end":{"line":53,"column":8}},"14":{"start":{"line":49,"column":8},"end":{"line":52,"column":11}},"15":{"start":{"line":50,"column":10},"end":{"line":50,"column":129}},"16":{"start":{"line":51,"column":10},"end":{"line":51,"column":47}},"17":{"start":{"line":56,"column":6},"end":{"line":60,"column":7}},"18":{"start":{"line":59,"column":8},"end":{"line":59,"column":20}},"19":{"start":{"line":63,"column":6},"end":{"line":65,"column":9}},"20":{"start":{"line":64,"column":8},"end":{"line":64,"column":43}},"21":{"start":{"line":68,"column":6},"end":{"line":70,"column":9}},"22":{"start":{"line":69,"column":8},"end":{"line":69,"column":42}},"23":{"start":{"line":73,"column":6},"end":{"line":92,"column":9}},"24":{"start":{"line":77,"column":12},"end":{"line":81,"column":13}},"25":{"start":{"line":79,"column":14},"end":{"line":79,"column":42}},"26":{"start":{"line":82,"column":12},"end":{"line":82,"column":24}},"27":{"start":{"line":86,"column":8},"end":{"line":86,"column":32}},"28":{"start":{"line":86,"column":17},"end":{"line":86,"column":32}},"29":{"start":{"line":87,"column":8},"end":{"line":91,"column":9}},"30":{"start":{"line":88,"column":10},"end":{"line":88,"column":30}},"31":{"start":{"line":90,"column":10},"end":{"line":90,"column":23}},"32":{"start":{"line":108,"column":4},"end":{"line":110,"column":6}},"33":{"start":{"line":109,"column":6},"end":{"line":109,"column":16}},"34":{"start":{"line":124,"column":4},"end":{"line":126,"column":6}},"35":{"start":{"line":138,"column":4},"end":{"line":140,"column":6}},"36":{"start":{"line":139,"column":6},"end":{"line":139,"column":18}},"37":{"start":{"line":153,"column":4},"end":{"line":155,"column":6}},"38":{"start":{"line":154,"column":6},"end":{"line":154,"column":18}},"39":{"start":{"line":160,"column":4},"end":{"line":160,"column":21}},"40":{"start":{"line":161,"column":4},"end":{"line":161,"column":40}},"41":{"start":{"line":164,"column":4},"end":{"line":164,"column":64}},"42":{"start":{"line":165,"column":4},"end":{"line":165,"column":76}},"43":{"start":{"line":166,"column":4},"end":{"line":166,"column":85}},"44":{"start":{"line":167,"column":4},"end":{"line":167,"column":82}},"45":{"start":{"line":168,"column":4},"end":{"line":168,"column":31}},"46":{"start":{"line":171,"column":4},"end":{"line":171,"column":20}},"47":{"start":{"line":182,"column":4},"end":{"line":200,"column":5}},"48":{"start":{"line":184,"column":6},"end":{"line":184,"column":22}},"49":{"start":{"line":187,"column":6},"end":{"line":187,"column":36}},"50":{"start":{"line":190,"column":6},"end":{"line":190,"column":46}},"51":{"start":{"line":192,"column":6},"end":{"line":192,"column":44}},"52":{"start":{"line":195,"column":6},"end":{"line":195,"column":36}},"53":{"start":{"line":196,"column":6},"end":{"line":196,"column":50}},"54":{"start":{"line":197,"column":6},"end":{"line":197,"column":48}},"55":{"start":{"line":199,"column":6},"end":{"line":199,"column":17}}},"branchMap":{"1":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":23,"column":4}},{"start":{"line":23,"column":4},"end":{"line":23,"column":4}}]},"2":{"line":26,"type":"binary-expr","locations":[{"start":{"line":26,"column":19},"end":{"line":26,"column":29}},{"start":{"line":26,"column":33},"end":{"line":26,"column":35}}]},"3":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":29,"column":4}},{"start":{"line":29,"column":4},"end":{"line":29,"column":4}}]},"4":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":4},"end":{"line":32,"column":4}},{"start":{"line":32,"column":4},"end":{"line":32,"column":4}}]},"5":{"line":50,"type":"cond-expr","locations":[{"start":{"line":50,"column":99},"end":{"line":50,"column":121}},{"start":{"line":50,"column":125},"end":{"line":50,"column":127}}]},"6":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":6},"end":{"line":56,"column":6}},{"start":{"line":56,"column":6},"end":{"line":56,"column":6}}]},"7":{"line":56,"type":"binary-expr","locations":[{"start":{"line":56,"column":10},"end":{"line":56,"column":26}},{"start":{"line":57,"column":8},"end":{"line":57,"column":35}},{"start":{"line":58,"column":8},"end":{"line":58,"column":65}}]},"8":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":12},"end":{"line":77,"column":12}},{"start":{"line":77,"column":12},"end":{"line":77,"column":12}}]},"9":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":8},"end":{"line":86,"column":8}},{"start":{"line":86,"column":8},"end":{"line":86,"column":8}}]},"10":{"line":184,"type":"binary-expr","locations":[{"start":{"line":184,"column":12},"end":{"line":184,"column":15}},{"start":{"line":184,"column":19},"end":{"line":184,"column":21}}]},"11":{"line":187,"type":"binary-expr","locations":[{"start":{"line":187,"column":19},"end":{"line":187,"column":29}},{"start":{"line":187,"column":33},"end":{"line":187,"column":35}}]},"12":{"line":190,"type":"binary-expr","locations":[{"start":{"line":190,"column":24},"end":{"line":190,"column":39}},{"start":{"line":190,"column":43},"end":{"line":190,"column":45}}]},"13":{"line":192,"type":"binary-expr","locations":[{"start":{"line":192,"column":23},"end":{"line":192,"column":37}},{"start":{"line":192,"column":41},"end":{"line":192,"column":43}}]},"14":{"line":195,"type":"binary-expr","locations":[{"start":{"line":195,"column":19},"end":{"line":195,"column":29}},{"start":{"line":195,"column":33},"end":{"line":195,"column":35}}]},"15":{"line":196,"type":"binary-expr","locations":[{"start":{"line":196,"column":26},"end":{"line":196,"column":43}},{"start":{"line":196,"column":47},"end":{"line":196,"column":49}}]},"16":{"line":197,"type":"binary-expr","locations":[{"start":{"line":197,"column":25},"end":{"line":197,"column":41}},{"start":{"line":197,"column":45},"end":{"line":197,"column":47}}]}},"code":["/**"," * Module dependencies."," */","","var _ = require('@sailshq/lodash');","var async = require('async');","","","","","module.exports = function(sails) {","","","  /**","   * Expose hook constructor","   *","   * @api private","   */","","  return function Hook(definition) {","","    // A few sanity checks to make sure te provided definition does not contain any reserved properties.","    if (!_.isObject(definition)) {","      // This particular behavior can be made a bit less genteel in future versions (it is currently","      // forgiving for backwards compatibility)","      definition = definition || {};","    }","    ","    if (_.isFunction(definition.config)) {","      throw new Error('Error defining hook: `config` is a reserved property and cannot be used as a custom hook method.');","    }","    if (_.isFunction(definition.middleware)) {","      throw new Error('Error defining hook: `middleware` is a reserved property and cannot be used as a custom hook method.');","    }","    ","","","    /**","     * Load the hook asynchronously","     *","     * @api private","     */","","    this.load = function(cb) {","","      var self = this;","","      var routeCallbacks = function(routes) {","        _.each(routes, function(middleware, route) {","          middleware._middlewareType = self.identity.toUpperCase() + ' HOOK' + (middleware.name ? (': ' + middleware.name) : '');","          sails.router.bind(route, middleware);","        });","      };","","      // Determine if this hook should load based on Sails environment & hook config","      if (this.config.envs &&","        this.config.envs.length > 0 &&","        this.config.envs.indexOf(sails.config.environment) === -1) {","        return cb();","      }","","      // Convenience config to bind routes before any of the static app routes","      sails.on('router:before', function() {","        routeCallbacks(self.routes.before);","      });","","      // Convenience config to bind routes after the static app routes","      sails.on('router:after', function() {","        routeCallbacks(self.routes.after);","      });","","      // Run loadModules method if moduleloader is loaded","      async.auto({","","        modules: function(cb) {","","            if (sails.config.hooks.moduleloader) {","","              return self.loadModules(cb);","","            }","            return cb();","          }","","      }, function(err) {","        if (err) return cb(err);","        try {","          self.initialize(cb);","        } catch(e) {","          return cb(e);","        }","      });","","    };","","","","    /**","     * `defaults`","     *","     * Default configuration for this hook.","     *","     * Hooks may override this function, or use a dictionary instead.","     *","     * @type {Function|Dictionary}","     *       @returns {Dictionary} [default configuration for this hook to be merged into sails.config]","     */","    this.defaults = function(config) {","      return {};","    };","","    /**","     * `configure`","     *","     * If this hook provides this function, the provided implementation should","     * normalize and validate configuration related to this hook.  That config is","     * already in `sails.config` at the time this function is called.  Any modifications","     * should be made in place on `sails.config`","     *","     * Hooks may override this function.","     *","     * @type {Function}","     */","    this.configure = function() {","","    };","","    /**","     * `loadModules`","     *","     * Load any modules as a dictionary and pass the loaded modules to the callback when finished.","     *","     * Hooks may override this function (This runs before `initialize()`!)","     *","     * @type {Function}","     * @async","     */","    this.loadModules = function(cb) {","      return cb();","    };","","","    /**","     * `initialize`","     *","     * If provided, this implementation should prepare the hook, then trigger the callback.","     *","     * Hooks may override this function.","     *","     * @type {Function}","     * @async","     */","    this.initialize = function(cb) {","      return cb();","    };","","","","    // Ensure that the hook definition has valid properties","    _normalize(this);","    definition = _normalize(definition);","","    // Merge default definition with overrides in the definition passed in","    _.extend(definition.config, this.config, definition.config);","    _.extend(definition.middleware, this.middleware, definition.middleware);","    _.extend(definition.routes.before, this.routes.before, definition.routes.before);","    _.extend(definition.routes.after, this.routes.after, definition.routes.after);","    _.extend(this, definition);","","    // Bind context of new methods from definition","    _.bindAll(this);","","","","    /**","     * Ensure that a hook definition has the required properties.","     * ","     * @returns {Dictionary} [coerced hook definition]","     * @api private","     */","","    function _normalize(def) {","","      def = def || {};","","      // Default hook config","      def.config = def.config || {};","","      // list of environments to run in, if empty defaults to all","      def.config.envs = def.config.envs || [];","","      def.middleware = def.middleware || {};","","      // Default hook routes","      def.routes = def.routes || {};","      def.routes.before = def.routes.before || {};","      def.routes.after = def.routes.after || {};","","      return def;","    }","  };","","};",""],"l":{"5":1,"6":1,"11":1,"20":2,"23":0,"26":0,"29":0,"30":0,"32":0,"33":0,"44":0,"46":0,"48":0,"49":0,"50":0,"51":0,"56":0,"59":0,"63":0,"64":0,"68":0,"69":0,"73":0,"77":0,"79":0,"82":0,"86":0,"87":0,"88":0,"90":0,"108":0,"109":0,"124":0,"138":0,"139":0,"153":0,"154":0,"160":0,"161":0,"164":0,"165":0,"166":0,"167":0,"168":0,"171":0,"182":1,"184":0,"187":0,"190":0,"192":0,"195":0,"196":0,"197":0,"199":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/after.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/after.js","s":{"1":1,"2":1,"3":1,"4":2,"5":2,"6":2,"7":0,"8":0,"9":0,"10":2,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"mixinAfter","line":27,"loc":{"start":{"line":27,"column":17},"end":{"line":27,"column":46}}},"2":{"name":"(anonymous_2)","line":47,"loc":{"start":{"line":47,"column":17},"end":{"line":47,"column":34}}},"3":{"name":"(anonymous_3)","line":64,"loc":{"start":{"line":64,"column":18},"end":{"line":64,"column":39}}},"4":{"name":"(anonymous_4)","line":74,"loc":{"start":{"line":74,"column":6},"end":{"line":74,"column":36}}},"5":{"name":"(anonymous_5)","line":76,"loc":{"start":{"line":76,"column":24},"end":{"line":76,"column":37}}},"6":{"name":"(anonymous_6)","line":89,"loc":{"start":{"line":89,"column":33},"end":{"line":89,"column":47}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":29}},"3":{"start":{"line":27,"column":0},"end":{"line":96,"column":2}},"4":{"start":{"line":36,"column":2},"end":{"line":36,"column":26}},"5":{"start":{"line":46,"column":2},"end":{"line":46,"column":27}},"6":{"start":{"line":47,"column":2},"end":{"line":51,"column":4}},"7":{"start":{"line":48,"column":4},"end":{"line":48,"column":56}},"8":{"start":{"line":49,"column":4},"end":{"line":49,"column":38}},"9":{"start":{"line":50,"column":4},"end":{"line":50,"column":31}},"10":{"start":{"line":64,"column":2},"end":{"line":94,"column":4}},"11":{"start":{"line":67,"column":4},"end":{"line":69,"column":5}},"12":{"start":{"line":68,"column":6},"end":{"line":68,"column":24}},"13":{"start":{"line":73,"column":4},"end":{"line":85,"column":13}},"14":{"start":{"line":76,"column":8},"end":{"line":82,"column":10}},"15":{"start":{"line":77,"column":10},"end":{"line":81,"column":11}},"16":{"start":{"line":78,"column":12},"end":{"line":78,"column":17}},"17":{"start":{"line":80,"column":12},"end":{"line":80,"column":36}},"18":{"start":{"line":83,"column":8},"end":{"line":83,"column":37}},"19":{"start":{"line":84,"column":8},"end":{"line":84,"column":28}},"20":{"start":{"line":89,"column":4},"end":{"line":92,"column":7}},"21":{"start":{"line":90,"column":6},"end":{"line":90,"column":36}},"22":{"start":{"line":90,"column":15},"end":{"line":90,"column":36}},"23":{"start":{"line":91,"column":6},"end":{"line":91,"column":18}}},"branchMap":{"1":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":4},"end":{"line":67,"column":4}},{"start":{"line":67,"column":4},"end":{"line":67,"column":4}}]},"2":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":10},"end":{"line":77,"column":10}},{"start":{"line":77,"column":10},"end":{"line":77,"column":10}}]},"3":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":6},"end":{"line":90,"column":6}},{"start":{"line":90,"column":6},"end":{"line":90,"column":6}}]}},"code":["/**"," * Module dependencies"," */","","var _ = require('@sailshq/lodash');","var async = require('async');","","","//","// TODO","// Pull this into a separate module, since it's not specific to Sails.","//","","","/**"," * Mix-in an `after` function to an EventEmitter."," *"," * If `events` have already fired, trigger fn immediately (with no args)"," * Otherwise bind a normal one-time event using `EventEmitter.prototype.once()`."," * Useful for checking whether or not something has finished loading, etc."," *"," * This is a lot like jQuery's `$(document).ready()`."," *"," * @param  {EventEmitter} emitter"," */","","module.exports = function mixinAfter(emitter) {","","","  /**","   * { emitter.warmEvents }","   *","   * Events which have occurred at least once","   * (Required to support `emitter.after()`)","   */","  emitter.warmEvents = {};","","","  /**","   * emitter.emit()","   *","   * Override `EventEmitter.prototype.emit`.","   * (Required to support `emitter.after()`)","   */","","  var _emit = emitter.emit;","  emitter.emit = function(evName) {","    var args = Array.prototype.slice.call(arguments, 0);","    emitter.warmEvents[evName] = true;","    _emit.apply(emitter, args);","  };","","","  /**","   * `emitter.after()`","   *","   * Fires your handler **IF THE SPECIFIED EVENT HAS ALREADY BEEN TRIGGERED** or **WHEN IT IS TRIGGERED**.","   *","   * @param  {String|Array} events   [name of the event(s)]","   * @param  {Function}     fn       [event handler function]","   * @context {Sails}","   */","","  emitter.after = function(events, fn) {","","    // Support a single event or an array of events","    if (!_.isArray(events)) {","      events = [events];","    }","","    // Convert named event dependencies into an array","    // of async-compatible functions.","    var dependencies = _.reduce(events,","      function(dependencies, event) {","","        var handlerFn = function(cb) {","          if (emitter.warmEvents[event]) {","            cb();","          } else {","            emitter.once(event, cb);","          }","        };","        dependencies.push(handlerFn);","        return dependencies;","      }, []);","","    // When all events have fired, call `fn`","    // (all arguments passed to `emit()` calls are discarded)","    async.parallel(dependencies, function(err) {","      if (err) sails.log.error(err);","      return fn();","    });","","  };","","};",""],"l":{"5":1,"6":1,"27":1,"36":2,"46":2,"47":2,"48":0,"49":0,"50":0,"64":2,"67":0,"68":0,"73":0,"76":0,"77":0,"78":0,"80":0,"83":0,"84":0,"89":0,"90":0,"91":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/router/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/router/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":2,"10":1,"11":2,"12":2,"13":2,"14":2,"15":2,"16":2,"17":2,"18":2,"19":2,"20":2,"21":2,"22":1,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":1,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":1,"76":1,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":1,"85":0,"86":0,"87":0,"88":0,"89":0,"90":1,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":1,"100":0,"101":0,"102":0,"103":0,"104":0,"105":1,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":1,"125":0,"126":0,"127":0,"128":1,"129":0,"130":0,"131":0},"b":{"1":[2,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0]},"f":{"1":2,"2":2,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},"fnMap":{"1":{"name":"(anonymous_1)","line":20,"loc":{"start":{"line":20,"column":17},"end":{"line":20,"column":33}}},"2":{"name":"Router","line":33,"loc":{"start":{"line":33,"column":0},"end":{"line":33,"column":25}}},"3":{"name":"(anonymous_3)","line":88,"loc":{"start":{"line":88,"column":24},"end":{"line":88,"column":37}}},"4":{"name":"(anonymous_4)","line":103,"loc":{"start":{"line":103,"column":39},"end":{"line":103,"column":50}}},"5":{"name":"(anonymous_5)","line":174,"loc":{"start":{"line":174,"column":25},"end":{"line":174,"column":44}}},"6":{"name":"_cbIsDeprecated","line":201,"loc":{"start":{"line":201,"column":12},"end":{"line":201,"column":42}}},"7":{"name":"(anonymous_7)","line":208,"loc":{"start":{"line":208,"column":20},"end":{"line":208,"column":35}}},"8":{"name":"(anonymous_8)","line":214,"loc":{"start":{"line":214,"column":27},"end":{"line":214,"column":40}}},"9":{"name":"(anonymous_9)","line":223,"loc":{"start":{"line":223,"column":28},"end":{"line":223,"column":43}}},"10":{"name":"(anonymous_10)","line":234,"loc":{"start":{"line":234,"column":28},"end":{"line":234,"column":43}}},"11":{"name":"handleUnmatchedNext","line":240,"loc":{"start":{"line":240,"column":42},"end":{"line":240,"column":76}}},"12":{"name":"(anonymous_12)","line":292,"loc":{"start":{"line":292,"column":26},"end":{"line":292,"column":42}}},"13":{"name":"(anonymous_13)","line":301,"loc":{"start":{"line":301,"column":51},"end":{"line":301,"column":74}}},"14":{"name":"(anonymous_14)","line":320,"loc":{"start":{"line":320,"column":25},"end":{"line":320,"column":36}}},"15":{"name":"(anonymous_15)","line":324,"loc":{"start":{"line":324,"column":37},"end":{"line":324,"column":66}}},"16":{"name":"(anonymous_16)","line":353,"loc":{"start":{"line":353,"column":25},"end":{"line":353,"column":42}}},"17":{"name":"(anonymous_17)","line":368,"loc":{"start":{"line":368,"column":30},"end":{"line":368,"column":53}}},"18":{"name":"qsParser","line":397,"loc":{"start":{"line":397,"column":0},"end":{"line":397,"column":32}}},"19":{"name":"bodyParser","line":408,"loc":{"start":{"line":408,"column":0},"end":{"line":408,"column":37}}},"20":{"name":"fileUploadsNotAvailable","line":413,"loc":{"start":{"line":413,"column":13},"end":{"line":413,"column":47}}},"21":{"name":"(anonymous_21)","line":428,"loc":{"start":{"line":428,"column":21},"end":{"line":428,"column":32}}},"22":{"name":"(anonymous_22)","line":434,"loc":{"start":{"line":434,"column":16},"end":{"line":434,"column":27}}},"23":{"name":"parseCookies","line":459,"loc":{"start":{"line":459,"column":0},"end":{"line":459,"column":38}}},"24":{"name":"loadSession","line":481,"loc":{"start":{"line":481,"column":0},"end":{"line":481,"column":37}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":42}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":32}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":35}},"4":{"start":{"line":8,"column":0},"end":{"line":8,"column":42}},"5":{"start":{"line":10,"column":0},"end":{"line":10,"column":32}},"6":{"start":{"line":11,"column":0},"end":{"line":11,"column":32}},"7":{"start":{"line":12,"column":0},"end":{"line":12,"column":55}},"8":{"start":{"line":20,"column":0},"end":{"line":22,"column":2}},"9":{"start":{"line":21,"column":2},"end":{"line":21,"column":36}},"10":{"start":{"line":33,"column":0},"end":{"line":55,"column":1}},"11":{"start":{"line":35,"column":2},"end":{"line":35,"column":26}},"12":{"start":{"line":36,"column":2},"end":{"line":36,"column":29}},"13":{"start":{"line":37,"column":2},"end":{"line":37,"column":53}},"14":{"start":{"line":40,"column":2},"end":{"line":40,"column":27}},"15":{"start":{"line":46,"column":2},"end":{"line":46,"column":34}},"16":{"start":{"line":49,"column":2},"end":{"line":49,"column":38}},"17":{"start":{"line":50,"column":2},"end":{"line":50,"column":38}},"18":{"start":{"line":51,"column":2},"end":{"line":51,"column":42}},"19":{"start":{"line":52,"column":2},"end":{"line":52,"column":40}},"20":{"start":{"line":53,"column":2},"end":{"line":53,"column":40}},"21":{"start":{"line":54,"column":2},"end":{"line":54,"column":40}},"22":{"start":{"line":88,"column":0},"end":{"line":146,"column":2}},"23":{"start":{"line":89,"column":2},"end":{"line":89,"column":25}},"24":{"start":{"line":91,"column":2},"end":{"line":91,"column":41}},"25":{"start":{"line":94,"column":2},"end":{"line":94,"column":44}},"26":{"start":{"line":97,"column":2},"end":{"line":97,"column":23}},"27":{"start":{"line":99,"column":2},"end":{"line":99,"column":74}},"28":{"start":{"line":102,"column":2},"end":{"line":128,"column":3}},"29":{"start":{"line":103,"column":4},"end":{"line":114,"column":7}},"30":{"start":{"line":109,"column":6},"end":{"line":112,"column":31}},"31":{"start":{"line":113,"column":6},"end":{"line":113,"column":73}},"32":{"start":{"line":120,"column":4},"end":{"line":127,"column":5}},"33":{"start":{"line":124,"column":6},"end":{"line":126,"column":7}},"34":{"start":{"line":125,"column":8},"end":{"line":125,"column":93}},"35":{"start":{"line":129,"column":2},"end":{"line":133,"column":3}},"36":{"start":{"line":130,"column":4},"end":{"line":130,"column":68}},"37":{"start":{"line":132,"column":4},"end":{"line":132,"column":55}},"38":{"start":{"line":136,"column":2},"end":{"line":136,"column":15}},"39":{"start":{"line":139,"column":2},"end":{"line":139,"column":41}},"40":{"start":{"line":142,"column":2},"end":{"line":142,"column":60}},"41":{"start":{"line":143,"column":2},"end":{"line":143,"column":60}},"42":{"start":{"line":145,"column":2},"end":{"line":145,"column":7}},"43":{"start":{"line":174,"column":0},"end":{"line":264,"column":2}},"44":{"start":{"line":175,"column":2},"end":{"line":175,"column":25}},"45":{"start":{"line":176,"column":2},"end":{"line":176,"column":43}},"46":{"start":{"line":179,"column":2},"end":{"line":181,"column":3}},"47":{"start":{"line":180,"column":4},"end":{"line":180,"column":11}},"48":{"start":{"line":184,"column":2},"end":{"line":184,"column":35}},"49":{"start":{"line":195,"column":2},"end":{"line":195,"column":22}},"50":{"start":{"line":196,"column":2},"end":{"line":196,"column":27}},"51":{"start":{"line":201,"column":2},"end":{"line":203,"column":4}},"52":{"start":{"line":202,"column":4},"end":{"line":202,"column":93}},"53":{"start":{"line":207,"column":2},"end":{"line":207,"column":87}},"54":{"start":{"line":208,"column":2},"end":{"line":262,"column":5}},"55":{"start":{"line":209,"column":4},"end":{"line":211,"column":5}},"56":{"start":{"line":210,"column":6},"end":{"line":210,"column":45}},"57":{"start":{"line":214,"column":4},"end":{"line":261,"column":7}},"58":{"start":{"line":215,"column":6},"end":{"line":217,"column":7}},"59":{"start":{"line":216,"column":8},"end":{"line":216,"column":47}},"60":{"start":{"line":223,"column":6},"end":{"line":259,"column":9}},"61":{"start":{"line":224,"column":8},"end":{"line":226,"column":9}},"62":{"start":{"line":225,"column":10},"end":{"line":225,"column":49}},"63":{"start":{"line":233,"column":8},"end":{"line":233,"column":86}},"64":{"start":{"line":234,"column":8},"end":{"line":258,"column":11}},"65":{"start":{"line":235,"column":10},"end":{"line":237,"column":11}},"66":{"start":{"line":236,"column":12},"end":{"line":236,"column":51}},"67":{"start":{"line":240,"column":10},"end":{"line":257,"column":13}},"68":{"start":{"line":247,"column":12},"end":{"line":251,"column":13}},"69":{"start":{"line":248,"column":14},"end":{"line":248,"column":94}},"70":{"start":{"line":249,"column":14},"end":{"line":249,"column":62}},"71":{"start":{"line":250,"column":14},"end":{"line":250,"column":21}},"72":{"start":{"line":254,"column":12},"end":{"line":254,"column":96}},"73":{"start":{"line":255,"column":12},"end":{"line":255,"column":55}},"74":{"start":{"line":256,"column":12},"end":{"line":256,"column":19}},"75":{"start":{"line":279,"column":0},"end":{"line":279,"column":42}},"76":{"start":{"line":292,"column":0},"end":{"line":308,"column":2}},"77":{"start":{"line":294,"column":2},"end":{"line":294,"column":25}},"78":{"start":{"line":297,"column":2},"end":{"line":297,"column":37}},"79":{"start":{"line":300,"column":2},"end":{"line":300,"column":21}},"80":{"start":{"line":301,"column":2},"end":{"line":305,"column":5}},"81":{"start":{"line":302,"column":4},"end":{"line":304,"column":5}},"82":{"start":{"line":303,"column":6},"end":{"line":303,"column":35}},"83":{"start":{"line":306,"column":2},"end":{"line":306,"column":55}},"84":{"start":{"line":320,"column":0},"end":{"line":337,"column":2}},"85":{"start":{"line":321,"column":2},"end":{"line":321,"column":25}},"86":{"start":{"line":324,"column":2},"end":{"line":330,"column":11}},"87":{"start":{"line":327,"column":4},"end":{"line":327,"column":70}},"88":{"start":{"line":328,"column":4},"end":{"line":328,"column":46}},"89":{"start":{"line":335,"column":2},"end":{"line":335,"column":29}},"90":{"start":{"line":353,"column":0},"end":{"line":375,"column":2}},"91":{"start":{"line":354,"column":2},"end":{"line":354,"column":25}},"92":{"start":{"line":357,"column":2},"end":{"line":357,"column":15}},"93":{"start":{"line":360,"column":2},"end":{"line":360,"column":30}},"94":{"start":{"line":363,"column":2},"end":{"line":365,"column":3}},"95":{"start":{"line":364,"column":4},"end":{"line":364,"column":33}},"96":{"start":{"line":368,"column":2},"end":{"line":370,"column":11}},"97":{"start":{"line":369,"column":4},"end":{"line":369,"column":28}},"98":{"start":{"line":374,"column":2},"end":{"line":374,"column":29}},"99":{"start":{"line":397,"column":0},"end":{"line":406,"column":1}},"100":{"start":{"line":398,"column":2},"end":{"line":398,"column":44}},"101":{"start":{"line":399,"column":2},"end":{"line":404,"column":3}},"102":{"start":{"line":400,"column":4},"end":{"line":400,"column":81}},"103":{"start":{"line":403,"column":4},"end":{"line":403,"column":32}},"104":{"start":{"line":405,"column":2},"end":{"line":405,"column":9}},"105":{"start":{"line":408,"column":0},"end":{"line":444,"column":1}},"106":{"start":{"line":413,"column":2},"end":{"line":415,"column":4}},"107":{"start":{"line":414,"column":4},"end":{"line":414,"column":111}},"108":{"start":{"line":417,"column":2},"end":{"line":417,"column":20}},"109":{"start":{"line":418,"column":2},"end":{"line":421,"column":3}},"110":{"start":{"line":419,"column":4},"end":{"line":419,"column":38}},"111":{"start":{"line":420,"column":4},"end":{"line":420,"column":18}},"112":{"start":{"line":424,"column":2},"end":{"line":426,"column":3}},"113":{"start":{"line":425,"column":4},"end":{"line":425,"column":118}},"114":{"start":{"line":428,"column":2},"end":{"line":433,"column":5}},"115":{"start":{"line":429,"column":4},"end":{"line":429,"column":14}},"116":{"start":{"line":430,"column":4},"end":{"line":432,"column":5}},"117":{"start":{"line":431,"column":6},"end":{"line":431,"column":26}},"118":{"start":{"line":434,"column":2},"end":{"line":443,"column":5}},"119":{"start":{"line":436,"column":4},"end":{"line":436,"column":19}},"120":{"start":{"line":437,"column":4},"end":{"line":439,"column":18}},"121":{"start":{"line":438,"column":6},"end":{"line":438,"column":42}},"122":{"start":{"line":441,"column":4},"end":{"line":441,"column":45}},"123":{"start":{"line":442,"column":4},"end":{"line":442,"column":11}},"124":{"start":{"line":459,"column":0},"end":{"line":470,"column":1}},"125":{"start":{"line":463,"column":2},"end":{"line":466,"column":3}},"126":{"start":{"line":465,"column":4},"end":{"line":465,"column":54}},"127":{"start":{"line":469,"column":2},"end":{"line":469,"column":16}},"128":{"start":{"line":481,"column":0},"end":{"line":495,"column":1}},"129":{"start":{"line":487,"column":2},"end":{"line":491,"column":3}},"130":{"start":{"line":490,"column":4},"end":{"line":490,"column":64}},"131":{"start":{"line":494,"column":2},"end":{"line":494,"column":16}}},"branchMap":{"1":{"line":35,"type":"binary-expr","locations":[{"start":{"line":35,"column":12},"end":{"line":35,"column":19}},{"start":{"line":35,"column":23},"end":{"line":35,"column":25}}]},"2":{"line":99,"type":"binary-expr","locations":[{"start":{"line":99,"column":22},"end":{"line":99,"column":42}},{"start":{"line":99,"column":46},"end":{"line":99,"column":73}}]},"3":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":2},"end":{"line":102,"column":2}},{"start":{"line":102,"column":2},"end":{"line":102,"column":2}}]},"4":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":4},"end":{"line":120,"column":4}},{"start":{"line":120,"column":4},"end":{"line":120,"column":4}}]},"5":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":6},"end":{"line":124,"column":6}},{"start":{"line":124,"column":6},"end":{"line":124,"column":6}}]},"6":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":2},"end":{"line":129,"column":2}},{"start":{"line":129,"column":2},"end":{"line":129,"column":2}}]},"7":{"line":179,"type":"if","locations":[{"start":{"line":179,"column":2},"end":{"line":179,"column":2}},{"start":{"line":179,"column":2},"end":{"line":179,"column":2}}]},"8":{"line":184,"type":"binary-expr","locations":[{"start":{"line":184,"column":15},"end":{"line":184,"column":25}},{"start":{"line":184,"column":29},"end":{"line":184,"column":34}}]},"9":{"line":209,"type":"if","locations":[{"start":{"line":209,"column":4},"end":{"line":209,"column":4}},{"start":{"line":209,"column":4},"end":{"line":209,"column":4}}]},"10":{"line":210,"type":"binary-expr","locations":[{"start":{"line":210,"column":27},"end":{"line":210,"column":30}},{"start":{"line":210,"column":34},"end":{"line":210,"column":43}}]},"11":{"line":215,"type":"if","locations":[{"start":{"line":215,"column":6},"end":{"line":215,"column":6}},{"start":{"line":215,"column":6},"end":{"line":215,"column":6}}]},"12":{"line":216,"type":"binary-expr","locations":[{"start":{"line":216,"column":29},"end":{"line":216,"column":32}},{"start":{"line":216,"column":36},"end":{"line":216,"column":45}}]},"13":{"line":224,"type":"if","locations":[{"start":{"line":224,"column":8},"end":{"line":224,"column":8}},{"start":{"line":224,"column":8},"end":{"line":224,"column":8}}]},"14":{"line":225,"type":"binary-expr","locations":[{"start":{"line":225,"column":31},"end":{"line":225,"column":34}},{"start":{"line":225,"column":38},"end":{"line":225,"column":47}}]},"15":{"line":235,"type":"if","locations":[{"start":{"line":235,"column":10},"end":{"line":235,"column":10}},{"start":{"line":235,"column":10},"end":{"line":235,"column":10}}]},"16":{"line":236,"type":"binary-expr","locations":[{"start":{"line":236,"column":33},"end":{"line":236,"column":36}},{"start":{"line":236,"column":40},"end":{"line":236,"column":49}}]},"17":{"line":247,"type":"if","locations":[{"start":{"line":247,"column":12},"end":{"line":247,"column":12}},{"start":{"line":247,"column":12},"end":{"line":247,"column":12}}]},"18":{"line":302,"type":"if","locations":[{"start":{"line":302,"column":4},"end":{"line":302,"column":4}},{"start":{"line":302,"column":4},"end":{"line":302,"column":4}}]},"19":{"line":327,"type":"binary-expr","locations":[{"start":{"line":327,"column":25},"end":{"line":327,"column":63}},{"start":{"line":327,"column":67},"end":{"line":327,"column":69}}]},"20":{"line":363,"type":"if","locations":[{"start":{"line":363,"column":2},"end":{"line":363,"column":2}},{"start":{"line":363,"column":2},"end":{"line":363,"column":2}}]},"21":{"line":399,"type":"if","locations":[{"start":{"line":399,"column":2},"end":{"line":399,"column":2}},{"start":{"line":399,"column":2},"end":{"line":399,"column":2}}]},"22":{"line":403,"type":"binary-expr","locations":[{"start":{"line":403,"column":16},"end":{"line":403,"column":25}},{"start":{"line":403,"column":29},"end":{"line":403,"column":31}}]},"23":{"line":418,"type":"if","locations":[{"start":{"line":418,"column":2},"end":{"line":418,"column":2}},{"start":{"line":418,"column":2},"end":{"line":418,"column":2}}]},"24":{"line":418,"type":"binary-expr","locations":[{"start":{"line":418,"column":6},"end":{"line":418,"column":26}},{"start":{"line":418,"column":30},"end":{"line":418,"column":51}},{"start":{"line":418,"column":55},"end":{"line":418,"column":78}}]},"25":{"line":424,"type":"if","locations":[{"start":{"line":424,"column":2},"end":{"line":424,"column":2}},{"start":{"line":424,"column":2},"end":{"line":424,"column":2}}]},"26":{"line":463,"type":"if","locations":[{"start":{"line":463,"column":2},"end":{"line":463,"column":2}},{"start":{"line":463,"column":2},"end":{"line":463,"column":2}}]},"27":{"line":487,"type":"if","locations":[{"start":{"line":487,"column":2},"end":{"line":487,"column":2}},{"start":{"line":487,"column":2},"end":{"line":487,"column":2}}]},"28":{"line":487,"type":"binary-expr","locations":[{"start":{"line":487,"column":6},"end":{"line":487,"column":42}},{"start":{"line":487,"column":46},"end":{"line":487,"column":68}}]}},"code":["/**"," * Module dependencies."," */","","var Readable = require('stream').Readable;","var QS = require('querystring');","var _ = require('@sailshq/lodash');","var Express = require('@sailshq/express');","","var buildReq = require('./req');","var buildRes = require('./res');","var defaultHandlers = require('./bindDefaultHandlers');","","","/**"," * Expose new instance of `Router`"," *"," * @api private"," */","module.exports = function(sails) {","  return new Router({sails: sails});","};","","","","/**"," * Initialize a new `Router`"," *"," * @param {Object} options"," * @api private"," */","","function Router(options) {","","  options = options || {};","  this.sails = options.sails;","  this.defaultHandlers = defaultHandlers(this.sails);","","  // Expose router on `sails` object","  this.sails.router = this;","","  // Required for dynamic NODE_ENV setting via command line args","  // TODO:","  // instead, use: https://www.npmjs.org/package/path-to-regexp","  // (or: https://www.npmjs.org/package/path-match)","  this._privateRouter = Express();","","  // Bind the context of all instance methods","  this.load = _.bind(this.load, this);","  this.bind = _.bind(this.bind, this);","  this.unbind = _.bind(this.unbind, this);","  this.reset = _.bind(this.reset, this);","  this.flush = _.bind(this.flush, this);","  this.route = _.bind(this.route, this);","}","","","/**"," * _privateRouter"," *"," * This internal \"private\" instance of an Express app object"," * is used only for routing. (i.e. it will not be used for"," * listening to actual HTTP requests; instead, one or more"," * delegate servers can be attached- see the `http` or"," * `sockets` hooks for examples of attaching a server to"," * Sails)"," *"," * NOTE: Requires calling `load()` before use in order to"," * provide access to the proper NODE_ENV, since Express"," * uses that to determine its environment (development vs."," * production.)"," */","","// Router.prototype._privateRouter;","","","","/**"," * `sails.router.load()`"," *"," * Expose the router, create the Express private router,"," * then call flush(), which will bind configured routes"," * and emit the appropriate events."," *"," * @api public"," */","","Router.prototype.load = function(cb) {","  var sails = this.sails;","","  sails.log.verbose('Loading router...');","","  // Maintain a reference to the static route config","  this.explicitRoutes = sails.config.routes;","","  // Save reference to sails logger","  this.log = sails.log;","","  var sessionSecret = sails.config.session && sails.config.session.secret;","  // If a session store is configured, hook it up as `req.session` by passing","  // it down to the session middleware","  if (sails.hooks.session) {","    sails.after('hook:session:loaded', function (){","      // if (!sails.config.session || !sails.config.session.store || !sails.config.session.secret) {","      //   return cb(new Error('Consistency violation: expected session store+secret config to exist if the session hook is enabled. Is `sails.config.session` valid?'));","      // }","","      // Set \"resave\" and \"saveUninitialized\" options or else express-session gives you a stern warning.","      var opts = _.merge({","        resave: true,","        saveUninitialized: true","      }, sails.config.session);","      sails._privateSessionMiddleware = require('express-session')(opts);","    });","  }","  // Otherwise double check the session secret (if one is provided) since it's usually checked","  // in the session hook.","  else {","    // If available, Sails uses the configured session secret for signing cookies.","    if (sessionSecret) {","      // Ensure secret is a string.  This check happens in the session hook as well,","      // but sails.config.session.secret may still be provided even if the session hook","      // is turned off, so to be extra anal we'll check here as well.","      if (!_.isString(sessionSecret)) {","        return cb(new Error('If provided, sails.config.session.secret should be a string.'));","      }","    }","  }","  if (sessionSecret) {","    sails._privateCpMware = require('cookie-parser')(sessionSecret);","  } else {","    sails._privateCpMware = require('cookie-parser')();","  }","","  // Wipe any existing routes and bind them anew","  this.flush();","","  // Listen for requests","  sails.on('router:request', this.route);","","  // Listen for unhandled errors and unmatched routes","  sails.on('router:request:500', this.defaultHandlers[500]);","  sails.on('router:request:404', this.defaultHandlers[404]);","","  cb();","};","","","","/**"," * `sails.router.route(partialReq, partialRes)`"," *"," * Interpret the specified (usually partial) request and response objects into"," * streams with all of the expected methods, then routes the fully-formed request"," * using the built-in private router. Useful for creating virtual request/response"," * streams from non-HTTP sources, like Socket.io or unit tests."," *"," * This method is not always helpful-- it is not called for HTTP requests, for instance,"," * since the true HTTP req/res streams already exist.  In that case, at lift-time, Sails"," * calls `router:bind`, which loads Sails' routes as normal middleware/routes in the http hook."," * stack will run as usual."," *"," * On the other hand, Socket.io needs to use this method (i.e. the `router:request` event)"," * to simulate a connect-style router since it can't bind dynamic routes ahead of time."," *"," * Keep in mind that, if `route` is not used, the implementing server is responsible"," * for routing to Sails' default `next(foo)` handler."," *"," * @param {Request} req"," * @param {Response} res"," * @api private"," */","","Router.prototype.route = function(req, res) {","  var sails = this.sails;","  var _privateRouter = this._privateRouter;","","  // If sails is `_exiting`, ignore the request.","  if (sails._exiting) {","    return;","  }","","  // Provide access to SailsApp instance as `req._sails`.","  req._sails = req._sails || sails;","","  // Note that, at this point, `req` and `res` are just dictionaries containing","  // the properties of each object that have been built up _so far_.","  //","  // Use base req and res definitions to ensure the specified","  // objects are at least ducktype-able as standard node HTTP","  // req and req streams.","  //","  // Make sure request and response objects have reasonable defaults","  // (will use the supplied definitions if possible)","  req = buildReq(req);","  res = buildRes(req, res);","","  // console.log('\\n\\n\\n\\n=======================\\nReceived request to %s %s\\nwith req.body:\\n',req.method,req.url, req.body);","","  // Deprecation error:","  res._cb = function _cbIsDeprecated(err) {","    throw new Error('As of v0.10, `_cb()` shim is no longer supported in the Sails router.');","  };","","","  // Run some basic middleware","  sails.log.silly('Handling virtual request :: Running virtual querystring parser...');","  qsParser(req,res, function (err) {","    if (err) {","      return res.send(400, err && err.stack);","    }","","    // Parse cookies","    parseCookies(req, res, function(err){","      if (err) {","        return res.send(400, err && err.stack);","      }","","      // console.log('Ran cookie parser');","      // console.log('res.writeHead= ',res.writeHead);","","      // Load session (if relevant)","      loadSession(req, res, function (err) {","        if (err) {","          return res.send(400, err && err.stack);","        }","        // console.log('res is now:\\n',res);","        // console.log('\\n\\n');","        // console.log('Ran session middleware');","        // console.log('req.sessionID= ',req.sessionID);","        // console.log('The loaded req.session= ',req.session);","","        sails.log.silly('Handling virtual request :: Running virtual body parser...');","        bodyParser(req,res, function (err) {","          if (err) {","            return res.send(400, err && err.stack);","          }","","          // Use our private router to route the request","          _privateRouter.router(req, res, function handleUnmatchedNext(err) {","            //","            // In the event of an unmatched `next()`, `next('foo')`,","            // or `next('foo', errorCode)`...","            //","","            // Use the default server error handler","            if (err) {","              sails.log.silly('Handling virtual request :: Running final \"error\" handler...');","              sails.emit('router:request:500', err, req, res);","              return;","            }","","            // Or the default not found handler","            sails.log.silly('Handling virtual request :: Running final \"not found\" handler...');","            sails.emit('router:request:404', req, res);","            return;","          });","        });","      });","","    });","  });","","};","","","","/**"," * `sails.router.bind()`"," *"," * Bind new route(s)"," *"," * @param {String|RegExp} path"," * @param {String|Object|Array|Function} bindTo"," * @param {String} verb"," * @api private"," */","","Router.prototype.bind = require('./bind');","","","","/**"," * `sails.router.unbind()`"," *"," * Unbind existing route"," *"," * @param {Object} route"," * @api private"," */","","Router.prototype.unbind = function(route) {","","  var sails = this.sails;","","  // Inform attached servers that route should be unbound","  sails.emit('router:unbind', route);","","  // Remove route in internal router","  var newRoutes = [];","  _.each(this._privateRouter.routes[route.method], function(expressRoute) {","    if (expressRoute.path !== route.path) {","      newRoutes.push(expressRoute);","    }","  });","  this._privateRouter.routes[route.method] = newRoutes;","","};","","","","/**"," * `sails.router.reset()`"," *"," * Unbind all routes currently attached to the router"," *"," * @api private"," */","","Router.prototype.reset = function() {","  var sails = this.sails;","","  // Unbind everything","  _.each(this._privateRouter.routes, function(routes, httpMethod) {","","    // Unbind each route for the specified HTTP verb","    var routesToUnbind = this._privateRouter.routes[httpMethod] || [];","    _.each(routesToUnbind, this.unbind, this);","","  }, this);","","","  // Emit reset event to allow attached servers to","  // unbind all of their routes as well","  sails.emit('router:reset');","","};","","","","/**"," * `sails.router.flush()`"," *"," * Unbind all current routes, then re-bind everything, re-emitting the routing"," * lifecycle events (e.g. `router:before` and `router:after`)"," *"," * @param {Object} routes - (optional)"," *  If specified, replaces `this.explicitRoutes` before flushing."," *"," * @api private"," */","","Router.prototype.flush = function(routes) {","  var sails = this.sails;","","  // Wipe routes","  this.reset();","","  // Fired before static routes are bound","  sails.emit('router:before');","","  // If specified, replace `this.explicitRoutes`","  if (routes) {","    this.explicitRoutes = routes;","  }","","  // Use specified path to bind static routes","  _.each(this.explicitRoutes, function(target, path) {","    this.bind(path, target);","  }, this);","","","  // Fired after static routes are bound","  sails.emit('router:after');","};","","","","","","","","","","////////////////////////////////////////////////////////////////////////////////////////////////////","//","// ||     Private functions","// \\/","//","////////////////////////////////////////////////////////////////////////////////////////////////////","","","","","","// Extremely simple query string parser (`req.query`)","function qsParser(req,res,next) {","  var queryStringPos = req.url.indexOf('?');","  if (queryStringPos !== -1) {","    req.query = _.merge(req.query, QS.parse(req.url.substr(queryStringPos + 1)));","  }","  else {","    req.query = req.query || {};","  }","  next();","}","// Extremely simple body parser (`req.body`)","function bodyParser (req, res, next) {","","  // Set up a mock `req.file()` clarifying that req.file() is not available","  // outside of the context of Skipper (i.e. in this case, most commonly from","  // socket.io virtual requests).","  req.file = function fileUploadsNotAvailable(){","    return res.send(500, 'Streaming file uploads via `req.file()` are only available over HTTP with Skipper.');","  };","","  var bodyBuffer='';","  if (req.method === 'GET' || req.method === 'HEAD' || req.method === 'DELETE'){","    req.body = _.extend({}, req.body);","    return next();","  }","","  // Ensure that `req` is a readable stream at this point","  if ( ! req instanceof Readable ) {","    return next(new Error('Sails Internal Error: `req` should be a Readable stream by the time `route()` is called'));","  }","","  req.on('readable', function() {","    var chunk;","    while (null !== (chunk = req.read())) {","      bodyBuffer += chunk;","    }","  });","  req.on('end', function() {","","    var parsedBody;","    try {","      parsedBody = JSON.parse(bodyBuffer);","    } catch (e) {}","","    req.body = _.merge(req.body, parsedBody);","    next();","  });","}","","","","","","","","/**"," * [parseCookies description]"," * @param  {[type]}   req  [description]"," * @param  {[type]}   res  [description]"," * @param  {Function} next [description]"," * @return {[type]}        [description]"," */","function parseCookies (req, res, next){","","  // req._sails.log.verbose('Parsing cookie:',req.headers.cookie);","","  if (req._sails._privateCpMware) {","    // Run the middleware","    return req._sails._privateCpMware(req, res, next);","  }","","  // Otherwise don't even worry about it.","  return next();","}","","","","/**"," * [loadSession description]"," * @param  {[type]}   req  [description]"," * @param  {[type]}   res  [description]"," * @param  {Function} next [description]"," * @return {[type]}        [description]"," */","function loadSession (req, res, next){","","  // If a session store is configured, and we haven't deliberately disabled","  // session support for this request by setting the \"nosession\" header,","  // hook up the store up as `req.session` by passing it down to the","  // session middleware.","  if (req._sails._privateSessionMiddleware && !req.headers.nosession) {","","    // Access store preconfigured session middleware as a private property on the app instance.","    return req._sails._privateSessionMiddleware(req, res, next);","  }","","  // Otherwise don't even worry about it.","  return next();","}",""],"l":{"5":1,"6":1,"7":1,"8":1,"10":1,"11":1,"12":1,"20":1,"21":2,"33":1,"35":2,"36":2,"37":2,"40":2,"46":2,"49":2,"50":2,"51":2,"52":2,"53":2,"54":2,"88":1,"89":0,"91":0,"94":0,"97":0,"99":0,"102":0,"103":0,"109":0,"113":0,"120":0,"124":0,"125":0,"129":0,"130":0,"132":0,"136":0,"139":0,"142":0,"143":0,"145":0,"174":1,"175":0,"176":0,"179":0,"180":0,"184":0,"195":0,"196":0,"201":0,"202":0,"207":0,"208":0,"209":0,"210":0,"214":0,"215":0,"216":0,"223":0,"224":0,"225":0,"233":0,"234":0,"235":0,"236":0,"240":0,"247":0,"248":0,"249":0,"250":0,"254":0,"255":0,"256":0,"279":1,"292":1,"294":0,"297":0,"300":0,"301":0,"302":0,"303":0,"306":0,"320":1,"321":0,"324":0,"327":0,"328":0,"335":0,"353":1,"354":0,"357":0,"360":0,"363":0,"364":0,"368":0,"369":0,"374":0,"397":1,"398":0,"399":0,"400":0,"403":0,"405":0,"408":1,"413":0,"414":0,"417":0,"418":0,"419":0,"420":0,"424":0,"425":0,"428":0,"429":0,"430":0,"431":0,"434":0,"436":0,"437":0,"438":0,"441":0,"442":0,"459":1,"463":0,"465":0,"469":0,"481":1,"487":0,"490":0,"494":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/router/req.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/router/req.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0,0],"12":[0,0],"13":[0,0,0],"14":[0,0],"15":[0,0],"16":[0,0,0],"17":[0,0],"18":[0,0,0,0],"19":[0,0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"buildRequest","line":26,"loc":{"start":{"line":26,"column":17},"end":{"line":26,"column":46}}},"2":{"name":"(anonymous_2)","line":51,"loc":{"start":{"line":51,"column":27},"end":{"line":51,"column":59}}},"3":{"name":"(anonymous_3)","line":57,"loc":{"start":{"line":57,"column":47},"end":{"line":57,"column":79}}},"4":{"name":"(anonymous_4)","line":73,"loc":{"start":{"line":73,"column":27},"end":{"line":73,"column":43}}},"5":{"name":"(anonymous_5)","line":118,"loc":{"start":{"line":118,"column":11},"end":{"line":118,"column":45}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":34}},"4":{"start":{"line":8,"column":0},"end":{"line":8,"column":35}},"5":{"start":{"line":26,"column":0},"end":{"line":147,"column":2}},"6":{"start":{"line":29,"column":2},"end":{"line":29,"column":18}},"7":{"start":{"line":33,"column":2},"end":{"line":33,"column":10}},"8":{"start":{"line":37,"column":2},"end":{"line":37,"column":16}},"9":{"start":{"line":38,"column":2},"end":{"line":39,"column":29}},"10":{"start":{"line":38,"column":7},"end":{"line":38,"column":40}},"11":{"start":{"line":39,"column":13},"end":{"line":39,"column":28}},"12":{"start":{"line":43,"column":2},"end":{"line":94,"column":3}},"13":{"start":{"line":44,"column":4},"end":{"line":44,"column":15}},"14":{"start":{"line":49,"column":4},"end":{"line":63,"column":5}},"15":{"start":{"line":51,"column":6},"end":{"line":55,"column":9}},"16":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"17":{"start":{"line":53,"column":10},"end":{"line":53,"column":41}},"18":{"start":{"line":57,"column":6},"end":{"line":62,"column":9}},"19":{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},"20":{"start":{"line":59,"column":10},"end":{"line":59,"column":38}},"21":{"start":{"line":61,"column":8},"end":{"line":61,"column":25}},"22":{"start":{"line":66,"column":4},"end":{"line":70,"column":7}},"23":{"start":{"line":73,"column":4},"end":{"line":81,"column":6}},"24":{"start":{"line":74,"column":6},"end":{"line":80,"column":7}},"25":{"start":{"line":77,"column":8},"end":{"line":77,"column":61}},"26":{"start":{"line":79,"column":8},"end":{"line":79,"column":34}},"27":{"start":{"line":86,"column":4},"end":{"line":93,"column":5}},"28":{"start":{"line":89,"column":6},"end":{"line":91,"column":7}},"29":{"start":{"line":90,"column":8},"end":{"line":90,"column":28}},"30":{"start":{"line":92,"column":6},"end":{"line":92,"column":16}},"31":{"start":{"line":97,"column":2},"end":{"line":97,"column":30}},"32":{"start":{"line":114,"column":2},"end":{"line":144,"column":15}},"33":{"start":{"line":120,"column":6},"end":{"line":120,"column":27}},"34":{"start":{"line":121,"column":6},"end":{"line":123,"column":7}},"35":{"start":{"line":122,"column":8},"end":{"line":122,"column":53}},"36":{"start":{"line":124,"column":6},"end":{"line":126,"column":7}},"37":{"start":{"line":125,"column":8},"end":{"line":125,"column":52}},"38":{"start":{"line":127,"column":6},"end":{"line":129,"column":7}},"39":{"start":{"line":128,"column":8},"end":{"line":128,"column":51}},"40":{"start":{"line":133,"column":6},"end":{"line":137,"column":7}},"41":{"start":{"line":134,"column":8},"end":{"line":134,"column":33}},"42":{"start":{"line":136,"column":8},"end":{"line":136,"column":28}},"43":{"start":{"line":146,"column":2},"end":{"line":146,"column":13}}},"branchMap":{"1":{"line":29,"type":"binary-expr","locations":[{"start":{"line":29,"column":9},"end":{"line":29,"column":13}},{"start":{"line":29,"column":15},"end":{"line":29,"column":17}}]},"2":{"line":38,"type":"binary-expr","locations":[{"start":{"line":38,"column":19},"end":{"line":38,"column":33}},{"start":{"line":38,"column":37},"end":{"line":38,"column":39}}]},"3":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":43,"column":2}},{"start":{"line":43,"column":2},"end":{"line":43,"column":2}}]},"4":{"line":43,"type":"binary-expr","locations":[{"start":{"line":43,"column":6},"end":{"line":43,"column":30}},{"start":{"line":43,"column":34},"end":{"line":43,"column":43}}]},"5":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":4},"end":{"line":49,"column":4}},{"start":{"line":49,"column":4},"end":{"line":49,"column":4}}]},"6":{"line":49,"type":"binary-expr","locations":[{"start":{"line":49,"column":8},"end":{"line":49,"column":20}},{"start":{"line":49,"column":24},"end":{"line":49,"column":56}}]},"7":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":8},"end":{"line":52,"column":8}},{"start":{"line":52,"column":8},"end":{"line":52,"column":8}}]},"8":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":8},"end":{"line":58,"column":8}},{"start":{"line":58,"column":8},"end":{"line":58,"column":8}}]},"9":{"line":67,"type":"binary-expr","locations":[{"start":{"line":67,"column":14},"end":{"line":67,"column":18}},{"start":{"line":67,"column":23},"end":{"line":67,"column":82}}]},"10":{"line":67,"type":"cond-expr","locations":[{"start":{"line":67,"column":49},"end":{"line":67,"column":74}},{"start":{"line":67,"column":77},"end":{"line":67,"column":82}}]},"11":{"line":68,"type":"binary-expr","locations":[{"start":{"line":68,"column":15},"end":{"line":68,"column":19}},{"start":{"line":68,"column":23},"end":{"line":68,"column":35}},{"start":{"line":68,"column":39},"end":{"line":68,"column":41}}]},"12":{"line":69,"type":"binary-expr","locations":[{"start":{"line":69,"column":11},"end":{"line":69,"column":15}},{"start":{"line":69,"column":19},"end":{"line":69,"column":27}}]},"13":{"line":74,"type":"switch","locations":[{"start":{"line":75,"column":6},"end":{"line":75,"column":21}},{"start":{"line":76,"column":6},"end":{"line":77,"column":61}},{"start":{"line":78,"column":6},"end":{"line":79,"column":34}}]},"14":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":15},"end":{"line":77,"column":36}},{"start":{"line":77,"column":40},"end":{"line":77,"column":60}}]},"15":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":4},"end":{"line":86,"column":4}},{"start":{"line":86,"column":4},"end":{"line":86,"column":4}}]},"16":{"line":86,"type":"binary-expr","locations":[{"start":{"line":86,"column":8},"end":{"line":86,"column":28}},{"start":{"line":86,"column":32},"end":{"line":86,"column":53}},{"start":{"line":86,"column":57},"end":{"line":86,"column":80}}]},"17":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":6},"end":{"line":89,"column":6}},{"start":{"line":89,"column":6},"end":{"line":89,"column":6}}]},"18":{"line":116,"type":"binary-expr","locations":[{"start":{"line":116,"column":12},"end":{"line":116,"column":16}},{"start":{"line":116,"column":20},"end":{"line":116,"column":30}},{"start":{"line":116,"column":35},"end":{"line":116,"column":80}},{"start":{"line":116,"column":84},"end":{"line":116,"column":86}}]},"19":{"line":117,"type":"binary-expr","locations":[{"start":{"line":117,"column":11},"end":{"line":117,"column":15}},{"start":{"line":117,"column":19},"end":{"line":117,"column":28}},{"start":{"line":117,"column":33},"end":{"line":117,"column":35}}]},"20":{"line":121,"type":"binary-expr","locations":[{"start":{"line":121,"column":19},"end":{"line":121,"column":29}},{"start":{"line":121,"column":33},"end":{"line":121,"column":35}}]},"21":{"line":122,"type":"binary-expr","locations":[{"start":{"line":122,"column":22},"end":{"line":122,"column":33}},{"start":{"line":122,"column":37},"end":{"line":122,"column":52}}]},"22":{"line":124,"type":"binary-expr","locations":[{"start":{"line":124,"column":19},"end":{"line":124,"column":28}},{"start":{"line":124,"column":32},"end":{"line":124,"column":34}}]},"23":{"line":125,"type":"binary-expr","locations":[{"start":{"line":125,"column":22},"end":{"line":125,"column":33}},{"start":{"line":125,"column":37},"end":{"line":125,"column":51}}]},"24":{"line":127,"type":"binary-expr","locations":[{"start":{"line":127,"column":19},"end":{"line":127,"column":27}},{"start":{"line":127,"column":31},"end":{"line":127,"column":33}}]},"25":{"line":128,"type":"binary-expr","locations":[{"start":{"line":128,"column":22},"end":{"line":128,"column":33}},{"start":{"line":128,"column":37},"end":{"line":128,"column":50}}]},"26":{"line":133,"type":"if","locations":[{"start":{"line":133,"column":6},"end":{"line":133,"column":6}},{"start":{"line":133,"column":6},"end":{"line":133,"column":6}}]},"27":{"line":140,"type":"cond-expr","locations":[{"start":{"line":140,"column":52},"end":{"line":140,"column":57}},{"start":{"line":140,"column":60},"end":{"line":140,"column":64}}]},"28":{"line":140,"type":"binary-expr","locations":[{"start":{"line":140,"column":16},"end":{"line":140,"column":20}},{"start":{"line":140,"column":24},"end":{"line":140,"column":48}}]},"29":{"line":142,"type":"binary-expr","locations":[{"start":{"line":142,"column":17},"end":{"line":142,"column":33}},{"start":{"line":142,"column":37},"end":{"line":142,"column":45}}]},"30":{"line":143,"type":"binary-expr","locations":[{"start":{"line":143,"column":10},"end":{"line":143,"column":19}},{"start":{"line":143,"column":23},"end":{"line":143,"column":41}}]},"31":{"line":144,"type":"binary-expr","locations":[{"start":{"line":144,"column":5},"end":{"line":144,"column":9}},{"start":{"line":144,"column":11},"end":{"line":144,"column":13}}]}},"code":["/**"," * Module dependencies"," */","","var _ = require('@sailshq/lodash');","var defaultsDeep = require('merge-defaults');","var MockReq = require('mock-req');","var parseurl = require('parseurl');","","/**"," * Factory which builds generic Sails request object (i.e. `req`)."," *"," * This generic implementation of `req` forms the basis for"," * Sails' transport-agnostic support of Connect/Express"," * middleware.  Used by hooks (i.e. sockets) but also for"," * tests-- both at the app-level and in Sails core."," *"," * @param {Dictionary} _req"," *        the properties of this simulated request object that"," *        have been built up _so far_."," *"," * @return {Request} simulated HTTP request object"," * @idempotent"," */","","module.exports = function buildRequest (_req) {","","  // Make sure _req is not undefined","  _req = _req||{};","","  // Start our request object, which will be built by inheriting/transforming","  // properties of _req and adding some spice of our own","  var req;","","  // Attempt to parse the URL in _req, so that we can get the querystring","  // and path","  var parsedUrl;","  try {parsedUrl = parseurl(_req) || {};}","  catch (e) {parsedUrl = {};}","","  // If `_req` appears to be a stream (duck-typing), then don't try","  // and turn it into a mock stream again.","  if (typeof _req === 'object' && _req.read) {","    req = _req;","  }","  else {","","    // TODO: send a PR to mock-req with a fix for this","    if (_req.headers && typeof _req.headers === 'object') {","      // Strip undefined headers","      _.each(_req.headers, function (headerVal, headerKey) {","        if (_.isUndefined(headerVal)){","          delete _req.headers[headerKey];","        }","      });","      // Make sure all remaining headers are strings","      _req.headers = _.mapValues(_req.headers, function (headerVal, headerKey) { // :TODO 'headerKey' is defined but never used","        if (typeof headerVal !== 'string') {","          headerVal = ''+headerVal+'';","        }","        return headerVal;","      });","    }","","    // Create a mock IncomingMessage stream.","    req = new MockReq({","      method: _req && (_.isString(_req.method) ? _req.method.toUpperCase() : 'GET'),","      headers: _req && _req.headers || {},","      url: _req && _req.url","    });","","    // Add .get() and .header() methods to match express 3","    req.get = req.header = function (name) {","      switch (name = name.toLowerCase()) {","      case 'referer':","      case 'referrer':","        return this.headers.referrer || this.headers.referer;","      default:","        return this.headers[name];","      }","    };","","    // Now pump client request body to the mock IncomingMessage stream (req)","    // Req stream ends automatically if this is a GET or HEAD or DELETE request","    // (since there is no request body in that case) so no need to do it again.","    if (req.method !== 'GET' && req.method !== 'HEAD' && req.method !== 'DELETE') {","","      // Only write the body if there IS a body.","      if (req.body) {","        req.write(req.body);","      }","      req.end();","    }","  }","","  // Track request start time","  req._startTime = new Date();","","  ////////////////////////////////////////////////////////////////////////////////","  // Note that other core methods _could_ be added here for use w/ the virtual","  // router.  But as per convo w/ dougwilson, the same _cannot_ be done for HTTP","  // requests coming out of Express.  They would either have to (a) rely on modifying","  // the HTTP request (IncomingMessage) prototype, or (B) rely on context (i.e. `this`),","  // which would require `_.bind()`-ing them to avoid issues when triggered from","  // userland code. And re: (B) at that point, the performance impact is effectively","  // the same as if they were attached on the fly on a per-request basis.","  //","  // So we only initially attach `req.*` methods & properties here which are _not_","  // already built-in to the mock request, and which are _not_ already taken care of","  // by hooks, AND which don't rely on `res` (because it hasn't been built yet).","  ////////////////////////////////////////////////////////////////////////////////","","  // Provide defaults for other request state and methods","  req = defaultsDeep(req, {","    params: [],","    query: (_req && _req.query) || require('querystring').parse(parsedUrl.query) || {},","    body: (_req && _req.body) || {},","    param: function(paramName, defaultValue) {","","      var key, params = {};","      for (key in (req.params || {}) ) {","        params[key] = params[key] || req.params[key];","      }","      for (key in (req.query || {}) ) {","        params[key] = params[key] || req.query[key];","      }","      for (key in (req.body || {}) ) {","        params[key] = params[key] || req.body[key];","      }","","      // Grab the value of the parameter from the appropriate place","      // and return it","      if (typeof params[paramName] !== 'undefined') {","        return params[paramName];","      } else {","        return defaultValue;","      }","","    },","    wantsJSON: (_req && _req.wantsJSON === false) ? false : true,","    method: 'GET',","    originalUrl: _req.originalUrl || _req.url,","    path: _req.path || parsedUrl.pathname","  }, _req||{});","","  return req;","};",""],"l":{"5":1,"6":1,"7":1,"8":1,"26":1,"29":0,"33":0,"37":0,"38":0,"39":0,"43":0,"44":0,"49":0,"51":0,"52":0,"53":0,"57":0,"58":0,"59":0,"61":0,"66":0,"73":0,"74":0,"77":0,"79":0,"86":0,"89":0,"90":0,"92":0,"97":0,"114":0,"120":0,"121":0,"122":0,"124":0,"125":0,"127":0,"128":0,"133":0,"134":0,"136":0,"146":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/router/res.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/router/res.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":1,"115":0,"116":0,"117":0,"118":0,"119":0,"120":1,"121":0,"122":0,"123":0,"124":1,"125":0,"126":1,"127":1,"128":0,"129":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0,0],"21":[0,0],"22":[0,0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0,0],"29":[0,0],"30":[0,0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},"fnMap":{"1":{"name":"_buildResponse","line":18,"loc":{"start":{"line":18,"column":17},"end":{"line":18,"column":53}}},"2":{"name":"(anonymous_2)","line":58,"loc":{"start":{"line":58,"column":32},"end":{"line":58,"column":43}}},"3":{"name":"(anonymous_3)","line":61,"loc":{"start":{"line":61,"column":31},"end":{"line":61,"column":45}}},"4":{"name":"(anonymous_4)","line":87,"loc":{"start":{"line":87,"column":18},"end":{"line":87,"column":72}}},"5":{"name":"(anonymous_5)","line":91,"loc":{"start":{"line":91,"column":24},"end":{"line":91,"column":34}}},"6":{"name":"(anonymous_6)","line":97,"loc":{"start":{"line":97,"column":22},"end":{"line":97,"column":33}}},"7":{"name":"(anonymous_7)","line":135,"loc":{"start":{"line":135,"column":14},"end":{"line":135,"column":25}}},"8":{"name":"(anonymous_8)","line":141,"loc":{"start":{"line":141,"column":12},"end":{"line":141,"column":23}}},"9":{"name":"status_shim","line":163,"loc":{"start":{"line":163,"column":29},"end":{"line":163,"column":63}}},"10":{"name":"send_shim","line":169,"loc":{"start":{"line":169,"column":25},"end":{"line":169,"column":47}}},"11":{"name":"json_shim","line":259,"loc":{"start":{"line":259,"column":25},"end":{"line":259,"column":47}}},"12":{"name":"render_shim","line":265,"loc":{"start":{"line":265,"column":29},"end":{"line":265,"column":81}}},"13":{"name":"redirect_shim","line":285,"loc":{"start":{"line":285,"column":33},"end":{"line":285,"column":59}}},"14":{"name":"(anonymous_14)","line":305,"loc":{"start":{"line":305,"column":12},"end":{"line":305,"column":41}}},"15":{"name":"(anonymous_15)","line":317,"loc":{"start":{"line":317,"column":12},"end":{"line":317,"column":34}}},"16":{"name":"normalizeResArgs","line":343,"loc":{"start":{"line":343,"column":0},"end":{"line":343,"column":34}}},"17":{"name":"(anonymous_17)","line":347,"loc":{"start":{"line":347,"column":18},"end":{"line":347,"column":31}}},"18":{"name":"onlyAllowOneResponse","line":370,"loc":{"start":{"line":370,"column":0},"end":{"line":370,"column":36}}},"19":{"name":"MockClientResponse","line":380,"loc":{"start":{"line":380,"column":0},"end":{"line":380,"column":30}}},"20":{"name":"(anonymous_20)","line":384,"loc":{"start":{"line":384,"column":42},"end":{"line":384,"column":74}}}},"statementMap":{"1":{"start":{"line":4,"column":0},"end":{"line":4,"column":27}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":44}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":35}},"4":{"start":{"line":7,"column":0},"end":{"line":7,"column":34}},"5":{"start":{"line":18,"column":0},"end":{"line":326,"column":2}},"6":{"start":{"line":19,"column":2},"end":{"line":19,"column":18}},"7":{"start":{"line":20,"column":2},"end":{"line":20,"column":16}},"8":{"start":{"line":22,"column":2},"end":{"line":22,"column":10}},"9":{"start":{"line":26,"column":2},"end":{"line":32,"column":3}},"10":{"start":{"line":27,"column":4},"end":{"line":27,"column":15}},"11":{"start":{"line":30,"column":4},"end":{"line":30,"column":24}},"12":{"start":{"line":31,"column":4},"end":{"line":31,"column":26}},"13":{"start":{"line":36,"column":2},"end":{"line":36,"column":63}},"14":{"start":{"line":37,"column":2},"end":{"line":37,"column":28}},"15":{"start":{"line":47,"column":2},"end":{"line":68,"column":3}},"16":{"start":{"line":50,"column":4},"end":{"line":52,"column":5}},"17":{"start":{"line":51,"column":6},"end":{"line":51,"column":48}},"18":{"start":{"line":58,"column":4},"end":{"line":60,"column":7}},"19":{"start":{"line":59,"column":6},"end":{"line":59,"column":49}},"20":{"start":{"line":61,"column":4},"end":{"line":66,"column":7}},"21":{"start":{"line":62,"column":6},"end":{"line":62,"column":57}},"22":{"start":{"line":63,"column":6},"end":{"line":63,"column":38}},"23":{"start":{"line":64,"column":6},"end":{"line":64,"column":32}},"24":{"start":{"line":65,"column":6},"end":{"line":65,"column":49}},"25":{"start":{"line":75,"column":2},"end":{"line":77,"column":3}},"26":{"start":{"line":76,"column":4},"end":{"line":76,"column":29}},"27":{"start":{"line":87,"column":2},"end":{"line":130,"column":4}},"28":{"start":{"line":89,"column":4},"end":{"line":89,"column":35}},"29":{"start":{"line":91,"column":4},"end":{"line":96,"column":9}},"30":{"start":{"line":92,"column":6},"end":{"line":94,"column":7}},"31":{"start":{"line":93,"column":8},"end":{"line":93,"column":28}},"32":{"start":{"line":95,"column":6},"end":{"line":95,"column":23}},"33":{"start":{"line":97,"column":4},"end":{"line":102,"column":9}},"34":{"start":{"line":98,"column":6},"end":{"line":100,"column":7}},"35":{"start":{"line":99,"column":8},"end":{"line":99,"column":28}},"36":{"start":{"line":101,"column":6},"end":{"line":101,"column":26}},"37":{"start":{"line":104,"column":4},"end":{"line":106,"column":5}},"38":{"start":{"line":105,"column":6},"end":{"line":105,"column":73}},"39":{"start":{"line":108,"column":4},"end":{"line":108,"column":32}},"40":{"start":{"line":111,"column":4},"end":{"line":111,"column":40}},"41":{"start":{"line":113,"column":4},"end":{"line":119,"column":5}},"42":{"start":{"line":114,"column":6},"end":{"line":116,"column":7}},"43":{"start":{"line":115,"column":8},"end":{"line":115,"column":129}},"44":{"start":{"line":118,"column":6},"end":{"line":118,"column":40}},"45":{"start":{"line":124,"column":4},"end":{"line":128,"column":5}},"46":{"start":{"line":126,"column":6},"end":{"line":126,"column":43}},"47":{"start":{"line":127,"column":6},"end":{"line":127,"column":49}},"48":{"start":{"line":134,"column":2},"end":{"line":134,"column":28}},"49":{"start":{"line":135,"column":2},"end":{"line":139,"column":4}},"50":{"start":{"line":136,"column":4},"end":{"line":136,"column":70}},"51":{"start":{"line":138,"column":4},"end":{"line":138,"column":64}},"52":{"start":{"line":140,"column":2},"end":{"line":140,"column":24}},"53":{"start":{"line":141,"column":2},"end":{"line":146,"column":4}},"54":{"start":{"line":142,"column":4},"end":{"line":142,"column":70}},"55":{"start":{"line":145,"column":4},"end":{"line":145,"column":62}},"56":{"start":{"line":163,"column":2},"end":{"line":166,"column":4}},"57":{"start":{"line":164,"column":4},"end":{"line":164,"column":32}},"58":{"start":{"line":165,"column":4},"end":{"line":165,"column":15}},"59":{"start":{"line":169,"column":2},"end":{"line":256,"column":4}},"60":{"start":{"line":170,"column":4},"end":{"line":170,"column":43}},"61":{"start":{"line":174,"column":4},"end":{"line":185,"column":5}},"62":{"start":{"line":175,"column":6},"end":{"line":175,"column":32}},"63":{"start":{"line":178,"column":6},"end":{"line":181,"column":7}},"64":{"start":{"line":179,"column":8},"end":{"line":179,"column":32}},"65":{"start":{"line":180,"column":8},"end":{"line":180,"column":15}},"66":{"start":{"line":183,"column":6},"end":{"line":183,"column":23}},"67":{"start":{"line":184,"column":6},"end":{"line":184,"column":13}},"68":{"start":{"line":188,"column":4},"end":{"line":188,"column":41}},"69":{"start":{"line":191,"column":4},"end":{"line":191,"column":40}},"70":{"start":{"line":195,"column":4},"end":{"line":195,"column":62}},"71":{"start":{"line":198,"column":4},"end":{"line":211,"column":5}},"72":{"start":{"line":202,"column":6},"end":{"line":206,"column":7}},"73":{"start":{"line":203,"column":8},"end":{"line":203,"column":30}},"74":{"start":{"line":205,"column":8},"end":{"line":205,"column":39}},"75":{"start":{"line":209,"column":6},"end":{"line":209,"column":16}},"76":{"start":{"line":210,"column":6},"end":{"line":210,"column":13}},"77":{"start":{"line":223,"column":4},"end":{"line":252,"column":5}},"78":{"start":{"line":225,"column":6},"end":{"line":225,"column":31}},"79":{"start":{"line":227,"column":6},"end":{"line":250,"column":7}},"80":{"start":{"line":228,"column":8},"end":{"line":249,"column":9}},"81":{"start":{"line":229,"column":10},"end":{"line":229,"column":47}},"82":{"start":{"line":235,"column":10},"end":{"line":238,"column":12}},"83":{"start":{"line":240,"column":10},"end":{"line":246,"column":11}},"84":{"start":{"line":241,"column":12},"end":{"line":241,"column":50}},"85":{"start":{"line":245,"column":12},"end":{"line":245,"column":43}},"86":{"start":{"line":247,"column":10},"end":{"line":247,"column":44}},"87":{"start":{"line":248,"column":10},"end":{"line":248,"column":31}},"88":{"start":{"line":251,"column":6},"end":{"line":251,"column":25}},"89":{"start":{"line":255,"column":4},"end":{"line":255,"column":14}},"90":{"start":{"line":259,"column":2},"end":{"line":262,"column":4}},"91":{"start":{"line":260,"column":4},"end":{"line":260,"column":43}},"92":{"start":{"line":261,"column":4},"end":{"line":261,"column":74}},"93":{"start":{"line":265,"column":2},"end":{"line":282,"column":4}},"94":{"start":{"line":266,"column":4},"end":{"line":269,"column":5}},"95":{"start":{"line":267,"column":6},"end":{"line":267,"column":24}},"96":{"start":{"line":268,"column":6},"end":{"line":268,"column":18}},"97":{"start":{"line":271,"column":4},"end":{"line":273,"column":5}},"98":{"start":{"line":272,"column":6},"end":{"line":272,"column":88}},"99":{"start":{"line":274,"column":4},"end":{"line":276,"column":5}},"100":{"start":{"line":275,"column":6},"end":{"line":275,"column":137}},"101":{"start":{"line":281,"column":4},"end":{"line":281,"column":55}},"102":{"start":{"line":285,"column":2},"end":{"line":295,"column":4}},"103":{"start":{"line":286,"column":4},"end":{"line":286,"column":43}},"104":{"start":{"line":288,"column":4},"end":{"line":288,"column":29}},"105":{"start":{"line":291,"column":4},"end":{"line":291,"column":32}},"106":{"start":{"line":294,"column":4},"end":{"line":294,"column":100}},"107":{"start":{"line":305,"column":2},"end":{"line":309,"column":4}},"108":{"start":{"line":306,"column":4},"end":{"line":306,"column":36}},"109":{"start":{"line":307,"column":4},"end":{"line":307,"column":36}},"110":{"start":{"line":308,"column":4},"end":{"line":308,"column":16}},"111":{"start":{"line":317,"column":2},"end":{"line":319,"column":4}},"112":{"start":{"line":318,"column":4},"end":{"line":318,"column":50}},"113":{"start":{"line":323,"column":2},"end":{"line":323,"column":13}},"114":{"start":{"line":343,"column":0},"end":{"line":360,"column":1}},"115":{"start":{"line":347,"column":2},"end":{"line":349,"column":4}},"116":{"start":{"line":348,"column":4},"end":{"line":348,"column":22}},"117":{"start":{"line":350,"column":2},"end":{"line":359,"column":4}},"118":{"start":{"line":351,"column":4},"end":{"line":354,"column":6}},"119":{"start":{"line":356,"column":7},"end":{"line":359,"column":4}},"120":{"start":{"line":370,"column":0},"end":{"line":375,"column":1}},"121":{"start":{"line":371,"column":2},"end":{"line":373,"column":3}},"122":{"start":{"line":372,"column":4},"end":{"line":372,"column":63}},"123":{"start":{"line":374,"column":2},"end":{"line":374,"column":37}},"124":{"start":{"line":380,"column":0},"end":{"line":382,"column":1}},"125":{"start":{"line":381,"column":2},"end":{"line":381,"column":23}},"126":{"start":{"line":383,"column":0},"end":{"line":383,"column":45}},"127":{"start":{"line":384,"column":0},"end":{"line":387,"column":2}},"128":{"start":{"line":385,"column":2},"end":{"line":385,"column":19}},"129":{"start":{"line":386,"column":2},"end":{"line":386,"column":9}}},"branchMap":{"1":{"line":19,"type":"binary-expr","locations":[{"start":{"line":19,"column":9},"end":{"line":19,"column":13}},{"start":{"line":19,"column":15},"end":{"line":19,"column":17}}]},"2":{"line":20,"type":"binary-expr","locations":[{"start":{"line":20,"column":8},"end":{"line":20,"column":11}},{"start":{"line":20,"column":13},"end":{"line":20,"column":15}}]},"3":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":26,"column":2}},{"start":{"line":26,"column":2},"end":{"line":26,"column":2}}]},"4":{"line":26,"type":"binary-expr","locations":[{"start":{"line":26,"column":6},"end":{"line":26,"column":30}},{"start":{"line":26,"column":34},"end":{"line":26,"column":42}}]},"5":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":2},"end":{"line":47,"column":2}},{"start":{"line":47,"column":2},"end":{"line":47,"column":2}}]},"6":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":4},"end":{"line":50,"column":4}},{"start":{"line":50,"column":4},"end":{"line":50,"column":4}}]},"7":{"line":62,"type":"binary-expr","locations":[{"start":{"line":62,"column":12},"end":{"line":62,"column":15}},{"start":{"line":62,"column":19},"end":{"line":62,"column":56}}]},"8":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":2},"end":{"line":75,"column":2}},{"start":{"line":75,"column":2},"end":{"line":75,"column":2}}]},"9":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":6},"end":{"line":92,"column":6}},{"start":{"line":92,"column":6},"end":{"line":92,"column":6}}]},"10":{"line":92,"type":"binary-expr","locations":[{"start":{"line":92,"column":10},"end":{"line":92,"column":22}},{"start":{"line":92,"column":26},"end":{"line":92,"column":50}}]},"11":{"line":98,"type":"if","locations":[{"start":{"line":98,"column":6},"end":{"line":98,"column":6}},{"start":{"line":98,"column":6},"end":{"line":98,"column":6}}]},"12":{"line":98,"type":"binary-expr","locations":[{"start":{"line":98,"column":10},"end":{"line":98,"column":22}},{"start":{"line":98,"column":26},"end":{"line":98,"column":50}}]},"13":{"line":104,"type":"if","locations":[{"start":{"line":104,"column":4},"end":{"line":104,"column":4}},{"start":{"line":104,"column":4},"end":{"line":104,"column":4}}]},"14":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":4},"end":{"line":113,"column":4}},{"start":{"line":113,"column":4},"end":{"line":113,"column":4}}]},"15":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":6},"end":{"line":114,"column":6}},{"start":{"line":114,"column":6},"end":{"line":114,"column":6}}]},"16":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":4},"end":{"line":124,"column":4}},{"start":{"line":124,"column":4},"end":{"line":124,"column":4}}]},"17":{"line":163,"type":"binary-expr","locations":[{"start":{"line":163,"column":15},"end":{"line":163,"column":25}},{"start":{"line":163,"column":29},"end":{"line":166,"column":3}}]},"18":{"line":169,"type":"binary-expr","locations":[{"start":{"line":169,"column":13},"end":{"line":169,"column":21}},{"start":{"line":169,"column":25},"end":{"line":256,"column":3}}]},"19":{"line":178,"type":"if","locations":[{"start":{"line":178,"column":6},"end":{"line":178,"column":6}},{"start":{"line":178,"column":6},"end":{"line":178,"column":6}}]},"20":{"line":178,"type":"binary-expr","locations":[{"start":{"line":178,"column":10},"end":{"line":178,"column":20}},{"start":{"line":178,"column":24},"end":{"line":178,"column":38}},{"start":{"line":178,"column":42},"end":{"line":178,"column":62}}]},"21":{"line":188,"type":"binary-expr","locations":[{"start":{"line":188,"column":18},"end":{"line":188,"column":29}},{"start":{"line":188,"column":33},"end":{"line":188,"column":40}}]},"22":{"line":195,"type":"binary-expr","locations":[{"start":{"line":195,"column":21},"end":{"line":195,"column":36}},{"start":{"line":195,"column":40},"end":{"line":195,"column":54}},{"start":{"line":195,"column":58},"end":{"line":195,"column":61}}]},"23":{"line":198,"type":"if","locations":[{"start":{"line":198,"column":4},"end":{"line":198,"column":4}},{"start":{"line":198,"column":4},"end":{"line":198,"column":4}}]},"24":{"line":202,"type":"if","locations":[{"start":{"line":202,"column":6},"end":{"line":202,"column":6}},{"start":{"line":202,"column":6},"end":{"line":202,"column":6}}]},"25":{"line":223,"type":"if","locations":[{"start":{"line":223,"column":4},"end":{"line":223,"column":4}},{"start":{"line":223,"column":4},"end":{"line":223,"column":4}}]},"26":{"line":227,"type":"if","locations":[{"start":{"line":227,"column":6},"end":{"line":227,"column":6}},{"start":{"line":227,"column":6},"end":{"line":227,"column":6}}]},"27":{"line":240,"type":"if","locations":[{"start":{"line":240,"column":10},"end":{"line":240,"column":10}},{"start":{"line":240,"column":10},"end":{"line":240,"column":10}}]},"28":{"line":240,"type":"binary-expr","locations":[{"start":{"line":240,"column":14},"end":{"line":240,"column":24}},{"start":{"line":240,"column":28},"end":{"line":240,"column":42}},{"start":{"line":240,"column":46},"end":{"line":240,"column":66}}]},"29":{"line":259,"type":"binary-expr","locations":[{"start":{"line":259,"column":13},"end":{"line":259,"column":21}},{"start":{"line":259,"column":25},"end":{"line":262,"column":3}}]},"30":{"line":261,"type":"binary-expr","locations":[{"start":{"line":261,"column":32},"end":{"line":261,"column":47}},{"start":{"line":261,"column":51},"end":{"line":261,"column":65}},{"start":{"line":261,"column":69},"end":{"line":261,"column":72}}]},"31":{"line":265,"type":"binary-expr","locations":[{"start":{"line":265,"column":15},"end":{"line":265,"column":25}},{"start":{"line":265,"column":29},"end":{"line":282,"column":3}}]},"32":{"line":266,"type":"if","locations":[{"start":{"line":266,"column":4},"end":{"line":266,"column":4}},{"start":{"line":266,"column":4},"end":{"line":266,"column":4}}]},"33":{"line":271,"type":"if","locations":[{"start":{"line":271,"column":4},"end":{"line":271,"column":4}},{"start":{"line":271,"column":4},"end":{"line":271,"column":4}}]},"34":{"line":274,"type":"if","locations":[{"start":{"line":274,"column":4},"end":{"line":274,"column":4}},{"start":{"line":274,"column":4},"end":{"line":274,"column":4}}]},"35":{"line":285,"type":"binary-expr","locations":[{"start":{"line":285,"column":17},"end":{"line":285,"column":29}},{"start":{"line":285,"column":33},"end":{"line":295,"column":3}}]},"36":{"line":294,"type":"binary-expr","locations":[{"start":{"line":294,"column":20},"end":{"line":294,"column":35}},{"start":{"line":294,"column":39},"end":{"line":294,"column":53}},{"start":{"line":294,"column":57},"end":{"line":294,"column":60}}]},"37":{"line":306,"type":"binary-expr","locations":[{"start":{"line":306,"column":18},"end":{"line":306,"column":29}},{"start":{"line":306,"column":33},"end":{"line":306,"column":35}}]},"38":{"line":318,"type":"binary-expr","locations":[{"start":{"line":318,"column":11},"end":{"line":318,"column":22}},{"start":{"line":318,"column":26},"end":{"line":318,"column":49}}]},"39":{"line":350,"type":"if","locations":[{"start":{"line":350,"column":2},"end":{"line":350,"column":2}},{"start":{"line":350,"column":2},"end":{"line":350,"column":2}}]},"40":{"line":371,"type":"if","locations":[{"start":{"line":371,"column":2},"end":{"line":371,"column":2}},{"start":{"line":371,"column":2},"end":{"line":371,"column":2}}]}},"code":["/**"," * Module dependencies"," */","var util = require('util');","var Transform = require('stream').Transform;","var _ = require('@sailshq/lodash');","var MockRes = require('mock-res');","","","/**"," * Ensure that response object has a minimum set of reasonable defaults"," * Used primarily as a test fixture."," *"," * @api private"," * @idempotent"," */","","module.exports = function _buildResponse (req, _res) {","  _res = _res||{};","  req = req||{};","","  var res;","","  // If `_res` appears to be a stream (duck-typing), then don't try","  // and turn it into a mock stream again.","  if (typeof _res === 'object' && _res.end) {","    res = _res;","  }","  else {","    res = new MockRes();","    delete res.statusCode;","  }","","","  // Ensure res.headers and res.locals exist.","  res = _.extend(res, {locals: {}, headers: {}, _headers: {}});","  res = _.extend(res, _res);","","  // Now that we're sure `res` is a Transform stream, we'll handle the two different","  // approaches which a user of the virtual request interpreter might have taken:","","  // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *","  // (1) Providing a callback function (`_clientCallback`)","  //","  // If a `_clientCallback` function was provided, also pipe `res` into a","  // fake clientRes stream where the response `body` will be buffered.","  if (res._clientCallback) {","","    // If `res._clientRes` WAS NOT provided, then create one","    if (!res._clientRes) {","      res._clientRes = new MockClientResponse();","    }","","    // Session is saved automatically since the virtual request interpreter is","    // using `express-session` directly as of https://github.com/balderdashy/sails/commit/58e93f5a5f2e667e3fbeddf5b4b356f813e3555e.","","    // The stream should trigger the callback when it finishes or errors.","    res._clientRes.on('finish', function() {","      return res._clientCallback(res._clientRes);","    });","    res._clientRes.on('error', function(err) {","      err = err || new Error('Error on response stream');","      res._clientRes.statusCode = 500;","      res._clientRes.body = err;","      return res._clientCallback(res._clientRes);","    });","","  }","  // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *","","  // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *","  // (2) Providing a Writable stream (`_clientRes`)","  //","  // If a `_clientRes` response Transform stream was provided, pipe `res` directly to it.","  if (res._clientRes) {","    res.pipe(res._clientRes);","  }","  //","  // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *","","","  // Track whether headers have been written","  // (TODO: pull all this into mock-res via a PR)","","  // res.writeHead() is wrapped in closure by the `on-header` module,","  // but it still needs the underlying impl","  res.writeHead = function ( /* statusCode, [reasonPhrase], headers */) {","    // console.log('\\n\\n• res.writeHead(%s)', Array.prototype.slice.call(arguments));","    var statusCode = +arguments[0];","    //TODO: Analyze this code, reasonPhras not used","    var reasonPhrase = (function(){","      if (arguments[2] && _.isString(arguments[1])) {","        return arguments[1];","      }","      return undefined;","    })();","    var newHeaders = (function (){","      if (arguments[2] && _.isObject(arguments[2])) {","        return arguments[2];","      }","      return arguments[1];","    })();","","    if (!statusCode) {","      throw new Error('`statusCode` must be passed to res.writeHead().');","    }","    // Set status code","    res.statusCode = statusCode;","","    // Ensure `._headers` have been merged into `.headers`","    _.extend(res.headers, res._headers);","","    if (newHeaders) {","      if (!_.isObject(newHeaders)) {","        throw new Error('`headers` must be passed to res.writeHead() as an object. Got: '+util.inspect(newHeaders, false, null));","      }","      // Set new headers","      _.extend(res.headers, newHeaders);","    }","","    // Set status code and headers on the `_clientRes` stream so they are accessible","    // to the provider of that stream.","    // (this has to happen in `send()` because the code/headers might have just changed)","    if (res._clientRes) {","      // console.log('Setting headers on clientRes- res.headers = ',res.headers);","      res._clientRes.headers = res.headers;","      res._clientRes.statusCode = res.statusCode;","    }","","  };","","","  // Wrap res.write() and res.end() to get them to call writeHead()","  var prevWrite = res.write;","  res.write = function (){","    res.writeHead(res.statusCode, _.extend(res._headers,res.headers));","    // console.log('res.write():: called writeHead with headers=',_.extend(res._headers,res.headers));","    prevWrite.apply(res, Array.prototype.slice.call(arguments));","  };","  var prevEnd = res.end;","  res.end = function (){","    res.writeHead(res.statusCode, _.extend(res._headers,res.headers));","    // console.log('our res.end() was triggered');","    // console.log('res.end():: called writeHead with headers=',_.extend(res._headers,res.headers));","    prevEnd.apply(res, Array.prototype.slice.call(arguments));","  };","","","  // we get `setHeader` from mock-res","  // see http://nodejs.org/api/http.html#http_response_setheader_name_value","  //","  // Usage:","  // response.setHeader(\"Set-Cookie\", [\"type=ninja\", \"language=javascript\"]);","","  // If we ever need to wrap it...","  //","  // var prevSetHeader = res.setHeader;","  // res.setHeader = function (){","  //   prevSetHeader.apply(res, Array.prototype.slice.call(arguments));","  // };","","  // res.status()","  res.status = res.status || function status_shim (statusCode) {","    res.statusCode = statusCode;","    return res;","  };","","  // res.send()","  res.send = res.send || function send_shim () {","    var args = normalizeResArgs(arguments);","","    // Don't allow users to respond/redirect more than once per request","    // TODO: prbly move this check to our `res.writeHead()` impl","    try {","      onlyAllowOneResponse(res);","    }","    catch (e) {","      if (req._sails && req._sails.log && req._sails.log.error) {","        req._sails.log.error(e);","        return;","      }","      // TODO: use debug()","      console.error(e);","      return;","    }","","    // Ensure charset is set","    res.charset = res.charset || 'utf-8';","","    // Ensure headers are set","    _.extend(res.headers, res._headers);","","    // Ensure statusCode is set","    // (override `this.statusCode` if `statusCode` argument specified)","    res.statusCode = args.statusCode || res.statusCode || 200;","","    // if a `_clientCallback` was specified, we'll skip the streaming stuff for res.send().","    if (res._clientCallback) {","","      // Hard-code `res.body` rather than writing to the stream.","      // (but don't include body if it is empty)","      if (args.other) {","        res.body = args.other;","        // Then expose on res._clientRes.body","        res._clientRes.body = res.body;","      }","","      // End the `res` stream (which will in turn end the `res._clientRes` stream)","      res.end();","      return;","    }","","    //","    // Otherwise, the hook using the interpreter must have provided us with a `res._clientRes` stream,","    // so we'll need to serialize everything to work w/ that stream.","    //","","    // console.log('\\n---\\nwriting to clientRes stream...');","    // console.log('res.headers =>',res.headers);","    // console.log('res._headers =>',res._headers);","","    // Write body to `res` stream","    if (args.other) {","","      var toWrite = args.other;","","      if (typeof toWrite === 'object') {","        try {","          toWrite = JSON.stringify(args.other);","","          // original way:","          // toWrite = util.inspect(toWrite);","        }","        catch(e) {","          var failedStringify = new Error(","            'Failed to stringify specified JSON response body :: ' + util.inspect(args.other) +","            '\\nError:\\n' + util.inspect(e)","          );","          // console.log('failed to stringify!');","          if (req._sails && req._sails.log && req._sails.log.error) {","            req._sails.log.error(failedStringify);","          }","          else {","            // todo: use debug()","            console.error(failedStringify);","          }","          toWrite = failedStringify.message;","          res.statusCode = 500;","        }","      }","      res.write(toWrite);","    }","","    // End the `res` stream.","    res.end();","  };","","  // res.json()","  res.json = res.json || function json_shim () {","    var args = normalizeResArgs(arguments);","    return res.send(args.other, args.statusCode || res.statusCode || 200);","  };","","  // res.render()","  res.render = res.render || function render_shim (relativeViewPath, locals, cb) {","    if (_.isFunction(arguments[1])) {","      cb = arguments[1];","      locals = {};","    }","","    if (!req._sails) {","      return  res.send(500, 'Cannot call res.render() - `req._sails` was not attached');","    }","    if (!req._sails.renderView) {","      return res.send(500, 'Cannot call res.render() - `req._sails.renderView` was not attached (perhaps `views` hook is not enabled?)');","    }","","    // TODO:","    // Instead of this shim, turn `sails.renderView` into something like","    // `sails.hooks.views.render()`, and then call it.","    return res.send(501,'Not implemented in core yet');","  };","","  // res.redirect()","  res.redirect = res.redirect || function redirect_shim () {","    var args = normalizeResArgs(arguments);","","    var address = args.other;","","    // Set location header","    res.set('Location',address);","","    // address = this.get('Location');","    return res.send(args.statusCode || res.statusCode || 302, 'Redirecting to '+encodeURI(address));","  };","","","","  /**","   * res.set( headerName, value )","   *","   * @param {[type]} headerName [description]","   * @param {[type]} value   [description]","   */","  res.set = function (headerName, value) {","    res.headers = res.headers || {};","    res.headers[headerName] = value;","    return this;","  };","","  /**","   * res.get( headerName )","   *","   * @param  {[type]} headerName [description]","   * @return {[type]}            [description]","   */","  res.get = function (headerName) {","    return res.headers && res.headers[headerName];","  };","","","","  return res;","","","};","","","/**"," * As long as one of them is a number (i.e. a status code),"," * allows a 2-nary method to be called with flip-flopped arguments:"," *    method( [statusCode|other], [statusCode|other] )"," *"," * This avoids confusing errors & provides Express 2.x backwards compat."," *"," * E.g. usage in res.send():"," *    var args    = normalizeResArgs.apply(this, arguments),"," *      body    = args.other,"," *      statusCode  = args.statusCode;"," *"," * @api private"," */","function normalizeResArgs( args ) {","","  // Traditional usage:","  // `method( other [,statusCode] )`","  var isNumeric = function (x) {","    return (+x === x);","  };","  if (isNumeric(args[0])) {","    return {","      statusCode: args[0],","      other: args[1]","    };","  }","  else return {","    statusCode: args[1],","    other: args[0]","  };","}","","","/**"," * NOTE: ALL RESPONSES (INCLUDING REDIRECTS) ARE PREVENTED ONCE THE RESPONSE HAS BEEN SENT!!"," * Even though this is not strictly required with sockets, since res.redirect()"," * is an HTTP-oriented method from Express, it's important to maintain consistency."," *"," * @api private"," */","function onlyAllowOneResponse (res) {","  if (res._virtualResponseStarted) {","    throw new Error('Cannot write to response more than once');","  }","  res._virtualResponseStarted = true;","}","","","// The constructor for clientRes stream","// (just a normal transform stream)","function MockClientResponse() {","  Transform.call(this);","}","util.inherits(MockClientResponse, Transform);","MockClientResponse.prototype._transform = function(chunk, encoding, next) {","  this.push(chunk);","  next();","};",""],"l":{"4":1,"5":1,"6":1,"7":1,"18":1,"19":0,"20":0,"22":0,"26":0,"27":0,"30":0,"31":0,"36":0,"37":0,"47":0,"50":0,"51":0,"58":0,"59":0,"61":0,"62":0,"63":0,"64":0,"65":0,"75":0,"76":0,"87":0,"89":0,"91":0,"92":0,"93":0,"95":0,"97":0,"98":0,"99":0,"101":0,"104":0,"105":0,"108":0,"111":0,"113":0,"114":0,"115":0,"118":0,"124":0,"126":0,"127":0,"134":0,"135":0,"136":0,"138":0,"140":0,"141":0,"142":0,"145":0,"163":0,"164":0,"165":0,"169":0,"170":0,"174":0,"175":0,"178":0,"179":0,"180":0,"183":0,"184":0,"188":0,"191":0,"195":0,"198":0,"202":0,"203":0,"205":0,"209":0,"210":0,"223":0,"225":0,"227":0,"228":0,"229":0,"235":0,"240":0,"241":0,"245":0,"247":0,"248":0,"251":0,"255":0,"259":0,"260":0,"261":0,"265":0,"266":0,"267":0,"268":0,"271":0,"272":0,"274":0,"275":0,"281":0,"285":0,"286":0,"288":0,"291":0,"294":0,"305":0,"306":0,"307":0,"308":0,"317":0,"318":0,"323":0,"343":1,"347":0,"348":0,"350":0,"351":0,"356":0,"370":1,"371":0,"372":0,"374":0,"380":1,"381":0,"383":1,"384":1,"385":0,"386":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/router/bindDefaultHandlers.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/router/bindDefaultHandlers.js","s":{"1":1,"2":1,"3":2,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":2,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":15,"loc":{"start":{"line":15,"column":17},"end":{"line":15,"column":33}}},"2":{"name":"(anonymous_2)","line":28,"loc":{"start":{"line":28,"column":9},"end":{"line":28,"column":33}}},"3":{"name":"(anonymous_3)","line":91,"loc":{"start":{"line":91,"column":9},"end":{"line":91,"column":28}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"2":{"start":{"line":15,"column":0},"end":{"line":124,"column":2}},"3":{"start":{"line":18,"column":2},"end":{"line":122,"column":4}},"4":{"start":{"line":40,"column":6},"end":{"line":47,"column":7}},"5":{"start":{"line":41,"column":8},"end":{"line":41,"column":82}},"6":{"start":{"line":42,"column":8},"end":{"line":46,"column":9}},"7":{"start":{"line":43,"column":10},"end":{"line":43,"column":94}},"8":{"start":{"line":45,"column":10},"end":{"line":45,"column":79}},"9":{"start":{"line":50,"column":6},"end":{"line":56,"column":114}},"10":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"11":{"start":{"line":53,"column":10},"end":{"line":53,"column":36}},"12":{"start":{"line":60,"column":6},"end":{"line":79,"column":7}},"13":{"start":{"line":62,"column":8},"end":{"line":62,"column":41}},"14":{"start":{"line":63,"column":8},"end":{"line":63,"column":29}},"15":{"start":{"line":64,"column":8},"end":{"line":64,"column":76}},"16":{"start":{"line":64,"column":53},"end":{"line":64,"column":74}},"17":{"start":{"line":65,"column":8},"end":{"line":65,"column":34}},"18":{"start":{"line":76,"column":8},"end":{"line":76,"column":89}},"19":{"start":{"line":77,"column":8},"end":{"line":77,"column":46}},"20":{"start":{"line":94,"column":6},"end":{"line":98,"column":20}},"21":{"start":{"line":95,"column":8},"end":{"line":97,"column":9}},"22":{"start":{"line":96,"column":10},"end":{"line":96,"column":32}},"23":{"start":{"line":102,"column":6},"end":{"line":120,"column":7}},"24":{"start":{"line":103,"column":8},"end":{"line":103,"column":124}},"25":{"start":{"line":104,"column":8},"end":{"line":104,"column":22}},"26":{"start":{"line":105,"column":8},"end":{"line":105,"column":15}},"27":{"start":{"line":116,"column":8},"end":{"line":116,"column":78}},"28":{"start":{"line":117,"column":8},"end":{"line":117,"column":84}},"29":{"start":{"line":118,"column":8},"end":{"line":118,"column":27}},"30":{"start":{"line":119,"column":8},"end":{"line":119,"column":15}}},"branchMap":{"1":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":6},"end":{"line":40,"column":6}},{"start":{"line":40,"column":6},"end":{"line":40,"column":6}}]},"2":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":8},"end":{"line":42,"column":8}},{"start":{"line":42,"column":8},"end":{"line":42,"column":8}}]},"3":{"line":42,"type":"binary-expr","locations":[{"start":{"line":42,"column":12},"end":{"line":42,"column":30}},{"start":{"line":42,"column":34},"end":{"line":42,"column":44}}]},"4":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":8},"end":{"line":52,"column":8}},{"start":{"line":52,"column":8},"end":{"line":52,"column":8}}]},"5":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":8},"end":{"line":64,"column":8}},{"start":{"line":64,"column":8},"end":{"line":64,"column":8}}]},"6":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":8},"end":{"line":95,"column":8}},{"start":{"line":95,"column":8},"end":{"line":95,"column":8}}]}},"code":["/**"," * Module dependencies"," */","","var _ = require('@sailshq/lodash');","","","/**"," * Default 500 and 404 handler."," * (defers to res.serverError() and res.notFound() whenever possible)"," *"," * With default hook configuration, these handlers apply to both HTTP"," * and virtual requests"," */","module.exports = function(sails) {","","","  return {","","    /**","     * Default 500 handler.","     * (for errors implicitly thrown in middleware/routes)","     *","     * @param  {*} err","     * @param  {Request} req","     * @param  {Response} res","     */","    500: function(err, req, res) {","","      // console.log('* * * FIRED DEFAULT HANDLER (500) * * *');","      // console.log('args:',arguments);","      // console.log('* * * </FIRED_DEFAULT_HANDLER_500> * * *');","      // console.log();","","      // First, check for special built-in errors from Express.","      // We don't necessarily want to treat any error that is thrown with","      // a `status` property of 400 as if it were intentional.  So we also check","      // the error message.  In Express 5, hopefully this can be improved a bit","      // further.","      if (_.isError(err)) {","        var msgMatches = err.message.match(/^Failed to decode param \\'([^']+)\\'/);","        if (err.status === 400 && msgMatches) {","          sails.log.verbose('Bad request: Could not decode the requested URL ('+req.path+')');","          // Note for future: The problematic URL section is: `msgMatches[1]`","          return res.send(400, 'Bad request: Could not decode requested URL.');","        }","      }//>-","","      // Next, try to use `res.negotiate()`, if it exists and is valid.","      try {","","        if (typeof res.negotiate === 'function') {","          return res.negotiate(err);","        }//>-","","      } catch (e) { /* ignore any unexpected error encountered when attempting to respond w/ res.negotiate(). */ }","","      // Catch-all:","      // Log a message and try to use `res.send` to respond.","      try {","","        sails.log.error('Server Error:');","        sails.log.error(err);","        if (process.env.NODE_ENV === 'production') { return res.send(500); }","        return res.send(500, err);","","      } catch (errorSendingResponse) {","","        // Serious error occurred-- unable to send response.","        //","        // Note that in the future, we could also emit an `abort` message on the request object","        // in this case-- then if an attached server is managing this request, it could monitor","        // for `abort` events and manage its private resources (e.g. TCP sockets) accordingly.","        // However, such contingencies should really handled by the underlying HTTP hook, so","        // this might not actually make sense.","        sails.log.error('But no response could be sent because another error occurred:');","        sails.log.error(errorSendingResponse);","","      }//</catch>","    },","","","","    /**","     * Default 404 handler.","     * (for unmatched routes)","     *","     * @param  {Request} req","     * @param  {Response} res","     */","    404: function(req, res) {","","      // Use `notFound` handler if it exists","      try {","        if (typeof res.notFound === 'function') {","          return res.notFound();","        }","      } catch (e) {}","","      // Catch-all:","      // Log a message and try to use `res.send` to respond.","      try {","        sails.log.verbose('A request (%s) did not match any routes, and no `res.notFound` handler is configured.', req.url);","        res.send(404);","        return;","      }","","      // Serious error occurred-- unable to send response.","      //","      // Note that in the future, we could also emit an `abort` message on the request object","      // in this case-- then if an attached server is managing this request, it could monitor","      // for `abort` events and manage its private resources (e.g. TCP sockets) accordingly.","      // However, such contingencies should really handled by the underlying HTTP hook, so","      // this might not actually make sense.","      catch (e) {","        sails.log.error('An unmatched route was encountered in a request...');","        sails.log.error('But no response could be sent because an error occurred:');","        sails.log.error(e);","        return;","      }","    }","  };","","};",""],"l":{"5":1,"15":1,"18":2,"40":0,"41":0,"42":0,"43":0,"45":0,"50":0,"52":0,"53":0,"60":0,"62":0,"63":0,"64":0,"65":0,"76":0,"77":0,"94":0,"95":0,"96":0,"102":0,"103":0,"104":0,"105":0,"116":0,"117":0,"118":0,"119":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/router/bind.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/router/bind.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":1,"26":0,"27":0,"28":0,"29":0,"30":1,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":1,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":1,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0,0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"fnMap":{"1":{"name":"bind","line":31,"loc":{"start":{"line":31,"column":0},"end":{"line":31,"column":51}}},"2":{"name":"bindRedirect","line":101,"loc":{"start":{"line":101,"column":0},"end":{"line":101,"column":55}}},"3":{"name":"(anonymous_3)","line":104,"loc":{"start":{"line":104,"column":25},"end":{"line":104,"column":44}}},"4":{"name":"bindArray","line":120,"loc":{"start":{"line":120,"column":0},"end":{"line":120,"column":48}}},"5":{"name":"(anonymous_5)","line":128,"loc":{"start":{"line":128,"column":19},"end":{"line":128,"column":32}}},"6":{"name":"bindFunction","line":141,"loc":{"start":{"line":141,"column":0},"end":{"line":141,"column":47}}},"7":{"name":"routeTargetFnWrapper","line":163,"loc":{"start":{"line":163,"column":19},"end":{"line":163,"column":65}}},"8":{"name":"(anonymous_8)","line":194,"loc":{"start":{"line":194,"column":26},"end":{"line":194,"column":43}}},"9":{"name":"(anonymous_9)","line":196,"loc":{"start":{"line":196,"column":11},"end":{"line":196,"column":36}}},"10":{"name":"(anonymous_10)","line":198,"loc":{"start":{"line":198,"column":21},"end":{"line":198,"column":44}}},"11":{"name":"(anonymous_11)","line":214,"loc":{"start":{"line":214,"column":27},"end":{"line":214,"column":49}}},"12":{"name":"(anonymous_12)","line":217,"loc":{"start":{"line":217,"column":36},"end":{"line":217,"column":52}}},"13":{"name":"(anonymous_13)","line":226,"loc":{"start":{"line":226,"column":11},"end":{"line":226,"column":36}}},"14":{"name":"(anonymous_14)","line":295,"loc":{"start":{"line":295,"column":21},"end":{"line":295,"column":36}}},"15":{"name":"sanitize","line":324,"loc":{"start":{"line":324,"column":0},"end":{"line":324,"column":47}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":38}},"3":{"start":{"line":13,"column":0},"end":{"line":13,"column":22}},"4":{"start":{"line":31,"column":0},"end":{"line":91,"column":1}},"5":{"start":{"line":32,"column":2},"end":{"line":32,"column":25}},"6":{"start":{"line":34,"column":2},"end":{"line":34,"column":73}},"7":{"start":{"line":35,"column":2},"end":{"line":35,"column":23}},"8":{"start":{"line":36,"column":2},"end":{"line":36,"column":27}},"9":{"start":{"line":37,"column":2},"end":{"line":37,"column":23}},"10":{"start":{"line":38,"column":2},"end":{"line":38,"column":29}},"11":{"start":{"line":41,"column":2},"end":{"line":44,"column":3}},"12":{"start":{"line":42,"column":4},"end":{"line":43,"column":120}},"13":{"start":{"line":47,"column":2},"end":{"line":86,"column":3}},"14":{"start":{"line":48,"column":4},"end":{"line":48,"column":57}},"15":{"start":{"line":52,"column":7},"end":{"line":86,"column":3}},"16":{"start":{"line":53,"column":4},"end":{"line":53,"column":60}},"17":{"start":{"line":57,"column":7},"end":{"line":86,"column":3}},"18":{"start":{"line":58,"column":4},"end":{"line":58,"column":60}},"19":{"start":{"line":63,"column":7},"end":{"line":86,"column":3}},"20":{"start":{"line":64,"column":4},"end":{"line":64,"column":45}},"21":{"start":{"line":65,"column":4},"end":{"line":65,"column":57}},"22":{"start":{"line":66,"column":4},"end":{"line":66,"column":53}},"23":{"start":{"line":76,"column":4},"end":{"line":81,"column":7}},"24":{"start":{"line":89,"column":2},"end":{"line":89,"column":15}},"25":{"start":{"line":101,"column":0},"end":{"line":108,"column":1}},"26":{"start":{"line":102,"column":2},"end":{"line":102,"column":25}},"27":{"start":{"line":104,"column":2},"end":{"line":107,"column":21}},"28":{"start":{"line":105,"column":4},"end":{"line":105,"column":89}},"29":{"start":{"line":106,"column":4},"end":{"line":106,"column":29}},"30":{"start":{"line":120,"column":0},"end":{"line":132,"column":1}},"31":{"start":{"line":121,"column":2},"end":{"line":121,"column":18}},"32":{"start":{"line":122,"column":2},"end":{"line":122,"column":25}},"33":{"start":{"line":124,"column":2},"end":{"line":131,"column":3}},"34":{"start":{"line":125,"column":4},"end":{"line":125,"column":80}},"35":{"start":{"line":128,"column":4},"end":{"line":130,"column":7}},"36":{"start":{"line":129,"column":6},"end":{"line":129,"column":49}},"37":{"start":{"line":141,"column":0},"end":{"line":314,"column":1}},"38":{"start":{"line":142,"column":2},"end":{"line":142,"column":25}},"39":{"start":{"line":145,"column":2},"end":{"line":145,"column":59}},"40":{"start":{"line":148,"column":2},"end":{"line":148,"column":65}},"41":{"start":{"line":149,"column":2},"end":{"line":149,"column":111}},"42":{"start":{"line":150,"column":2},"end":{"line":150,"column":103}},"43":{"start":{"line":163,"column":2},"end":{"line":182,"column":4}},"44":{"start":{"line":166,"column":4},"end":{"line":166,"column":64}},"45":{"start":{"line":171,"column":4},"end":{"line":177,"column":7}},"46":{"start":{"line":181,"column":4},"end":{"line":181,"column":23}},"47":{"start":{"line":194,"column":2},"end":{"line":204,"column":4}},"48":{"start":{"line":196,"column":4},"end":{"line":203,"column":6}},"49":{"start":{"line":198,"column":6},"end":{"line":200,"column":9}},"50":{"start":{"line":199,"column":8},"end":{"line":199,"column":46}},"51":{"start":{"line":202,"column":6},"end":{"line":202,"column":33}},"52":{"start":{"line":214,"column":2},"end":{"line":241,"column":4}},"53":{"start":{"line":217,"column":4},"end":{"line":223,"column":8}},"54":{"start":{"line":218,"column":6},"end":{"line":220,"column":7}},"55":{"start":{"line":219,"column":8},"end":{"line":219,"column":21}},"56":{"start":{"line":221,"column":6},"end":{"line":221,"column":96}},"57":{"start":{"line":222,"column":6},"end":{"line":222,"column":23}},"58":{"start":{"line":226,"column":4},"end":{"line":239,"column":6}},"59":{"start":{"line":229,"column":6},"end":{"line":234,"column":7}},"60":{"start":{"line":230,"column":8},"end":{"line":233,"column":9}},"61":{"start":{"line":232,"column":10},"end":{"line":232,"column":24}},"62":{"start":{"line":237,"column":6},"end":{"line":237,"column":32}},"63":{"start":{"line":245,"column":2},"end":{"line":245,"column":69}},"64":{"start":{"line":248,"column":2},"end":{"line":248,"column":15}},"65":{"start":{"line":251,"column":2},"end":{"line":251,"column":37}},"66":{"start":{"line":254,"column":2},"end":{"line":254,"column":39}},"67":{"start":{"line":258,"column":2},"end":{"line":267,"column":3}},"68":{"start":{"line":259,"column":4},"end":{"line":259,"column":34}},"69":{"start":{"line":260,"column":4},"end":{"line":260,"column":39}},"70":{"start":{"line":261,"column":4},"end":{"line":261,"column":41}},"71":{"start":{"line":266,"column":4},"end":{"line":266,"column":26}},"72":{"start":{"line":270,"column":2},"end":{"line":278,"column":3}},"73":{"start":{"line":271,"column":4},"end":{"line":273,"column":5}},"74":{"start":{"line":272,"column":6},"end":{"line":272,"column":46}},"75":{"start":{"line":277,"column":4},"end":{"line":277,"column":27}},"76":{"start":{"line":282,"column":2},"end":{"line":284,"column":3}},"77":{"start":{"line":283,"column":4},"end":{"line":283,"column":44}},"78":{"start":{"line":288,"column":2},"end":{"line":290,"column":3}},"79":{"start":{"line":289,"column":4},"end":{"line":289,"column":63}},"80":{"start":{"line":293,"column":2},"end":{"line":293,"column":62}},"81":{"start":{"line":293,"column":35},"end":{"line":293,"column":61}},"82":{"start":{"line":295,"column":2},"end":{"line":311,"column":5}},"83":{"start":{"line":296,"column":4},"end":{"line":296,"column":30}},"84":{"start":{"line":298,"column":4},"end":{"line":298,"column":54}},"85":{"start":{"line":303,"column":4},"end":{"line":309,"column":7}},"86":{"start":{"line":324,"column":0},"end":{"line":349,"column":1}},"87":{"start":{"line":325,"column":2},"end":{"line":325,"column":26}},"88":{"start":{"line":328,"column":2},"end":{"line":328,"column":36}},"89":{"start":{"line":331,"column":2},"end":{"line":331,"column":48}},"90":{"start":{"line":333,"column":2},"end":{"line":333,"column":31}},"91":{"start":{"line":335,"column":2},"end":{"line":335,"column":38}},"92":{"start":{"line":339,"column":2},"end":{"line":341,"column":3}},"93":{"start":{"line":340,"column":4},"end":{"line":340,"column":29}},"94":{"start":{"line":343,"column":2},"end":{"line":348,"column":4}}},"branchMap":{"1":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":2},"end":{"line":41,"column":2}},{"start":{"line":41,"column":2},"end":{"line":41,"column":2}}]},"2":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":2},"end":{"line":47,"column":2}},{"start":{"line":47,"column":2},"end":{"line":47,"column":2}}]},"3":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":7},"end":{"line":52,"column":7}},{"start":{"line":52,"column":7},"end":{"line":52,"column":7}}]},"4":{"line":52,"type":"binary-expr","locations":[{"start":{"line":52,"column":11},"end":{"line":52,"column":29}},{"start":{"line":52,"column":33},"end":{"line":52,"column":62}}]},"5":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":7},"end":{"line":57,"column":7}},{"start":{"line":57,"column":7},"end":{"line":57,"column":7}}]},"6":{"line":63,"type":"if","locations":[{"start":{"line":63,"column":7},"end":{"line":63,"column":7}},{"start":{"line":63,"column":7},"end":{"line":63,"column":7}}]},"7":{"line":63,"type":"binary-expr","locations":[{"start":{"line":63,"column":11},"end":{"line":63,"column":34}},{"start":{"line":63,"column":39},"end":{"line":63,"column":52}},{"start":{"line":63,"column":56},"end":{"line":63,"column":65}}]},"8":{"line":64,"type":"binary-expr","locations":[{"start":{"line":64,"column":18},"end":{"line":64,"column":31}},{"start":{"line":64,"column":35},"end":{"line":64,"column":44}}]},"9":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":2},"end":{"line":124,"column":2}},{"start":{"line":124,"column":2},"end":{"line":124,"column":2}}]},"10":{"line":148,"type":"cond-expr","locations":[{"start":{"line":148,"column":39},"end":{"line":148,"column":59}},{"start":{"line":148,"column":62},"end":{"line":148,"column":64}}]},"11":{"line":149,"type":"binary-expr","locations":[{"start":{"line":149,"column":24},"end":{"line":149,"column":47}},{"start":{"line":149,"column":51},"end":{"line":149,"column":69}},{"start":{"line":149,"column":74},"end":{"line":149,"column":81}},{"start":{"line":149,"column":86},"end":{"line":149,"column":108}}]},"12":{"line":150,"type":"binary-expr","locations":[{"start":{"line":150,"column":39},"end":{"line":150,"column":43}},{"start":{"line":150,"column":47},"end":{"line":150,"column":49}}]},"13":{"line":150,"type":"cond-expr","locations":[{"start":{"line":150,"column":74},"end":{"line":150,"column":97}},{"start":{"line":150,"column":99},"end":{"line":150,"column":101}}]},"14":{"line":166,"type":"binary-expr","locations":[{"start":{"line":166,"column":30},"end":{"line":166,"column":37}},{"start":{"line":166,"column":41},"end":{"line":166,"column":43}}]},"15":{"line":166,"type":"binary-expr","locations":[{"start":{"line":166,"column":45},"end":{"line":166,"column":56}},{"start":{"line":166,"column":60},"end":{"line":166,"column":62}}]},"16":{"line":218,"type":"if","locations":[{"start":{"line":218,"column":6},"end":{"line":218,"column":6}},{"start":{"line":218,"column":6},"end":{"line":218,"column":6}}]},"17":{"line":230,"type":"if","locations":[{"start":{"line":230,"column":8},"end":{"line":230,"column":8}},{"start":{"line":230,"column":8},"end":{"line":230,"column":8}}]},"18":{"line":245,"type":"binary-expr","locations":[{"start":{"line":245,"column":19},"end":{"line":245,"column":23}},{"start":{"line":245,"column":27},"end":{"line":245,"column":68}}]},"19":{"line":258,"type":"if","locations":[{"start":{"line":258,"column":2},"end":{"line":258,"column":2}},{"start":{"line":258,"column":2},"end":{"line":258,"column":2}}]},"20":{"line":270,"type":"if","locations":[{"start":{"line":270,"column":2},"end":{"line":270,"column":2}},{"start":{"line":270,"column":2},"end":{"line":270,"column":2}}]},"21":{"line":271,"type":"if","locations":[{"start":{"line":271,"column":4},"end":{"line":271,"column":4}},{"start":{"line":271,"column":4},"end":{"line":271,"column":4}}]},"22":{"line":282,"type":"if","locations":[{"start":{"line":282,"column":2},"end":{"line":282,"column":2}},{"start":{"line":282,"column":2},"end":{"line":282,"column":2}}]},"23":{"line":288,"type":"if","locations":[{"start":{"line":288,"column":2},"end":{"line":288,"column":2}},{"start":{"line":288,"column":2},"end":{"line":288,"column":2}}]},"24":{"line":293,"type":"if","locations":[{"start":{"line":293,"column":2},"end":{"line":293,"column":2}},{"start":{"line":293,"column":2},"end":{"line":293,"column":2}}]},"25":{"line":325,"type":"binary-expr","locations":[{"start":{"line":325,"column":12},"end":{"line":325,"column":19}},{"start":{"line":325,"column":23},"end":{"line":325,"column":25}}]},"26":{"line":328,"type":"cond-expr","locations":[{"start":{"line":328,"column":24},"end":{"line":328,"column":28}},{"start":{"line":328,"column":31},"end":{"line":328,"column":35}}]},"27":{"line":339,"type":"if","locations":[{"start":{"line":339,"column":2},"end":{"line":339,"column":2}},{"start":{"line":339,"column":2},"end":{"line":339,"column":2}}]}},"code":["/**"," * Module dependencies."," */","","var _ = require('@sailshq/lodash');","var sailsUtil = require('sails-util');","","","","/**"," * Expose `bind` method."," */","module.exports = bind;","","","","/**"," * Bind new route(s)"," *"," * @param {String|RegExp} path"," * @param {String|Object|Array|Function} target"," * @param {String} verb (optional)"," * @param {Object} options (optional)"," *"," * @this {SJSRouter}"," * @return {SJSApp}"," *"," * @api private"," */","","function bind( /* path, target, verb, options */ ) {","  var sails = this.sails;","","  var args = sanitize.apply(this, Array.prototype.slice.call(arguments));","  var path = args.path;","  var target = args.target;","  var verb = args.verb;","  var options = args.options;","","  // Don't allow paths with \"length\" as a route param, because Express chokes on it","  if (path.match(/\\/:length($|\\/)/)) {","    throw new Error('Failed to bind route: `'+ path +'`\\n'+","    'Routes which contain `/:length` in their address URL are not supported by Sails/Express (consider using `/:len`)');","  }","","  // Bind a list of multiple functions in order","  if (_.isArray(target)) {","    bindArray.apply(this, [path, target, verb, options]);","  }","  // Handle string redirects","  // (to either public-facing URLs or internal routes)","  else if (_.isString(target) && target.match(/^(https?:|\\/)/)) {","    bindRedirect.apply(this, [path, target, verb, options]);","  }","","  // Bind a middleware function directly","  else if (_.isFunction(target)) {","    bindFunction.apply(this, [path, target, verb, options]);","  }","","  // If target is an object with a `target`, pull out the rest","  // of the keys as route options and then bind the target.","  else if (_.isPlainObject(target) && (target.target || target.fn)) {","    var _target = target.target || target.fn;","    options = _.merge(options, _.omit(target, 'target'));","    bind.apply(this, [path, _target, verb, options]);","  }","  else {","","    // If we make it here, the router doesn't know how to parse the target.","    //","    // This doesn't mean that it's necessarily invalid though--","    // so we'll emit an event informing any listeners that an unrecognized route","    // target was encountered.  Then hooks can listen to this event and act","    // accordingly.  This makes it easier to add functionality to Sails.","    sails.emit('route:typeUnknown', {","      path: path,","      target: target,","      verb: verb,","      options: options","    });","","    // Note that, in the future, it would be good to track emissions of \"typeUnknown\" to","    // avoid logic errors that result in circular routes.","    // (part of the effort to make a more friendly environment for custom hook developers)","  }","","  // Makes `.bind()` chainable (sort of)","  return sails;","","}","","","","/**"," * Requests will be redirected to the specified string"," * (which should be a URL or redirectable path.)"," *"," * @api private"," */","function bindRedirect(path, redirectTo, verb, options) {","  var sails = this.sails;","","  bind.apply(this,[path, function(req, res) {","    sails.log.verbose('Redirecting request (`' + path + '`) to `' + redirectTo + '`...');","    res.redirect(redirectTo);","  }, verb, options]);","}","","","/**"," * Recursively bind an array of targets in order"," *"," * TODO: Use a counter to prevent indefinite loops--"," * only possible if a bad route is bound,"," * but would still potentially be helpful."," *"," * @api private"," */","function bindArray(path, target, verb, options) {","  var self = this;","  var sails = this.sails;","","  if (target.length === 0) {","    sails.log.verbose('Ignoring empty array in `router.bind(' + path + ')`...');","  } else {","    // Bind each middleware fn","    _.each(target, function(fn) {","      bind.apply(self,[path, fn, verb, options]);","    });","  }","}","","","","/**"," * Attach middleware function to route."," *"," * @api private"," */","function bindFunction(path, fn, verb, options) {","  var sails = this.sails;","","  // Regex to check if a URL is an asset (something with a file extension)","  var skipAssetsRegex = /^[^?]*\\/[^?\\/]+\\.[^?\\/]+(\\?.*)?$/;","","  // Make sure (optional) options is a valid plain object ({})","  options = _.isPlainObject(options) ? _.cloneDeep(options) : {};","  var _middlewareType = options._middlewareType || fn._middlewareType || (fn.name && ('FUNCTION: ' + fn.name));","  sails.log.silly('Binding route :: ', verb || '', path, _middlewareType?('('+_middlewareType+')'):'');","","","  /**","   * `router:route`","   *","   * Create a closure that emits the `router:route` event each time the route is hit","   * before actually triggering the target function.","   *","   * NOTE: Modifications to route path parameters (i.e. `req.params`) or to `req.options`","   * must be made here, since their values can change not only on a per-request, but","   * also a per-route basis.","   */","  var enhancedFn = function routeTargetFnWrapper(req, res, next) {","","    // Set req.options, using `options` to supply default values","    req.options = _.merge({}, options || {}, req.options || {});","","    // This event can be tapped into to take control of","    // (synchronous) logic that should be run before each bound","    // route handler function runs.","    sails.emit('router:route', {","      req: req,","      res: res,","      next: next,","      options: options,","      fn: fn","    });","","","    // Trigger original route handler function.","    fn(req, res, next);","  };","","  /**","   * Wrap a regex route in a helper function that pulls out regex params","   *","   * Example: for route: 'r|/\\\\d+/(.*)/(.*)$|foo,bar', the two parenthesized","   * groups would be pulled out as req.params[0] and req.params[1] by Express;","   * the regexRouteWrapper would then map them to req.params['foo'] and req.params['bar']","   *","   * @param  {array} params List of params to apply to the req.params object","   * @return {Function} A middleware function","   */","  var regexRouteWrapper = function(params) {","","    return function(req, res, next) {","      // Apply the regex route params","      params.forEach(function(param, index) {","        req.params[param] = req.params[index];","      });","      // Call enhancedFn","      enhancedFn(req, res, next);","    };","  };","","  /**","   * Wrap a route in a helper function that first checks whether the URL matches","   * any of a set of regexes, and if so, skips the defined handler.","   *","   * @param  {array}   regexes Array of regexes to match the URL against","   * @param  {Function} fn      Middleware function to run if URL does NOT match regexes","   * @return {Function} A middleware function","   */","  var skipRegexesWrapper = function(regexes, fn) {","","    // Remove anything that's not a regex","    regexes = _.compact(regexes.map(function(regex) {","      if (regex instanceof RegExp) {","        return regex;","      }","      sails.log.warn('Invalid regex \"' + regex + \"' supplied to skipRegexesWrapper; ignoring.\");","      return undefined;","    }));","","","    return function(req, res, next) {","","      // Check for matches","      for (var i = 0; i < regexes.length; i++) {","        if (req.url.match(regexes[i])) {","          // If we find one, bail out","          return next();","        }","      }","","      // Otherwise continue with the handler","      return fn(req, res, next);","","    };","","  };","","  // If verb is not specified, default to CRUD methods.","  // You can still explicitly route to \"all /path\" if you want ALLLLlllll the things.","  var targetVerb = verb || ['get', 'put', 'post', 'delete', 'patch'];","","  // Function to actually bind","  var targetFn;","","  // Regex to check if the route is...a regex.","  var regExRoute = /^r\\|(.*)\\|(.*)$/;","","  // Perform the check","  var matches = path.match(regExRoute);","","  // If it *is* a regex, create a RegExp object that Express can bind,","  // pull out the params, and wrap the handler in regexRouteWrapper","  if (matches) {","    path = new RegExp(matches[1]);","    var params = matches[2].split(',');","    targetFn = regexRouteWrapper(params);","  }","","  // Otherwise just bind enhancedFn","  else {","    targetFn = enhancedFn;","  }","","  // If options.skipRegex is specified, make sure it's an array","  if (options.skipRegex) {","    if (!Array.isArray(options.skipRegex)) {","      options.skipRegex = [options.skipRegex];","    }","  }","  // Otherwise just make it an empty array","  else {","    options.skipRegex = [];","  }","","  // If \"skipAssets\" option is true, add the skipAssets regex","  // to the options.skipRegex array","  if (options.skipAssets) {","    options.skipRegex.push(skipAssetsRegex);","  }","","  // If we have anything in the options.skipRegex array, wrap","  // the target function again.","  if (options.skipRegex.length) {","    targetFn = skipRegexesWrapper(options.skipRegex, targetFn);","  }","","  // Ensure targetVerb is an array","  if (!Array.isArray(targetVerb)) {targetVerb = [targetVerb];}","  // Loop through the verbs we want to bind","  targetVerb.forEach(function(verb) {","    verb = verb.toLowerCase();","    // Bind the function to the private router","    sails.router._privateRouter[verb](path, targetFn);","    // Emit an event to make hooks aware that a route was bound","    // This allows hooks to handle routes directly if they want to-","    // e.g. with Express, the handler for this event looks like:","    // sails.hooks.http.app[verb || 'all'](path, target);","    sails.emit('router:bind', {","      path: path,","      target: targetFn,","      verb: verb,","      options: options,","      originalFn: fn","    });","","  });","","","}","","","","/**"," * Sanitize the arguments to `sails.router.bind()`"," *"," * @returns {Object} sanitized arguments"," * @api private"," */","function sanitize(path, target, verb, options) {","  options = options || {};","","  // If trying to bind '*', that's probably not what was intended, so fix it up","  path = path === '*' ? '/*' : path;","","  // If route has an HTTP verb (e.g. `get /foo/bar`, `put /bar/foo`, etc.) parse it out,","  var detectedVerb = sailsUtil.detectVerb(path);","  // then prune it from the path","  path = detectedVerb.original;","  // Keep track of parsed verb so we know if it was specified later","  options.detectedVerb = detectedVerb;","","  // If a verb override was not specified,","  // use the detected verb from the string route","  if (!verb) {","    verb = detectedVerb.verb;","  }","","  return {","    path: path,","    target: target,","    verb: verb,","    options: options","  };","}",""],"l":{"5":1,"6":1,"13":1,"31":1,"32":0,"34":0,"35":0,"36":0,"37":0,"38":0,"41":0,"42":0,"47":0,"48":0,"52":0,"53":0,"57":0,"58":0,"63":0,"64":0,"65":0,"66":0,"76":0,"89":0,"101":1,"102":0,"104":0,"105":0,"106":0,"120":1,"121":0,"122":0,"124":0,"125":0,"128":0,"129":0,"141":1,"142":0,"145":0,"148":0,"149":0,"150":0,"163":0,"166":0,"171":0,"181":0,"194":0,"196":0,"198":0,"199":0,"202":0,"214":0,"217":0,"218":0,"219":0,"221":0,"222":0,"226":0,"229":0,"230":0,"232":0,"237":0,"245":0,"248":0,"251":0,"254":0,"258":0,"259":0,"260":0,"261":0,"266":0,"270":0,"271":0,"272":0,"277":0,"282":0,"283":0,"288":0,"289":0,"293":0,"295":0,"296":0,"298":0,"303":0,"324":1,"325":0,"328":0,"331":0,"333":0,"335":0,"339":0,"340":0,"343":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/lift.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/lift.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":1,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"lift","line":17,"loc":{"start":{"line":17,"column":17},"end":{"line":17,"column":51}}},"2":{"name":"(anonymous_2)","line":27,"loc":{"start":{"line":27,"column":13},"end":{"line":27,"column":27}}},"3":{"name":"(anonymous_3)","line":33,"loc":{"start":{"line":33,"column":4},"end":{"line":33,"column":17}}},"4":{"name":"sailsReady","line":39,"loc":{"start":{"line":39,"column":5},"end":{"line":39,"column":42}}},"5":{"name":"(anonymous_5)","line":41,"loc":{"start":{"line":41,"column":25},"end":{"line":41,"column":54}}},"6":{"name":"_printSuccessMsg","line":62,"loc":{"start":{"line":62,"column":0},"end":{"line":62,"column":33}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":35}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":29}},"4":{"start":{"line":17,"column":0},"end":{"line":57,"column":2}},"5":{"start":{"line":18,"column":2},"end":{"line":18,"column":19}},"6":{"start":{"line":21,"column":2},"end":{"line":24,"column":3}},"7":{"start":{"line":22,"column":4},"end":{"line":22,"column":24}},"8":{"start":{"line":23,"column":4},"end":{"line":23,"column":24}},"9":{"start":{"line":27,"column":2},"end":{"line":29,"column":4}},"10":{"start":{"line":28,"column":4},"end":{"line":28,"column":41}},"11":{"start":{"line":28,"column":13},"end":{"line":28,"column":41}},"12":{"start":{"line":31,"column":2},"end":{"line":56,"column":5}},"13":{"start":{"line":34,"column":6},"end":{"line":34,"column":37}},"14":{"start":{"line":40,"column":4},"end":{"line":47,"column":5}},"15":{"start":{"line":41,"column":6},"end":{"line":46,"column":9}},"16":{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},"17":{"start":{"line":43,"column":10},"end":{"line":43,"column":129}},"18":{"start":{"line":45,"column":8},"end":{"line":45,"column":16}},"19":{"start":{"line":49,"column":4},"end":{"line":49,"column":28}},"20":{"start":{"line":53,"column":4},"end":{"line":53,"column":25}},"21":{"start":{"line":54,"column":4},"end":{"line":54,"column":26}},"22":{"start":{"line":55,"column":4},"end":{"line":55,"column":27}},"23":{"start":{"line":62,"column":0},"end":{"line":84,"column":1}},"24":{"start":{"line":65,"column":2},"end":{"line":83,"column":3}},"25":{"start":{"line":67,"column":4},"end":{"line":67,"column":39}},"26":{"start":{"line":68,"column":4},"end":{"line":68,"column":72}},"27":{"start":{"line":69,"column":4},"end":{"line":69,"column":93}},"28":{"start":{"line":70,"column":4},"end":{"line":70,"column":74}},"29":{"start":{"line":71,"column":4},"end":{"line":71,"column":22}},"30":{"start":{"line":72,"column":4},"end":{"line":72,"column":47}},"31":{"start":{"line":73,"column":4},"end":{"line":73,"column":46}},"32":{"start":{"line":74,"column":4},"end":{"line":74,"column":22}},"33":{"start":{"line":75,"column":4},"end":{"line":75,"column":59}},"34":{"start":{"line":78,"column":4},"end":{"line":80,"column":5}},"35":{"start":{"line":79,"column":6},"end":{"line":79,"column":52}},"36":{"start":{"line":81,"column":4},"end":{"line":81,"column":52}},"37":{"start":{"line":82,"column":4},"end":{"line":82,"column":47}}},"branchMap":{"1":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":2},"end":{"line":21,"column":2}},{"start":{"line":21,"column":2},"end":{"line":21,"column":2}}]},"2":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":7},"end":{"line":27,"column":9}},{"start":{"line":27,"column":13},"end":{"line":29,"column":3}}]},"3":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":28,"column":4}},{"start":{"line":28,"column":4},"end":{"line":28,"column":4}}]},"4":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":40,"column":4}},{"start":{"line":40,"column":4},"end":{"line":40,"column":4}}]},"5":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":8},"end":{"line":42,"column":8}},{"start":{"line":42,"column":8},"end":{"line":42,"column":8}}]},"6":{"line":65,"type":"if","locations":[{"start":{"line":65,"column":2},"end":{"line":65,"column":2}},{"start":{"line":65,"column":2},"end":{"line":65,"column":2}}]},"7":{"line":65,"type":"binary-expr","locations":[{"start":{"line":65,"column":8},"end":{"line":65,"column":24}},{"start":{"line":65,"column":28},"end":{"line":65,"column":51}}]},"8":{"line":67,"type":"binary-expr","locations":[{"start":{"line":67,"column":4},"end":{"line":67,"column":18}},{"start":{"line":67,"column":22},"end":{"line":67,"column":38}}]},"9":{"line":69,"type":"binary-expr","locations":[{"start":{"line":69,"column":64},"end":{"line":69,"column":83}},{"start":{"line":69,"column":87},"end":{"line":69,"column":89}}]},"10":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":4},"end":{"line":78,"column":4}},{"start":{"line":78,"column":4},"end":{"line":78,"column":4}}]}},"code":["/**"," * Module dependencies."," */","","var async = require('async');","var _ = require('@sailshq/lodash');","var chalk = require('chalk');","","/**"," * Sails.prototype.lift()"," *"," * Loads the app, then starts all attached servers."," *"," * @api public"," */","","module.exports = function lift(configOverride, cb) {","  var sails = this;","","  // configOverride is optional","  if (_.isFunction(configOverride)) {","    cb = configOverride;","    configOverride = {};","  }","","  // Callback is optional","  cb = cb || function(err) {","    if (err) return sails.log.error(err);","  };","","  async.series([","","    function(cb) {","      sails.load(configOverride, cb);","    },","","    sails.initialize","","  ], function sailsReady(err, async_data) { //TODO: unused variable async_data","    if (err) {","      return sails.lower(function (errorLoweringSails){","        if (errorLoweringSails) {","          sails.log.error('When trying to lower the app as a result of a failed lift, encountered an error:',errorLoweringSails);","        }","        cb(err);","      });","    }","","    _printSuccessMsg(sails);","","    // try {console.timeEnd('core_lift');}catch(e){}","","    sails.emit('lifted');","    sails.isLifted = true;","    return cb(null, sails);","  });","};","","","","// Gather app meta-info and log startup message (the boat).","function _printSuccessMsg(sails) {","","  // If `config.noShip` is set, skip the startup message.","  if (!(sails.config.log && sails.config.log.noShip)) {","","    sails.log.ship && sails.log.ship();","    sails.log.info(('Server lifted in `' + sails.config.appPath + '`'));","    sails.log.info(chalk.underline('To see your app, visit ' + (sails._getBaseUrl() || '')));","    sails.log.info(('To shut down Sails, press <CTRL> + C at any time.'));","    sails.log.blank();","    sails.log(chalk.grey(Array(56).join('-')));","    sails.log(chalk.grey(':: ' + new Date()));","    sails.log.blank();","    sails.log('Environment : ' + sails.config.environment);","","    // Only log the host if an explicit host is set","    if (sails.getHost()) {","      sails.log('Host        : ' + sails.getHost()); // 12 - 4 = 8 spaces","    }","    sails.log('Port        : ' + sails.config.port); // 12 - 4 = 8 spaces","    sails.log(chalk.grey(Array(56).join('-')));","  }","}",""],"l":{"5":1,"6":1,"7":1,"17":1,"18":0,"21":0,"22":0,"23":0,"27":0,"28":0,"31":0,"34":0,"40":0,"41":0,"42":0,"43":0,"45":0,"49":0,"53":0,"54":0,"55":0,"62":1,"65":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"78":0,"79":0,"81":0,"82":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/lower.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/lower.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":1,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0,0],"7":[0,0],"8":[0,0],"9":[0,0,0,0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0,0],"19":[0,0],"20":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"fnMap":{"1":{"name":"lower","line":20,"loc":{"start":{"line":20,"column":17},"end":{"line":20,"column":45}}},"2":{"name":"(anonymous_2)","line":32,"loc":{"start":{"line":32,"column":13},"end":{"line":32,"column":27}}},"3":{"name":"(anonymous_3)","line":44,"loc":{"start":{"line":44,"column":72},"end":{"line":44,"column":85}}},"4":{"name":"(anonymous_4)","line":49,"loc":{"start":{"line":49,"column":17},"end":{"line":49,"column":31}}},"5":{"name":"kill","line":57,"loc":{"start":{"line":57,"column":33},"end":{"line":57,"column":61}}},"6":{"name":"shutdownSockets","line":75,"loc":{"start":{"line":75,"column":6},"end":{"line":75,"column":35}}},"7":{"name":"(anonymous_7)","line":90,"loc":{"start":{"line":90,"column":31},"end":{"line":90,"column":42}}},"8":{"name":"onClose","line":103,"loc":{"start":{"line":103,"column":8},"end":{"line":103,"column":27}}},"9":{"name":"shutdownHTTP","line":111,"loc":{"start":{"line":111,"column":6},"end":{"line":111,"column":32}}},"10":{"name":"(anonymous_10)","line":147,"loc":{"start":{"line":147,"column":48},"end":{"line":147,"column":60}}},"11":{"name":"removeListeners","line":160,"loc":{"start":{"line":160,"column":6},"end":{"line":160,"column":35}}},"12":{"name":"(anonymous_12)","line":162,"loc":{"start":{"line":162,"column":42},"end":{"line":162,"column":62}}},"13":{"name":"(anonymous_13)","line":185,"loc":{"start":{"line":185,"column":7},"end":{"line":185,"column":22}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":35}},"3":{"start":{"line":20,"column":0},"end":{"line":206,"column":2}},"4":{"start":{"line":21,"column":2},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":2},"end":{"line":23,"column":41}},"6":{"start":{"line":26,"column":2},"end":{"line":29,"column":3}},"7":{"start":{"line":27,"column":4},"end":{"line":27,"column":17}},"8":{"start":{"line":28,"column":4},"end":{"line":28,"column":19}},"9":{"start":{"line":32,"column":2},"end":{"line":34,"column":4}},"10":{"start":{"line":33,"column":4},"end":{"line":33,"column":46}},"11":{"start":{"line":33,"column":16},"end":{"line":33,"column":44}},"12":{"start":{"line":36,"column":2},"end":{"line":36,"column":26}},"13":{"start":{"line":37,"column":2},"end":{"line":37,"column":39}},"14":{"start":{"line":42,"column":2},"end":{"line":42,"column":24}},"15":{"start":{"line":44,"column":2},"end":{"line":46,"column":4}},"16":{"start":{"line":45,"column":4},"end":{"line":45,"column":16}},"17":{"start":{"line":49,"column":2},"end":{"line":204,"column":5}},"18":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"19":{"start":{"line":53,"column":6},"end":{"line":53,"column":27}},"20":{"start":{"line":57,"column":4},"end":{"line":64,"column":7}},"21":{"start":{"line":58,"column":6},"end":{"line":58,"column":91}},"22":{"start":{"line":59,"column":6},"end":{"line":63,"column":7}},"23":{"start":{"line":60,"column":8},"end":{"line":60,"column":36}},"24":{"start":{"line":62,"column":8},"end":{"line":62,"column":101}},"25":{"start":{"line":67,"column":4},"end":{"line":67,"column":24}},"26":{"start":{"line":73,"column":4},"end":{"line":202,"column":7}},"27":{"start":{"line":82,"column":8},"end":{"line":84,"column":9}},"28":{"start":{"line":83,"column":10},"end":{"line":83,"column":22}},"29":{"start":{"line":86,"column":8},"end":{"line":86,"column":20}},"30":{"start":{"line":88,"column":8},"end":{"line":101,"column":9}},"31":{"start":{"line":89,"column":10},"end":{"line":89,"column":62}},"32":{"start":{"line":90,"column":10},"end":{"line":93,"column":18}},"33":{"start":{"line":91,"column":12},"end":{"line":91,"column":65}},"34":{"start":{"line":92,"column":12},"end":{"line":92,"column":24}},"35":{"start":{"line":94,"column":10},"end":{"line":94,"column":38}},"36":{"start":{"line":95,"column":10},"end":{"line":95,"column":53}},"37":{"start":{"line":96,"column":10},"end":{"line":96,"column":27}},"38":{"start":{"line":98,"column":10},"end":{"line":98,"column":73}},"39":{"start":{"line":99,"column":10},"end":{"line":99,"column":32}},"40":{"start":{"line":100,"column":10},"end":{"line":100,"column":15}},"41":{"start":{"line":103,"column":8},"end":{"line":107,"column":9}},"42":{"start":{"line":104,"column":10},"end":{"line":104,"column":69}},"43":{"start":{"line":105,"column":10},"end":{"line":105,"column":32}},"44":{"start":{"line":106,"column":10},"end":{"line":106,"column":15}},"45":{"start":{"line":112,"column":8},"end":{"line":114,"column":9}},"46":{"start":{"line":113,"column":10},"end":{"line":113,"column":22}},"47":{"start":{"line":116,"column":8},"end":{"line":116,"column":20}},"48":{"start":{"line":118,"column":8},"end":{"line":157,"column":9}},"49":{"start":{"line":119,"column":10},"end":{"line":119,"column":60}},"50":{"start":{"line":122,"column":10},"end":{"line":122,"column":42}},"51":{"start":{"line":129,"column":10},"end":{"line":131,"column":11}},"52":{"start":{"line":130,"column":12},"end":{"line":130,"column":29}},"53":{"start":{"line":135,"column":10},"end":{"line":144,"column":11}},"54":{"start":{"line":136,"column":12},"end":{"line":136,"column":39}},"55":{"start":{"line":142,"column":12},"end":{"line":142,"column":74}},"56":{"start":{"line":143,"column":12},"end":{"line":143,"column":44}},"57":{"start":{"line":147,"column":10},"end":{"line":151,"column":13}},"58":{"start":{"line":148,"column":12},"end":{"line":148,"column":69}},"59":{"start":{"line":149,"column":12},"end":{"line":149,"column":34}},"60":{"start":{"line":150,"column":12},"end":{"line":150,"column":17}},"61":{"start":{"line":154,"column":10},"end":{"line":154,"column":71}},"62":{"start":{"line":155,"column":10},"end":{"line":155,"column":32}},"63":{"start":{"line":156,"column":10},"end":{"line":156,"column":15}},"64":{"start":{"line":162,"column":8},"end":{"line":164,"column":11}},"65":{"start":{"line":163,"column":10},"end":{"line":163,"column":46}},"66":{"start":{"line":166,"column":8},"end":{"line":166,"column":48}},"67":{"start":{"line":167,"column":8},"end":{"line":172,"column":9}},"68":{"start":{"line":168,"column":10},"end":{"line":168,"column":63}},"69":{"start":{"line":169,"column":10},"end":{"line":169,"column":61}},"70":{"start":{"line":170,"column":10},"end":{"line":170,"column":63}},"71":{"start":{"line":171,"column":10},"end":{"line":171,"column":57}},"72":{"start":{"line":173,"column":8},"end":{"line":173,"column":39}},"73":{"start":{"line":178,"column":8},"end":{"line":181,"column":9}},"74":{"start":{"line":179,"column":10},"end":{"line":179,"column":120}},"75":{"start":{"line":180,"column":10},"end":{"line":180,"column":39}},"76":{"start":{"line":183,"column":8},"end":{"line":183,"column":13}},"77":{"start":{"line":186,"column":6},"end":{"line":191,"column":7}},"78":{"start":{"line":189,"column":8},"end":{"line":189,"column":91}},"79":{"start":{"line":190,"column":8},"end":{"line":190,"column":23}},"80":{"start":{"line":196,"column":6},"end":{"line":198,"column":7}},"81":{"start":{"line":197,"column":8},"end":{"line":197,"column":57}},"82":{"start":{"line":200,"column":6},"end":{"line":200,"column":18}}},"branchMap":{"1":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":26,"column":2}},{"start":{"line":26,"column":2},"end":{"line":26,"column":2}}]},"2":{"line":32,"type":"binary-expr","locations":[{"start":{"line":32,"column":7},"end":{"line":32,"column":9}},{"start":{"line":32,"column":13},"end":{"line":34,"column":3}}]},"3":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":4},"end":{"line":33,"column":4}},{"start":{"line":33,"column":4},"end":{"line":33,"column":4}}]},"4":{"line":36,"type":"binary-expr","locations":[{"start":{"line":36,"column":12},"end":{"line":36,"column":19}},{"start":{"line":36,"column":23},"end":{"line":36,"column":25}}]},"5":{"line":37,"type":"binary-expr","locations":[{"start":{"line":37,"column":18},"end":{"line":37,"column":31}},{"start":{"line":37,"column":35},"end":{"line":37,"column":38}}]},"6":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":24},"end":{"line":44,"column":36}},{"start":{"line":44,"column":40},"end":{"line":44,"column":67}},{"start":{"line":44,"column":72},"end":{"line":46,"column":3}}]},"7":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":4},"end":{"line":52,"column":4}},{"start":{"line":52,"column":4},"end":{"line":52,"column":4}}]},"8":{"line":82,"type":"if","locations":[{"start":{"line":82,"column":8},"end":{"line":82,"column":8}},{"start":{"line":82,"column":8},"end":{"line":82,"column":8}}]},"9":{"line":82,"type":"binary-expr","locations":[{"start":{"line":82,"column":12},"end":{"line":82,"column":36}},{"start":{"line":82,"column":40},"end":{"line":82,"column":60}},{"start":{"line":82,"column":65},"end":{"line":82,"column":73}},{"start":{"line":82,"column":77},"end":{"line":82,"column":96}},{"start":{"line":82,"column":100},"end":{"line":82,"column":147}}]},"10":{"line":112,"type":"if","locations":[{"start":{"line":112,"column":8},"end":{"line":112,"column":8}},{"start":{"line":112,"column":8},"end":{"line":112,"column":8}}]},"11":{"line":112,"type":"binary-expr","locations":[{"start":{"line":112,"column":12},"end":{"line":112,"column":36}},{"start":{"line":112,"column":40},"end":{"line":112,"column":57}}]},"12":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":10},"end":{"line":129,"column":10}},{"start":{"line":129,"column":10},"end":{"line":129,"column":10}}]},"13":{"line":129,"type":"binary-expr","locations":[{"start":{"line":129,"column":14},"end":{"line":129,"column":22}},{"start":{"line":129,"column":26},"end":{"line":129,"column":45}},{"start":{"line":129,"column":49},"end":{"line":129,"column":96}}]},"14":{"line":135,"type":"if","locations":[{"start":{"line":135,"column":10},"end":{"line":135,"column":10}},{"start":{"line":135,"column":10},"end":{"line":135,"column":10}}]},"15":{"line":162,"type":"binary-expr","locations":[{"start":{"line":162,"column":15},"end":{"line":162,"column":36}},{"start":{"line":162,"column":38},"end":{"line":162,"column":40}}]},"16":{"line":167,"type":"if","locations":[{"start":{"line":167,"column":8},"end":{"line":167,"column":8}},{"start":{"line":167,"column":8},"end":{"line":167,"column":8}}]},"17":{"line":178,"type":"if","locations":[{"start":{"line":178,"column":8},"end":{"line":178,"column":8}},{"start":{"line":178,"column":8},"end":{"line":178,"column":8}}]},"18":{"line":178,"type":"binary-expr","locations":[{"start":{"line":178,"column":12},"end":{"line":178,"column":24}},{"start":{"line":178,"column":28},"end":{"line":178,"column":48}},{"start":{"line":178,"column":52},"end":{"line":178,"column":91}}]},"19":{"line":186,"type":"if","locations":[{"start":{"line":186,"column":6},"end":{"line":186,"column":6}},{"start":{"line":186,"column":6},"end":{"line":186,"column":6}}]},"20":{"line":196,"type":"if","locations":[{"start":{"line":196,"column":6},"end":{"line":196,"column":6}},{"start":{"line":196,"column":6},"end":{"line":196,"column":6}}]}},"code":["/**"," * Module dependencies."," */","","var async = require('async');","var _ = require('@sailshq/lodash');","","","/**"," * Sails.prototype.lower()"," *"," * The inverse of `lift()`, this method"," * shuts down all attached servers."," *"," * It also unbinds listeners and terminates child processes."," *"," * @api public"," */","","module.exports = function lower(options, cb) {","  var sails = this;","","  sails.log.verbose('Lowering sails...');","","  // `options` is optional.","  if ('function' === typeof options) {","    cb = options;","    options = null;","  }","","  // Callback is optional","  cb = cb || function(err) {","    if (err)  { return sails.log.error(err); }","  };","","  options = options || {};","  options.delay = options.delay || 100;","","  // Flag `sails._exiting` as soon as the app has begun to shutdown.","  // This may be used by core hooks and other parts of core.","  // (e.g. to stop handling HTTP requests and prevent ugly error msgs)","  sails._exiting = true;","","  var beforeShutdown = (sails.config && sails.config.beforeShutdown) || function(cb) {","    return cb();","  };","","  // Wait until beforeShutdown logic runs","  beforeShutdown(function(err) {","","    // If an error occurred, don't stop-- still go ahead and take care of other teardown tasks.","    if (err) {","      sails.log.error(err);","    }","","    // Try to kill all child processes","    _.each(sails.childProcesses, function kill(childProcess) {","      sails.log.verbose('Sent kill signal to child process (' + childProcess.pid + ')...');","      try {","        childProcess.kill('SIGINT');","      } catch (e) {","        sails.log.error('While lowering Sails app: received error killing child process: ', e.stack);","      }","    });","","    // Shut down HTTP server","    sails.emit('lower');","    // (Note for future: would be cleaner to provide a way to defer this to the http","    // and sockets hooks-- i.e. having hooks expose a `teardown(cb)` interceptor. Keep","    // in mind we'd need a way to distinguish between a graceful shutdown and a force","    // kill.  In a force kill situation, it's never ok for the process to hang.)","","    async.series([","","      function shutdownSockets(cb) {","","        // If the sockets hook is disabled, skip this.","        // Also skip if the socket server is piggybacking on the main HTTP server, to avoid","        // the onClose event possibly being called multiple times (because you can't tell","        // socket.io to close without it trying to close the http server).  If we're piggybacking","        // we'll call sails.io.close in the main \"shutdownHTTP\" code below.","        if (!_.isObject(sails.hooks) || !sails.hooks.sockets || (sails.io && sails.io.httpServer && sails.hooks.http.server === sails.io.httpServer)) {","          return cb();","        }","","        var timeOut;","","        try {","          sails.log.verbose('Shutting down socket server...');","          timeOut = setTimeout(function() {","            sails.io.httpServer.removeListener('close', onClose);","            return cb();","          }, 100);","          sails.io.httpServer.unref();","          sails.io.httpServer.once('close', onClose);","          sails.io.close();","        } catch (e) {","          sails.log.verbose('Error occurred closing socket server: ', e);","          clearTimeout(timeOut);","          cb();","        }","","        function onClose() {","          sails.log.verbose('Socket server shut down successfully.');","          clearTimeout(timeOut);","          cb();","        }","","      },","","      function shutdownHTTP(cb) {","        if (!_.isObject(sails.hooks) || !sails.hooks.http) {","          return cb();","        }","","        var timeOut;","","        try {","          sails.log.verbose('Shutting down HTTP server...');","","          // Allow process to exit once this server is closed","          sails.hooks.http.server.unref();","","          // If we have a socket server and it's piggybacking on the main HTTP server, tell","          // socket.io to close now.  This may call `.close()` on the HTTP server, which will","          // happen again below, but the second synchronous call to .close() will have no","          // additional effect.  Leaving this as-is in case future versions of socket.io","          // DON'T automatically close the http server for you.","          if (sails.io && sails.io.httpServer && sails.hooks.http.server === sails.io.httpServer) {","            sails.io.close();","          }","","          // If the \"hard shutdown\" option is on, destroy the server immediately,","          // severing all connections","          if (options.hardShutdown) {","            sails.hooks.http.destroy();","          }","          // Otherwise just stop the server from accepting new connections,","          // and wait options.delay for the existing connections to close","          // gracefully before destroying.","          else {","            timeOut = setTimeout(sails.hooks.http.destroy, options.delay);","            sails.hooks.http.server.close();","          }","","          // Wait for the existing connections to close","          sails.hooks.http.server.once('close', function () {","            sails.log.verbose('HTTP server shut down successfully.');","            clearTimeout(timeOut);","            cb();","          });","","        } catch (e) {","          sails.log.verbose('Error occurred closing HTTP server: ', e);","          clearTimeout(timeOut);","          cb();","        }","      },","","      function removeListeners(cb) {","        // Manually remove all event listeners","        _.each(_.keys(sails._events)||[], function (eventName){","          sails.removeAllListeners(eventName);","        });","","        var listeners = sails._processListeners;","        if (listeners) {","          process.removeListener('SIGUSR2', listeners.sigusr2);","          process.removeListener('SIGINT', listeners.sigint);","          process.removeListener('SIGTERM', listeners.sigterm);","          process.removeListener('exit', listeners.exit);","        }","        sails._processListeners = null;","","        // If `sails.config.process.removeAllListeners` is set, do that.","        // This is no longer necessary due to https://github.com/balderdashy/sails/pull/2693","        // Deprecating for v0.12.","        if (sails.config && sails.config.process && sails.config.process.removeAllListeners) {","          sails.log.debug('sails.config.process.removeAllListeners is deprecated; please remove listeners indivually!');","          process.removeAllListeners();","        }","","        cb();","      },","    ], function (err) {","      if (err) {","        // This should never happen because `err` is never passed in any of the async","        // functions above.  Still, just to be safe, we set up an error log.","        sails.log.error('While lowering Sails app: received unexpected error:', err.stack);","        return cb(err);","      }","","      // If `sails._setNodeEnvAutomatically` is set, then we should revert it to what it was","      // beforehand (`sails._originalNodeEnv`), even if it wasn't set at all.","      // (see load.js for more background)","      if (sails._setNodeEnvAutomatically) {","        process.env['NODE_ENV'] = sails._originalNodeEnv;","      }","","      return cb();","","    });//</async.series>","","  });//</beforeShutdown()>","","};",""],"l":{"5":1,"6":1,"20":1,"21":0,"23":0,"26":0,"27":0,"28":0,"32":0,"33":0,"36":0,"37":0,"42":0,"44":0,"45":0,"49":0,"52":0,"53":0,"57":0,"58":0,"59":0,"60":0,"62":0,"67":0,"73":0,"82":0,"83":0,"86":0,"88":0,"89":0,"90":0,"91":0,"92":0,"94":0,"95":0,"96":0,"98":0,"99":0,"100":0,"103":1,"104":0,"105":0,"106":0,"112":0,"113":0,"116":0,"118":0,"119":0,"122":0,"129":0,"130":0,"135":0,"136":0,"142":0,"143":0,"147":0,"148":0,"149":0,"150":0,"154":0,"155":0,"156":0,"162":0,"163":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"173":0,"178":0,"179":0,"180":0,"183":0,"186":0,"189":0,"190":0,"196":0,"197":0,"200":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/getBaseurl.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/getBaseurl.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"b":{"1":[0,0,0,0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"getBaseurl","line":15,"loc":{"start":{"line":15,"column":17},"end":{"line":15,"column":39}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"2":{"start":{"line":15,"column":0},"end":{"line":32,"column":2}},"3":{"start":{"line":16,"column":2},"end":{"line":16,"column":19}},"4":{"start":{"line":18,"column":2},"end":{"line":18,"column":142}},"5":{"start":{"line":19,"column":2},"end":{"line":19,"column":44}},"6":{"start":{"line":20,"column":2},"end":{"line":20,"column":57}},"7":{"start":{"line":21,"column":2},"end":{"line":21,"column":40}},"8":{"start":{"line":24,"column":2},"end":{"line":24,"column":26}},"9":{"start":{"line":25,"column":2},"end":{"line":27,"column":3}},"10":{"start":{"line":26,"column":4},"end":{"line":26,"column":81}},"11":{"start":{"line":28,"column":2},"end":{"line":28,"column":67}},"12":{"start":{"line":29,"column":2},"end":{"line":29,"column":55}},"13":{"start":{"line":31,"column":2},"end":{"line":31,"column":21}}},"branchMap":{"1":{"line":18,"type":"binary-expr","locations":[{"start":{"line":18,"column":17},"end":{"line":18,"column":42}},{"start":{"line":18,"column":47},"end":{"line":18,"column":63}},{"start":{"line":18,"column":69},"end":{"line":18,"column":89}},{"start":{"line":18,"column":93},"end":{"line":18,"column":114}},{"start":{"line":18,"column":119},"end":{"line":18,"column":139}}]},"2":{"line":19,"type":"binary-expr","locations":[{"start":{"line":19,"column":13},"end":{"line":19,"column":28}},{"start":{"line":19,"column":32},"end":{"line":19,"column":43}}]},"3":{"line":20,"type":"binary-expr","locations":[{"start":{"line":20,"column":13},"end":{"line":20,"column":35}},{"start":{"line":20,"column":39},"end":{"line":20,"column":56}}]},"4":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":2},"end":{"line":25,"column":2}},{"start":{"line":25,"column":2},"end":{"line":25,"column":2}}]},"5":{"line":26,"type":"cond-expr","locations":[{"start":{"line":26,"column":55},"end":{"line":26,"column":62}},{"start":{"line":26,"column":65},"end":{"line":26,"column":71}}]},"6":{"line":26,"type":"binary-expr","locations":[{"start":{"line":26,"column":23},"end":{"line":26,"column":31}},{"start":{"line":26,"column":35},"end":{"line":26,"column":51}}]},"7":{"line":28,"type":"cond-expr","locations":[{"start":{"line":28,"column":50},"end":{"line":28,"column":52}},{"start":{"line":28,"column":55},"end":{"line":28,"column":65}}]},"8":{"line":28,"type":"binary-expr","locations":[{"start":{"line":28,"column":20},"end":{"line":28,"column":31}},{"start":{"line":28,"column":35},"end":{"line":28,"column":47}}]}},"code":["/**"," * Module dependencies"," */","","var _ = require('@sailshq/lodash');","","","","","/**"," * Calculate the base URL (useful in emails, etc.)"," * @return {String} [description]"," */","","module.exports = function getBaseurl() {","  var sails = this;","","  var usingSSL = sails.config.ssl === true || (sails.config.ssl && ((sails.config.ssl.key && sails.config.ssl.cert) || sails.config.ssl.pfx));","  var host = sails.getHost() || 'localhost';","  var port = sails.config.proxyPort || sails.config.port;","  var probablyUsingSSL = (port === 443);","","  // If host doesn't contain `http*` already, include the protocol string.","  var protocolString = '';","  if (!_.contains(host,'http')) {","    protocolString = ((usingSSL || probablyUsingSSL) ? 'https' : 'http') + '://';","  }","  var portString = (port === 80 || port === 443 ? '' : ':' + port);","  var localAppURL = protocolString + host + portString;","","  return localAppURL;","};",""],"l":{"5":1,"15":1,"16":0,"18":0,"19":0,"20":0,"21":0,"24":0,"25":0,"26":0,"28":0,"29":0,"31":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/get-route-for.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/get-route-for.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0,0,0],"12":[0,0],"13":[0,0,0,0],"14":[0,0],"15":[0,0],"16":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"getRouteFor","line":35,"loc":{"start":{"line":35,"column":17},"end":{"line":35,"column":49}}},"2":{"name":"(anonymous_2)","line":66,"loc":{"start":{"line":66,"column":37},"end":{"line":66,"column":65}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":35}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":38}},"4":{"start":{"line":35,"column":0},"end":{"line":129,"column":2}},"5":{"start":{"line":38,"column":2},"end":{"line":38,"column":19}},"6":{"start":{"line":41,"column":2},"end":{"line":41,"column":26}},"7":{"start":{"line":42,"column":2},"end":{"line":52,"column":3}},"8":{"start":{"line":43,"column":4},"end":{"line":43,"column":37}},"9":{"start":{"line":45,"column":7},"end":{"line":52,"column":3}},"10":{"start":{"line":46,"column":4},"end":{"line":46,"column":44}},"11":{"start":{"line":49,"column":4},"end":{"line":49,"column":311}},"12":{"start":{"line":50,"column":4},"end":{"line":50,"column":37}},"13":{"start":{"line":51,"column":4},"end":{"line":51,"column":26}},"14":{"start":{"line":55,"column":2},"end":{"line":55,"column":65}},"15":{"start":{"line":58,"column":2},"end":{"line":62,"column":3}},"16":{"start":{"line":59,"column":4},"end":{"line":59,"column":208}},"17":{"start":{"line":60,"column":4},"end":{"line":60,"column":39}},"18":{"start":{"line":61,"column":4},"end":{"line":61,"column":28}},"19":{"start":{"line":65,"column":2},"end":{"line":65,"column":32}},"20":{"start":{"line":66,"column":2},"end":{"line":102,"column":5}},"21":{"start":{"line":68,"column":4},"end":{"line":101,"column":5}},"22":{"start":{"line":69,"column":6},"end":{"line":76,"column":7}},"23":{"start":{"line":70,"column":8},"end":{"line":70,"column":40}},"24":{"start":{"line":71,"column":8},"end":{"line":71,"column":20}},"25":{"start":{"line":78,"column":9},"end":{"line":101,"column":5}},"26":{"start":{"line":80,"column":6},"end":{"line":99,"column":7}},"27":{"start":{"line":83,"column":8},"end":{"line":83,"column":40}},"28":{"start":{"line":84,"column":8},"end":{"line":84,"column":20}},"29":{"start":{"line":87,"column":11},"end":{"line":99,"column":7}},"30":{"start":{"line":90,"column":8},"end":{"line":90,"column":40}},"31":{"start":{"line":91,"column":8},"end":{"line":91,"column":20}},"32":{"start":{"line":94,"column":11},"end":{"line":99,"column":7}},"33":{"start":{"line":97,"column":8},"end":{"line":97,"column":40}},"34":{"start":{"line":98,"column":8},"end":{"line":98,"column":20}},"35":{"start":{"line":106,"column":2},"end":{"line":110,"column":3}},"36":{"start":{"line":107,"column":4},"end":{"line":107,"column":162}},"37":{"start":{"line":108,"column":4},"end":{"line":108,"column":47}},"38":{"start":{"line":109,"column":4},"end":{"line":109,"column":32}},"39":{"start":{"line":115,"column":2},"end":{"line":115,"column":99}},"40":{"start":{"line":118,"column":2},"end":{"line":118,"column":70}},"41":{"start":{"line":121,"column":2},"end":{"line":121,"column":21}},"42":{"start":{"line":122,"column":2},"end":{"line":122,"column":46}},"43":{"start":{"line":123,"column":2},"end":{"line":123,"column":37}},"44":{"start":{"line":127,"column":2},"end":{"line":127,"column":19}}},"branchMap":{"1":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":2},"end":{"line":42,"column":2}},{"start":{"line":42,"column":2},"end":{"line":42,"column":2}}]},"2":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":7},"end":{"line":45,"column":7}},{"start":{"line":45,"column":7},"end":{"line":45,"column":7}}]},"3":{"line":45,"type":"binary-expr","locations":[{"start":{"line":45,"column":12},"end":{"line":45,"column":34}},{"start":{"line":45,"column":38},"end":{"line":45,"column":67}}]},"4":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":2},"end":{"line":58,"column":2}},{"start":{"line":58,"column":2},"end":{"line":58,"column":2}}]},"5":{"line":68,"type":"if","locations":[{"start":{"line":68,"column":4},"end":{"line":68,"column":4}},{"start":{"line":68,"column":4},"end":{"line":68,"column":4}}]},"6":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":6},"end":{"line":69,"column":6}},{"start":{"line":69,"column":6},"end":{"line":69,"column":6}}]},"7":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":9},"end":{"line":78,"column":9}},{"start":{"line":78,"column":9},"end":{"line":78,"column":9}}]},"8":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":6},"end":{"line":80,"column":6}},{"start":{"line":80,"column":6},"end":{"line":80,"column":6}}]},"9":{"line":80,"type":"binary-expr","locations":[{"start":{"line":80,"column":11},"end":{"line":80,"column":41}},{"start":{"line":80,"column":45},"end":{"line":80,"column":85}}]},"10":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":11},"end":{"line":87,"column":11}},{"start":{"line":87,"column":11},"end":{"line":87,"column":11}}]},"11":{"line":87,"type":"binary-expr","locations":[{"start":{"line":87,"column":16},"end":{"line":87,"column":50}},{"start":{"line":87,"column":54},"end":{"line":87,"column":84}},{"start":{"line":87,"column":88},"end":{"line":87,"column":141}},{"start":{"line":87,"column":145},"end":{"line":87,"column":194}}]},"12":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":11},"end":{"line":94,"column":11}},{"start":{"line":94,"column":11},"end":{"line":94,"column":11}}]},"13":{"line":94,"type":"binary-expr","locations":[{"start":{"line":94,"column":16},"end":{"line":94,"column":50}},{"start":{"line":94,"column":54},"end":{"line":94,"column":73}},{"start":{"line":94,"column":77},"end":{"line":94,"column":130}},{"start":{"line":94,"column":134},"end":{"line":94,"column":172}}]},"14":{"line":106,"type":"if","locations":[{"start":{"line":106,"column":2},"end":{"line":106,"column":2}},{"start":{"line":106,"column":2},"end":{"line":106,"column":2}}]},"15":{"line":115,"type":"cond-expr","locations":[{"start":{"line":115,"column":66},"end":{"line":115,"column":70}},{"start":{"line":115,"column":73},"end":{"line":115,"column":98}}]},"16":{"line":122,"type":"binary-expr","locations":[{"start":{"line":122,"column":21},"end":{"line":122,"column":39}},{"start":{"line":122,"column":43},"end":{"line":122,"column":45}}]}},"code":["/**"," * Module dependencies"," */","","var util = require('util');","var _ = require('@sailshq/lodash');","var sailsUtil = require('sails-util');","","","/**"," * getRouteFor()"," *"," * Look up more information about the first explicit route defined in this app"," * which has the given route target."," *"," * Note that this function _only searches explicit routes_ which have been configured"," * manually (e.g. in `config/routes.js`).  For more info, see:"," * https://github.com/balderdashy/sails/issues/3402#issuecomment-171633341"," *"," * @this {SailsApp}"," * ----------------------------------------------------------------------------------------"," *"," * Usage:"," *"," * ```"," * getRouteFor('DuckController.quack');"," * getRouteFor({ target: 'DuckController.quack' });"," * // =>"," * // {"," * //   url: '/ducks/:id/quack',"," * //   method: 'post'"," * // }"," * ```"," */","module.exports = function getRouteFor(routeQuery){","","  // Get reference to sails app instance.","  var sails = this;","","  // Validate and normalize usage.","  var routeTargetToLookup;","  if ( _.isString(routeQuery) ) {","    routeTargetToLookup = routeQuery;","  }","  else if ( _.isObject(routeQuery) && _.isString(routeQuery.target) ) {","    routeTargetToLookup = routeQuery.target;","  }","  else {","    var invalidUsageErr = new Error('Usage error: `sails.getRouteFor()` expects a string route target (e.g. \"DuckController.quack\") or a dictionary with a target property (e.g. `{target: \"DuckController.quack\"}`).  But instead, it received a `'+typeof routeQuery+'`: '+util.inspect(routeQuery, {depth: null}) );","    invalidUsageErr.code = 'E_USAGE';","    throw invalidUsageErr;","  }","","  // Split the provided route target string to look up on its dot, getting its controller and action parts.","  var routeTargetToLookupPieces = routeTargetToLookup.split('.');","","  // If it doesn't have a dot, throw a usage error.","  if ( routeTargetToLookupPieces.length < 2 ) {","    var ambiguousUsageErr = new Error('Usage error: Ambiguous usage- target specified to `sails.getRouteFor()` is not a valid route target string (e.g. \"DuckController.quack\") because there is no dot (\".\")');","    ambiguousUsageErr.code = 'E_USAGE';","    throw ambiguousUsageErr;","  }","","  // Now look up the first route with this target (`routeTargetToLookup`).","  var firstMatchingRouteAddress;","  _.any(sails.router.explicitRoutes, function (routeTarget, key) {","    // If route target syntax is a string, compare it directly with the provided `routeTargetToLookup`.","    if ( _.isString(routeTarget) ) {","      if (routeTarget===routeTargetToLookup ) {","        firstMatchingRouteAddress = key;","        return true;","      }","      else {","        // TODO: If that check fails, try removing \"Controller\" suffix from both `routeTargetToLookup` and the controller in the `routeTarget` and comparing those. Note that this means you _should not define `ControllerController.js`_!","        // * * * ACTUALLY, see: https://github.com/balderdashy/sails/issues/3402#issuecomment-173255376   * * *","      }","    }","    else if ( _.isObject(routeTarget) ) {","      // If route target syntax itself contains a string `target` key, compare it directly with the provided `routeTargetToLookup`.","      if ( _.isString(routeTarget.target) && routeTarget.target===routeTargetToLookup ) {","        // TODO: If that check fails, try removing \"Controller\" suffix from both `routeTargetToLookup` and the controller in the `routeTarget` and comparing those. Note that this means you _should not define `ControllerController.js`_!","        // * * * ACTUALLY, see: https://github.com/balderdashy/sails/issues/3402#issuecomment-173255376   * * *","        firstMatchingRouteAddress = key;","        return true;","      }","      // If route target syntax contains `controller`+`action` keys, then check those against the relevant pieces of the provided `routeTargetToLookup`.","      else if ( _.isString(routeTarget.controller) && _.isString(routeTarget.action) && routeTarget.controller===routeTargetToLookupPieces[0] && routeTarget.action===routeTargetToLookupPieces[1] ) {","        // TODO: If that check fails, try removing \"Controller\" suffix from both `routeTargetToLookup` and the controller in the `routeTarget` and comparing those. Note that this means you _should not define `ControllerController.js`_!","        // * * * ACTUALLY, see: https://github.com/balderdashy/sails/issues/3402#issuecomment-173255376   * * *","        firstMatchingRouteAddress = key;","        return true;","      }","      // If route target syntax contains only `controller`, compare assuming the \"index\" action against the relevant pieces of the provided `routeTargetToLookup`.","      else if ( _.isString(routeTarget.controller) && !routeTarget.action && routeTarget.controller===routeTargetToLookupPieces[0] && 'index'===routeTargetToLookupPieces[1] ) {","        // TODO: If that check fails, try removing \"Controller\" suffix from both `routeTargetToLookup` and the controller in the `routeTarget` and comparing those. Note that this means you _should not define `ControllerController.js`_!","        // * * * ACTUALLY, see: https://github.com/balderdashy/sails/issues/3402#issuecomment-173255376   * * *","        firstMatchingRouteAddress = key;","        return true;","      }","      // Note that we ignore non-matches or anything utterly insane.","    }","  });","","","  // If no route was found, throw an error.","  if (!firstMatchingRouteAddress) {","    var unrecognizedTargetErr = new Error('Route not found: No explicit route could be found in this app with the specified target (`'+routeTargetToLookup+'`).');","    unrecognizedTargetErr.code = 'E_NOT_FOUND';","    throw unrecognizedTargetErr;","  }","","  // Now that the raw route address been located, we'll normalize it:","  //","  // If route address is '*', it will be automatically corrected to `/*` when bound, so also reflect that here.","  firstMatchingRouteAddress = firstMatchingRouteAddress === '*' ? '/*' : firstMatchingRouteAddress;","","  // Then we parse it into its HTTP method and URL pattern parts.","  var parsedAddress = sailsUtil.detectVerb(firstMatchingRouteAddress);","","  // At this point we being building the final return value- the route info dictionary.","  var routeInfo = {};","  routeInfo.method = parsedAddress.verb || '';","  routeInfo.url = parsedAddress.path;","","","  // And finally return the route info.","  return routeInfo;","","};",""],"l":{"5":1,"6":1,"7":1,"35":1,"38":0,"41":0,"42":0,"43":0,"45":0,"46":0,"49":0,"50":0,"51":0,"55":0,"58":0,"59":0,"60":0,"61":0,"65":0,"66":0,"68":0,"69":0,"70":0,"71":0,"78":0,"80":0,"83":0,"84":0,"87":0,"90":0,"91":0,"94":0,"97":0,"98":0,"106":0,"107":0,"108":0,"109":0,"115":0,"118":0,"121":0,"122":0,"123":0,"127":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/get-url-for.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/get-url-for.js","s":{"1":1,"2":0,"3":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"getUrlFor","line":31,"loc":{"start":{"line":31,"column":17},"end":{"line":31,"column":47}}}},"statementMap":{"1":{"start":{"line":31,"column":0},"end":{"line":40,"column":2}},"2":{"start":{"line":34,"column":2},"end":{"line":34,"column":19}},"3":{"start":{"line":38,"column":2},"end":{"line":38,"column":43}}},"branchMap":{},"code":["/**"," * Module dependencies"," */","","// N/A","","","/**"," * getUrlFor()"," *"," * Look up the URL of this app's first explicit route with the given route target."," *"," * Note that this function _only searches explicit routes_ which have been configured"," * manually (e.g. in `config/routes.js`).  For more info, see:"," * https://github.com/balderdashy/sails/issues/3402#issuecomment-171633341"," *"," *"," * @this {SailsApp}"," * ----------------------------------------------------------------------------------------"," *"," * Usage:"," *"," * ```"," * getUrlFor('DuckController.quack');"," * // => '/ducks/:id/quack'"," *"," * getUrlFor({ target: 'DuckController.quack' });"," * // => '/ducks/:id/quack'"," * ```"," */","module.exports = function getUrlFor(routeQuery){","","  // Get reference to sails app instance.","  var sails = this;","","  // Now attempt to look up the first route that matches the specified argument","  // and if it works, then return its URL.","  return sails.getRouteFor(routeQuery).url;","","};",""],"l":{"31":1,"34":0,"38":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/request.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/request.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":1,"59":0,"60":1,"61":1,"62":0,"63":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"request","line":27,"loc":{"start":{"line":27,"column":17},"end":{"line":27,"column":61}}},"2":{"name":"(anonymous_2)","line":104,"loc":{"start":{"line":104,"column":25},"end":{"line":104,"column":36}}},"3":{"name":"(anonymous_3)","line":136,"loc":{"start":{"line":136,"column":24},"end":{"line":136,"column":38}}},"4":{"name":"MockClientResponse","line":159,"loc":{"start":{"line":159,"column":0},"end":{"line":159,"column":30}}},"5":{"name":"(anonymous_5)","line":163,"loc":{"start":{"line":163,"column":42},"end":{"line":163,"column":74}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":32}},"4":{"start":{"line":8,"column":0},"end":{"line":8,"column":44}},"5":{"start":{"line":27,"column":0},"end":{"line":155,"column":2}},"6":{"start":{"line":29,"column":2},"end":{"line":29,"column":19}},"7":{"start":{"line":39,"column":2},"end":{"line":39,"column":29}},"8":{"start":{"line":40,"column":2},"end":{"line":40,"column":11}},"9":{"start":{"line":41,"column":2},"end":{"line":41,"column":9}},"10":{"start":{"line":43,"column":2},"end":{"line":43,"column":13}},"11":{"start":{"line":44,"column":2},"end":{"line":44,"column":14}},"12":{"start":{"line":45,"column":2},"end":{"line":45,"column":10}},"13":{"start":{"line":55,"column":2},"end":{"line":60,"column":3}},"14":{"start":{"line":56,"column":4},"end":{"line":56,"column":27}},"15":{"start":{"line":57,"column":4},"end":{"line":57,"column":33}},"16":{"start":{"line":58,"column":4},"end":{"line":58,"column":41}},"17":{"start":{"line":59,"column":4},"end":{"line":59,"column":58}},"18":{"start":{"line":68,"column":2},"end":{"line":71,"column":3}},"19":{"start":{"line":69,"column":4},"end":{"line":69,"column":22}},"20":{"start":{"line":70,"column":4},"end":{"line":70,"column":24}},"21":{"start":{"line":72,"column":2},"end":{"line":76,"column":3}},"22":{"start":{"line":73,"column":4},"end":{"line":73,"column":22}},"23":{"start":{"line":74,"column":9},"end":{"line":76,"column":3}},"24":{"start":{"line":75,"column":4},"end":{"line":75,"column":24}},"25":{"start":{"line":80,"column":2},"end":{"line":80,"column":57}},"26":{"start":{"line":81,"column":2},"end":{"line":81,"column":49}},"27":{"start":{"line":82,"column":2},"end":{"line":82,"column":55}},"28":{"start":{"line":85,"column":2},"end":{"line":85,"column":40}},"29":{"start":{"line":89,"column":2},"end":{"line":98,"column":3}},"30":{"start":{"line":91,"column":4},"end":{"line":91,"column":47}},"31":{"start":{"line":93,"column":4},"end":{"line":97,"column":5}},"32":{"start":{"line":94,"column":6},"end":{"line":94,"column":37}},"33":{"start":{"line":96,"column":6},"end":{"line":96,"column":71}},"34":{"start":{"line":103,"column":2},"end":{"line":103,"column":43}},"35":{"start":{"line":104,"column":2},"end":{"line":135,"column":5}},"36":{"start":{"line":109,"column":4},"end":{"line":134,"column":5}},"37":{"start":{"line":112,"column":6},"end":{"line":118,"column":20}},"38":{"start":{"line":113,"column":8},"end":{"line":113,"column":42}},"39":{"start":{"line":114,"column":8},"end":{"line":117,"column":9}},"40":{"start":{"line":115,"column":10},"end":{"line":115,"column":53}},"41":{"start":{"line":116,"column":10},"end":{"line":116,"column":54}},"42":{"start":{"line":121,"column":6},"end":{"line":121,"column":51}},"43":{"start":{"line":121,"column":28},"end":{"line":121,"column":50}},"44":{"start":{"line":125,"column":6},"end":{"line":133,"column":7}},"45":{"start":{"line":126,"column":8},"end":{"line":126,"column":84}},"46":{"start":{"line":127,"column":8},"end":{"line":127,"column":58}},"47":{"start":{"line":127,"column":29},"end":{"line":127,"column":57}},"48":{"start":{"line":128,"column":8},"end":{"line":128,"column":44}},"49":{"start":{"line":129,"column":8},"end":{"line":129,"column":25}},"50":{"start":{"line":132,"column":8},"end":{"line":132,"column":51}},"51":{"start":{"line":136,"column":2},"end":{"line":140,"column":5}},"52":{"start":{"line":137,"column":4},"end":{"line":137,"column":55}},"53":{"start":{"line":138,"column":4},"end":{"line":139,"column":45}},"54":{"start":{"line":138,"column":12},"end":{"line":138,"column":27}},"55":{"start":{"line":139,"column":9},"end":{"line":139,"column":45}},"56":{"start":{"line":143,"column":2},"end":{"line":150,"column":5}},"57":{"start":{"line":153,"column":2},"end":{"line":153,"column":19}},"58":{"start":{"line":159,"column":0},"end":{"line":161,"column":1}},"59":{"start":{"line":160,"column":2},"end":{"line":160,"column":23}},"60":{"start":{"line":162,"column":0},"end":{"line":162,"column":45}},"61":{"start":{"line":163,"column":0},"end":{"line":166,"column":2}},"62":{"start":{"line":164,"column":2},"end":{"line":164,"column":19}},"63":{"start":{"line":165,"column":2},"end":{"line":165,"column":9}}},"branchMap":{"1":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":2},"end":{"line":55,"column":2}},{"start":{"line":55,"column":2},"end":{"line":55,"column":2}}]},"2":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":6},"end":{"line":55,"column":30}},{"start":{"line":55,"column":34},"end":{"line":55,"column":50}}]},"3":{"line":58,"type":"binary-expr","locations":[{"start":{"line":58,"column":14},"end":{"line":58,"column":34}},{"start":{"line":58,"column":38},"end":{"line":58,"column":40}}]},"4":{"line":59,"type":"binary-expr","locations":[{"start":{"line":59,"column":11},"end":{"line":59,"column":30}},{"start":{"line":59,"column":34},"end":{"line":59,"column":51}},{"start":{"line":59,"column":55},"end":{"line":59,"column":57}}]},"5":{"line":68,"type":"if","locations":[{"start":{"line":68,"column":2},"end":{"line":68,"column":2}},{"start":{"line":68,"column":2},"end":{"line":68,"column":2}}]},"6":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":2},"end":{"line":72,"column":2}},{"start":{"line":72,"column":2},"end":{"line":72,"column":2}}]},"7":{"line":74,"type":"if","locations":[{"start":{"line":74,"column":9},"end":{"line":74,"column":9}},{"start":{"line":74,"column":9},"end":{"line":74,"column":9}}]},"8":{"line":80,"type":"binary-expr","locations":[{"start":{"line":80,"column":11},"end":{"line":80,"column":17}},{"start":{"line":80,"column":21},"end":{"line":80,"column":56}}]},"9":{"line":81,"type":"cond-expr","locations":[{"start":{"line":81,"column":20},"end":{"line":81,"column":40}},{"start":{"line":81,"column":43},"end":{"line":81,"column":48}}]},"10":{"line":82,"type":"binary-expr","locations":[{"start":{"line":82,"column":8},"end":{"line":82,"column":11}},{"start":{"line":82,"column":15},"end":{"line":82,"column":54}}]},"11":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":2},"end":{"line":89,"column":2}},{"start":{"line":89,"column":2},"end":{"line":89,"column":2}}]},"12":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":6},"end":{"line":89,"column":22}},{"start":{"line":89,"column":26},"end":{"line":89,"column":71}}]},"13":{"line":93,"type":"if","locations":[{"start":{"line":93,"column":4},"end":{"line":93,"column":4}},{"start":{"line":93,"column":4},"end":{"line":93,"column":4}}]},"14":{"line":109,"type":"if","locations":[{"start":{"line":109,"column":4},"end":{"line":109,"column":4}},{"start":{"line":109,"column":4},"end":{"line":109,"column":4}}]},"15":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":8},"end":{"line":114,"column":8}},{"start":{"line":114,"column":8},"end":{"line":114,"column":8}}]},"16":{"line":121,"type":"if","locations":[{"start":{"line":121,"column":6},"end":{"line":121,"column":6}},{"start":{"line":121,"column":6},"end":{"line":121,"column":6}}]},"17":{"line":125,"type":"if","locations":[{"start":{"line":125,"column":6},"end":{"line":125,"column":6}},{"start":{"line":125,"column":6},"end":{"line":125,"column":6}}]},"18":{"line":125,"type":"binary-expr","locations":[{"start":{"line":125,"column":10},"end":{"line":125,"column":36}},{"start":{"line":125,"column":40},"end":{"line":125,"column":67}}]},"19":{"line":126,"type":"binary-expr","locations":[{"start":{"line":126,"column":43},"end":{"line":126,"column":57}},{"start":{"line":126,"column":61},"end":{"line":126,"column":81}}]},"20":{"line":127,"type":"if","locations":[{"start":{"line":127,"column":8},"end":{"line":127,"column":8}},{"start":{"line":127,"column":8},"end":{"line":127,"column":8}}]},"21":{"line":137,"type":"binary-expr","locations":[{"start":{"line":137,"column":10},"end":{"line":137,"column":13}},{"start":{"line":137,"column":17},"end":{"line":137,"column":54}}]},"22":{"line":138,"type":"if","locations":[{"start":{"line":138,"column":4},"end":{"line":138,"column":4}},{"start":{"line":138,"column":4},"end":{"line":138,"column":4}}]},"23":{"line":147,"type":"binary-expr","locations":[{"start":{"line":147,"column":13},"end":{"line":147,"column":20}},{"start":{"line":147,"column":24},"end":{"line":147,"column":26}}]}},"code":["/**"," * Module dependencies."," */","","var _ = require('@sailshq/lodash');","var util = require('util');","var QS = require('querystring');","var Transform = require('stream').Transform;","","","/**"," * Originate a new client request instance and lob it at this Sails"," * app at the specified route `address`."," *"," * Particularly useful for running unit/integration tests without"," * actually having to bind the HTTP and/or WebSocket servers to"," * a TCP port."," *"," * @param  {String} address"," * @param  {Object} body"," * @param  {Function} cb"," * @return {Stream.Readable}"," *"," * @api public"," */","","module.exports = function request( /* address, body, cb */ ) {","","  var sails = this;","","  //","  // Body params may be passed in to DELETE, HEAD, and GET requests,","  // even though these types of requests don't normally contain a body.","  // (this method just serializes them as if they were sent in the querystring)","  //","","","  // Normalize usage","  var address = arguments[0];","  var body;","  var cb;","","  var method;","  var headers;","  var url;","","  // Usage:","  // sails.request(opts, cb)","  // • opts.url","  // • opts.method","  // • opts.params","  // • opts.headers","  //","  // (`opts.url` is required)","  if (_.isObject(arguments[0]) && arguments[0].url) {","    url = arguments[0].url;","    method = arguments[0].method;","    headers = arguments[0].headers || {};","    body = arguments[0].params || arguments[0].data || {};","  }","  // console.log('called sails.request() ');","  // console.log('headers: ',headers);","  // console.log('method: ',method);","","","  // Usage:","  // sails.request(address, [params], cb)","  if (arguments[2]) {","    cb = arguments[2];","    body = arguments[1];","  }","  if (_.isFunction(arguments[1])) {","    cb = arguments[1];","  } else if (arguments[1]) {","    body = arguments[1];","  }","","  // If route has an HTTP verb (e.g. `get /foo/bar`, `put /bar/foo`, etc.) parse it out,","  // (unless method or url was explicitly defined)","  method = method || sails.util.detectVerb(address).verb;","  method = method ? method.toUpperCase() : 'GET';","  url = url || sails.util.detectVerb(address).original;","","  // Parse query string (`req.query`)","  var queryStringPos = url.indexOf('?');","","  // If this is a GET, HEAD, or DELETE request, treat the \"body\"","  // as parameters which should be serialized into the querystring.","  if (_.isObject(body) && _.contains(['GET', 'HEAD', 'DELETE'], method)) {","","    var stringifiedParams = QS.stringify(body);","","    if (queryStringPos === -1) {","      url += '?' + stringifiedParams;","    } else {","      url = url.substring(0, queryStringPos) + '?' + stringifiedParams;","    }","  }","","","","  // Build HTTP Client Response stream","  var clientRes = new MockClientResponse();","  clientRes.on('finish', function() {","","    // console.log('clientRes finished. Headers:',clientRes.headers);","","    // Only dump the buffer if a callback was supplied","    if (cb) {","","      // Attempt to read the response buffer into a string","      try {","        clientRes.body = clientRes.read();","        if (clientRes.body !== null) {","          clientRes.body = clientRes.body.toString();","          clientRes.body = JSON.parse(clientRes.body);","        }","      } catch (e) {}","","      // Don't include body if it is empty","      if (!clientRes.body) {delete clientRes.body;}","","      // If status code is indicative of an error, send the","      // response body or status code as the first error argument.","      if (clientRes.statusCode < 200 || clientRes.statusCode >= 400) {","        var error = new Error(util.inspect(clientRes.body || clientRes.statusCode));","        if (clientRes.body) {error.body = clientRes.body;}","        error.status = clientRes.statusCode;","        return cb(error);","      }","      else {","        return cb(null, clientRes, clientRes.body);","      }","    }","  });","  clientRes.on('error', function(err) {","    err = err || new Error('Error on response stream');","    if (cb) return cb(err);","    else return clientRes.emit('error', err);","  });","","  // To kick things off, pass `opts` (as req) and `res` to the Sails router","  sails.router.route({","    method: method,","    url: url,","    body: body,","    headers: headers || {}","  }, {","    _clientRes: clientRes","  });","","  // Return clientRes stream","  return clientRes;","","};","","","","function MockClientResponse() {","  Transform.call(this);","}","util.inherits(MockClientResponse, Transform);","MockClientResponse.prototype._transform = function(chunk, encoding, next) {","  this.push(chunk);","  next();","};","",""],"l":{"5":1,"6":1,"7":1,"8":1,"27":1,"29":0,"39":0,"40":0,"41":0,"43":0,"44":0,"45":0,"55":0,"56":0,"57":0,"58":0,"59":0,"68":0,"69":0,"70":0,"72":0,"73":0,"74":0,"75":0,"80":0,"81":0,"82":0,"85":0,"89":0,"91":0,"93":0,"94":0,"96":0,"103":0,"104":0,"109":0,"112":0,"113":0,"114":0,"115":0,"116":0,"121":0,"125":0,"126":0,"127":0,"128":0,"129":0,"132":0,"136":0,"137":0,"138":0,"139":0,"143":0,"153":0,"159":1,"160":0,"162":1,"163":1,"164":0,"165":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/initialize.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/initialize.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"fnMap":{"1":{"name":"initialize","line":23,"loc":{"start":{"line":23,"column":17},"end":{"line":23,"column":41}}},"2":{"name":"(anonymous_2)","line":28,"loc":{"start":{"line":28,"column":13},"end":{"line":28,"column":27}}},"3":{"name":"(anonymous_3)","line":36,"loc":{"start":{"line":36,"column":13},"end":{"line":36,"column":24}}},"4":{"name":"(anonymous_4)","line":37,"loc":{"start":{"line":37,"column":18},"end":{"line":37,"column":29}}},"5":{"name":"(anonymous_5)","line":41,"loc":{"start":{"line":41,"column":12},"end":{"line":41,"column":23}}},"6":{"name":"(anonymous_6)","line":42,"loc":{"start":{"line":42,"column":18},"end":{"line":42,"column":29}}},"7":{"name":"(anonymous_7)","line":46,"loc":{"start":{"line":46,"column":13},"end":{"line":46,"column":24}}},"8":{"name":"(anonymous_8)","line":47,"loc":{"start":{"line":47,"column":18},"end":{"line":47,"column":29}}},"9":{"name":"(anonymous_9)","line":51,"loc":{"start":{"line":51,"column":10},"end":{"line":51,"column":21}}},"10":{"name":"afterBootstrap","line":68,"loc":{"start":{"line":68,"column":21},"end":{"line":68,"column":50}}},"11":{"name":"(anonymous_11)","line":82,"loc":{"start":{"line":82,"column":41},"end":{"line":82,"column":66}}},"12":{"name":"(anonymous_12)","line":87,"loc":{"start":{"line":87,"column":7},"end":{"line":87,"column":21}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":35}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":29}},"4":{"start":{"line":23,"column":0},"end":{"line":93,"column":2}},"5":{"start":{"line":25,"column":2},"end":{"line":25,"column":19}},"6":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"7":{"start":{"line":29,"column":4},"end":{"line":29,"column":38}},"8":{"start":{"line":29,"column":15},"end":{"line":29,"column":36}},"9":{"start":{"line":33,"column":2},"end":{"line":33,"column":71}},"10":{"start":{"line":35,"column":2},"end":{"line":56,"column":4}},"11":{"start":{"line":37,"column":6},"end":{"line":39,"column":9}},"12":{"start":{"line":38,"column":8},"end":{"line":38,"column":45}},"13":{"start":{"line":42,"column":6},"end":{"line":44,"column":9}},"14":{"start":{"line":43,"column":8},"end":{"line":43,"column":23}},"15":{"start":{"line":47,"column":6},"end":{"line":49,"column":9}},"16":{"start":{"line":48,"column":8},"end":{"line":48,"column":23}},"17":{"start":{"line":52,"column":6},"end":{"line":54,"column":7}},"18":{"start":{"line":53,"column":8},"end":{"line":53,"column":22}},"19":{"start":{"line":59,"column":2},"end":{"line":59,"column":45}},"20":{"start":{"line":61,"column":2},"end":{"line":61,"column":41}},"21":{"start":{"line":62,"column":2},"end":{"line":62,"column":43}},"22":{"start":{"line":63,"column":2},"end":{"line":63,"column":37}},"23":{"start":{"line":65,"column":2},"end":{"line":65,"column":38}},"24":{"start":{"line":68,"column":2},"end":{"line":92,"column":5}},"25":{"start":{"line":69,"column":4},"end":{"line":72,"column":5}},"26":{"start":{"line":70,"column":6},"end":{"line":70,"column":69}},"27":{"start":{"line":71,"column":6},"end":{"line":71,"column":21}},"28":{"start":{"line":76,"column":4},"end":{"line":76,"column":24}},"29":{"start":{"line":81,"column":4},"end":{"line":81,"column":123}},"30":{"start":{"line":81,"column":36},"end":{"line":81,"column":121}},"31":{"start":{"line":82,"column":4},"end":{"line":90,"column":7}},"32":{"start":{"line":83,"column":6},"end":{"line":85,"column":7}},"33":{"start":{"line":84,"column":8},"end":{"line":84,"column":22}},"34":{"start":{"line":86,"column":6},"end":{"line":86,"column":52}},"35":{"start":{"line":88,"column":6},"end":{"line":88,"column":34}},"36":{"start":{"line":88,"column":17},"end":{"line":88,"column":32}},"37":{"start":{"line":89,"column":6},"end":{"line":89,"column":29}}},"branchMap":{"1":{"line":28,"type":"binary-expr","locations":[{"start":{"line":28,"column":7},"end":{"line":28,"column":9}},{"start":{"line":28,"column":13},"end":{"line":30,"column":3}}]},"2":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":29,"column":4}},{"start":{"line":29,"column":4},"end":{"line":29,"column":4}}]},"3":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":6},"end":{"line":52,"column":6}},{"start":{"line":52,"column":6},"end":{"line":52,"column":6}}]},"4":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":4},"end":{"line":69,"column":4}},{"start":{"line":69,"column":4},"end":{"line":69,"column":4}}]},"5":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":4},"end":{"line":81,"column":4}},{"start":{"line":81,"column":4},"end":{"line":81,"column":4}}]},"6":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":6},"end":{"line":83,"column":6}},{"start":{"line":83,"column":6},"end":{"line":83,"column":6}}]},"7":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":6},"end":{"line":88,"column":6}},{"start":{"line":88,"column":6},"end":{"line":88,"column":6}}]}},"code":["/**"," * Module dependencies"," */","","var util = require('util');","var _ = require('@sailshq/lodash');","var async = require('async');","","","","","/**"," * Sails.prototype.initialize()"," *"," * Start the Sails server"," * NOTE: sails.load() should be run first."," *"," * @param {Function?} callback  [optional]"," *"," * @api private"," */","","module.exports = function initialize(cb) {","","  var sails = this;","","  // Callback is optional","  cb = cb || function(err) {","    if (err) { sails.log.error(err); }","  };","","  // Indicate that server is starting","  sails.log.verbose('Starting app at ' + sails.config.appPath + '...');","","  var listeners = {","    sigusr2: function() {","      sails.lower(function() {","        process.kill(process.pid, 'SIGUSR2');","      });","    },","    sigint: function() {","      sails.lower(function (){","        process.exit();","      });","    },","    sigterm: function() {","      sails.lower(function (){","        process.exit();","      });","    },","    exit: function() {","      if (!sails._exiting) {","        sails.lower();","      }","    }","  };","","  // Add \"beforeShutdown\" events","  process.once('SIGUSR2', listeners.sigusr2);","","  process.on('SIGINT', listeners.sigint);","  process.on('SIGTERM', listeners.sigterm);","  process.on('exit', listeners.exit);","","  sails._processListeners = listeners;","","  // Run the app bootstrap","  sails.runBootstrap(function afterBootstrap(err) {","    if (err) {","      sails.log.error('Bootstrap encountered an error: (see below)');","      return cb(err);","    }","","    // Fire the `ready` event for backwards-compatibility.","    // (this will be removed in a future version of Sails!)","    sails.emit('ready');","","","    // Now loop over each hook, and if it exposes a `handleLift` function, then run it.","    // (this is used by attached servers, etc.)","    if (!_.isObject(sails.hooks)) { return cb(new Error('Consistency violation: `sails.hooks` should be a dictionary.')); }","    async.each(Object.keys(sails.hooks), function (hookName, next){","      if (!_.isFunction(sails.hooks[hookName].handleLift)) {","        return next();","      }","      return sails.hooks[hookName].handleLift(next);","    }, function (err){","      if (err) { return cb(err); }","      return cb(null, sails);","    });","","  });","};",""],"l":{"5":1,"6":1,"7":1,"23":1,"25":0,"28":0,"29":0,"33":0,"35":0,"37":0,"38":0,"42":0,"43":0,"47":0,"48":0,"52":0,"53":0,"59":0,"61":0,"62":0,"63":0,"65":0,"68":0,"69":0,"70":0,"71":0,"76":0,"81":0,"82":0,"83":0,"84":0,"86":0,"88":0,"89":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/exposeGlobals.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/exposeGlobals.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"exposeGlobals","line":18,"loc":{"start":{"line":18,"column":17},"end":{"line":18,"column":42}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":29}},"3":{"start":{"line":18,"column":0},"end":{"line":47,"column":2}},"4":{"start":{"line":19,"column":2},"end":{"line":19,"column":19}},"5":{"start":{"line":23,"column":2},"end":{"line":26,"column":3}},"6":{"start":{"line":24,"column":4},"end":{"line":24,"column":62}},"7":{"start":{"line":25,"column":4},"end":{"line":25,"column":11}},"8":{"start":{"line":28,"column":2},"end":{"line":28,"column":183}},"9":{"start":{"line":30,"column":2},"end":{"line":30,"column":52}},"10":{"start":{"line":33,"column":2},"end":{"line":35,"column":3}},"11":{"start":{"line":34,"column":4},"end":{"line":34,"column":20}},"12":{"start":{"line":36,"column":2},"end":{"line":38,"column":3}},"13":{"start":{"line":37,"column":4},"end":{"line":37,"column":28}},"14":{"start":{"line":39,"column":2},"end":{"line":41,"column":3}},"15":{"start":{"line":40,"column":4},"end":{"line":40,"column":28}}},"branchMap":{"1":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":23,"column":2}},{"start":{"line":23,"column":2},"end":{"line":23,"column":2}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":25},"end":{"line":30,"column":45}},{"start":{"line":30,"column":49},"end":{"line":30,"column":51}}]},"3":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":2},"end":{"line":33,"column":2}},{"start":{"line":33,"column":2},"end":{"line":33,"column":2}}]},"4":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":2},"end":{"line":36,"column":2}},{"start":{"line":36,"column":2},"end":{"line":36,"column":2}}]},"5":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":2},"end":{"line":39,"column":2}},{"start":{"line":39,"column":2},"end":{"line":39,"column":2}}]}},"code":["/**"," * Module dependencies."," */","","var _ = require('@sailshq/lodash');","var async = require('async');","","","/**"," * exposeGlobals()"," *"," * Expose certain global variables"," * (if config says so)"," *"," * @api private"," */","","module.exports = function exposeGlobals() {","  var sails = this;","","","  // Globals explicitly disabled","  if (sails.config.globals === false) {","    sails.log.verbose('No global variables will be exposed.');","    return;","  }","","  sails.log.verbose('Exposing global variables... (you can customize/disable this by modifying the properties in `sails.config.globals`.  Set it to `false` to disable all globals.)');","","  sails.config.globals = sails.config.globals || {};","","  // Provide global access (if allowed in config)","  if (sails.config.globals._ !== false) {","    global['_'] = _;","  }","  if (sails.config.globals.async !== false) {","    global['async'] = async;","  }","  if (sails.config.globals.sails !== false) {","    global['sails'] = sails;","  }","","  // `services` hook takes care of globalizing services (if enabled)","","  // `orm` hook takes care of globalizing models and adapters (if enabled)","","};",""],"l":{"5":1,"6":1,"18":1,"19":0,"23":0,"24":0,"25":0,"28":0,"30":0,"33":0,"34":0,"36":0,"37":0,"39":0,"40":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/bootstrap.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/bootstrap.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"runBootstrap","line":19,"loc":{"start":{"line":19,"column":17},"end":{"line":19,"column":43}}},"2":{"name":"bootstrapTookTooLong","line":34,"loc":{"start":{"line":34,"column":25},"end":{"line":34,"column":57}}},"3":{"name":"bootstrapDone","line":44,"loc":{"start":{"line":44,"column":34},"end":{"line":44,"column":62}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}},"2":{"start":{"line":19,"column":0},"end":{"line":64,"column":2}},"3":{"start":{"line":21,"column":2},"end":{"line":21,"column":19}},"4":{"start":{"line":25,"column":2},"end":{"line":27,"column":3}},"5":{"start":{"line":26,"column":4},"end":{"line":26,"column":16}},"6":{"start":{"line":29,"column":2},"end":{"line":29,"column":82}},"7":{"start":{"line":33,"column":2},"end":{"line":33,"column":56}},"8":{"start":{"line":34,"column":2},"end":{"line":39,"column":16}},"9":{"start":{"line":35,"column":4},"end":{"line":38,"column":16}},"10":{"start":{"line":41,"column":2},"end":{"line":41,"column":29}},"11":{"start":{"line":43,"column":2},"end":{"line":62,"column":3}},"12":{"start":{"line":44,"column":4},"end":{"line":52,"column":7}},"13":{"start":{"line":45,"column":6},"end":{"line":48,"column":7}},"14":{"start":{"line":46,"column":8},"end":{"line":46,"column":95}},"15":{"start":{"line":47,"column":8},"end":{"line":47,"column":15}},"16":{"start":{"line":49,"column":6},"end":{"line":49,"column":28}},"17":{"start":{"line":50,"column":6},"end":{"line":50,"column":26}},"18":{"start":{"line":51,"column":6},"end":{"line":51,"column":21}},"19":{"start":{"line":55,"column":4},"end":{"line":58,"column":5}},"20":{"start":{"line":56,"column":6},"end":{"line":56,"column":98}},"21":{"start":{"line":57,"column":6},"end":{"line":57,"column":13}},"22":{"start":{"line":59,"column":4},"end":{"line":59,"column":26}},"23":{"start":{"line":60,"column":4},"end":{"line":60,"column":24}},"24":{"start":{"line":61,"column":4},"end":{"line":61,"column":17}}},"branchMap":{"1":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":2},"end":{"line":25,"column":2}},{"start":{"line":25,"column":2},"end":{"line":25,"column":2}}]},"2":{"line":33,"type":"binary-expr","locations":[{"start":{"line":33,"column":18},"end":{"line":33,"column":47}},{"start":{"line":33,"column":51},"end":{"line":33,"column":55}}]},"3":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":6},"end":{"line":45,"column":6}},{"start":{"line":45,"column":6},"end":{"line":45,"column":6}}]},"4":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":4},"end":{"line":55,"column":4}},{"start":{"line":55,"column":4},"end":{"line":55,"column":4}}]}},"code":["/**"," * Module dependencies"," */","","var util = require('util');","","","/**"," * runBootstrap"," *"," * TODO: move this into a new `bootstrap` hook so that it may be flipped"," * on and off explicitly w/o loading/depending on user config"," *"," * @param  {Function} cb [description]"," *"," * @api private"," */","","module.exports = function runBootstrap(cb) {","","  var sails = this;","","  // Run bootstrap script if specified","  // Otherwise, do nothing and continue","  if (!sails.config.bootstrap) {","    return cb();","  }","","  sails.log.verbose('Running the setup logic in `sails.config.bootstrap(cb)`...');","","  // IF bootstrap takes too long, display warning message","  // (just in case user forgot to call their bootstrap's `cb`)","  var timeoutMs = sails.config.bootstrapTimeout || 2000;","  var timer = setTimeout(function bootstrapTookTooLong() {","    sails.log.warn(util.format(","    'Bootstrap is taking unusually long to execute its callback (%d milliseconds).\\n'+","    'Perhaps you forgot to call it?  The callback is the first argument of the function, `cb`.',","    timeoutMs));","  }, timeoutMs);","","  var ranBootstrapFn = false;","","  try {","    return sails.config.bootstrap(function bootstrapDone(err) {","      if (ranBootstrapFn) {","        sails.log.error('You called the callback in `sails.config.bootstrap` more than once!');","        return;","      }","      ranBootstrapFn = true;","      clearTimeout(timer);","      return cb(err);","    });","  }","  catch (e) {","    if (ranBootstrapFn) {","      sails.log.error('The bootstrap function threw an error after its callback was called ::',e);","      return;","    }","    ranBootstrapFn = true;","    clearTimeout(timer);","    return cb(e);","  }","","};",""],"l":{"5":1,"19":1,"21":0,"25":0,"26":0,"29":0,"33":0,"34":0,"35":0,"41":0,"43":0,"44":0,"45":0,"46":0,"47":0,"49":0,"50":0,"51":0,"55":0,"56":0,"57":0,"59":0,"60":0,"61":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/getHost.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/getHost.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0},"b":{"1":[0,0],"2":[0,0,0]},"f":{"1":0},"fnMap":{"1":{"name":"getHost","line":8,"loc":{"start":{"line":8,"column":17},"end":{"line":8,"column":36}}}},"statementMap":{"1":{"start":{"line":8,"column":0},"end":{"line":14,"column":2}},"2":{"start":{"line":9,"column":2},"end":{"line":9,"column":19}},"3":{"start":{"line":11,"column":2},"end":{"line":11,"column":77}},"4":{"start":{"line":12,"column":2},"end":{"line":12,"column":76}},"5":{"start":{"line":13,"column":2},"end":{"line":13,"column":14}}},"branchMap":{"1":{"line":11,"type":"binary-expr","locations":[{"start":{"line":11,"column":24},"end":{"line":11,"column":47}},{"start":{"line":11,"column":51},"end":{"line":11,"column":76}}]},"2":{"line":12,"type":"binary-expr","locations":[{"start":{"line":12,"column":13},"end":{"line":12,"column":35}},{"start":{"line":12,"column":39},"end":{"line":12,"column":54}},{"start":{"line":12,"column":58},"end":{"line":12,"column":75}}]}},"code":["/**"," * Sails.prototype.getHost()"," *"," * @return {String} the configured hostname of the server"," * (IMPORTANT: returns undefined if not specifically configured)"," */","","module.exports = function getHost() {","  var sails = this;","","  var hasExplicitHost = sails.config.hooks.http && sails.config.explicitHost;","  var host = sails.config.proxyHost || hasExplicitHost || sails.config.host;","  return host;","};",""],"l":{"8":1,"9":0,"11":0,"12":0,"13":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/isLocalSailsValid.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/isLocalSailsValid.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0,0],"12":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"isLocalSailsValid","line":20,"loc":{"start":{"line":20,"column":17},"end":{"line":20,"column":64}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":23}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":42}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":38}},"4":{"start":{"line":8,"column":0},"end":{"line":8,"column":31}},"5":{"start":{"line":9,"column":0},"end":{"line":9,"column":37}},"6":{"start":{"line":20,"column":0},"end":{"line":97,"column":2}},"7":{"start":{"line":22,"column":2},"end":{"line":22,"column":19}},"8":{"start":{"line":25,"column":2},"end":{"line":27,"column":3}},"9":{"start":{"line":26,"column":4},"end":{"line":26,"column":29}},"10":{"start":{"line":30,"column":2},"end":{"line":30,"column":57}},"11":{"start":{"line":31,"column":2},"end":{"line":31,"column":52}},"12":{"start":{"line":35,"column":2},"end":{"line":38,"column":3}},"13":{"start":{"line":36,"column":4},"end":{"line":36,"column":27}},"14":{"start":{"line":37,"column":4},"end":{"line":37,"column":11}},"15":{"start":{"line":41,"column":2},"end":{"line":43,"column":3}},"16":{"start":{"line":42,"column":4},"end":{"line":42,"column":17}},"17":{"start":{"line":46,"column":2},"end":{"line":46,"column":61}},"18":{"start":{"line":49,"column":2},"end":{"line":52,"column":3}},"19":{"start":{"line":50,"column":4},"end":{"line":50,"column":66}},"20":{"start":{"line":51,"column":4},"end":{"line":51,"column":11}},"21":{"start":{"line":56,"column":2},"end":{"line":56,"column":51}},"22":{"start":{"line":65,"column":2},"end":{"line":65,"column":68}},"23":{"start":{"line":66,"column":2},"end":{"line":74,"column":3}},"24":{"start":{"line":67,"column":4},"end":{"line":67,"column":52}},"25":{"start":{"line":69,"column":4},"end":{"line":69,"column":16}},"26":{"start":{"line":70,"column":4},"end":{"line":70,"column":23}},"27":{"start":{"line":71,"column":4},"end":{"line":71,"column":69}},"28":{"start":{"line":72,"column":4},"end":{"line":72,"column":36}},"29":{"start":{"line":73,"column":4},"end":{"line":73,"column":16}},"30":{"start":{"line":77,"column":2},"end":{"line":77,"column":56}},"31":{"start":{"line":78,"column":2},"end":{"line":80,"column":3}},"32":{"start":{"line":81,"column":2},"end":{"line":81,"column":52}},"33":{"start":{"line":82,"column":2},"end":{"line":84,"column":3}},"34":{"start":{"line":87,"column":2},"end":{"line":93,"column":3}},"35":{"start":{"line":90,"column":4},"end":{"line":92,"column":5}},"36":{"start":{"line":91,"column":6},"end":{"line":91,"column":86}},"37":{"start":{"line":96,"column":2},"end":{"line":96,"column":14}}},"branchMap":{"1":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":2},"end":{"line":25,"column":2}},{"start":{"line":25,"column":2},"end":{"line":25,"column":2}}]},"2":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":2},"end":{"line":35,"column":2}},{"start":{"line":35,"column":2},"end":{"line":35,"column":2}}]},"3":{"line":35,"type":"binary-expr","locations":[{"start":{"line":35,"column":8},"end":{"line":35,"column":23}},{"start":{"line":35,"column":27},"end":{"line":35,"column":48}}]},"4":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":2},"end":{"line":41,"column":2}},{"start":{"line":41,"column":2},"end":{"line":41,"column":2}}]},"5":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":2},"end":{"line":49,"column":2}},{"start":{"line":49,"column":2},"end":{"line":49,"column":2}}]},"6":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":2},"end":{"line":66,"column":2}},{"start":{"line":66,"column":2},"end":{"line":66,"column":2}}]},"7":{"line":67,"type":"cond-expr","locations":[{"start":{"line":67,"column":26},"end":{"line":67,"column":35}},{"start":{"line":67,"column":38},"end":{"line":67,"column":51}}]},"8":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":2},"end":{"line":78,"column":2}},{"start":{"line":78,"column":2},"end":{"line":78,"column":2}}]},"9":{"line":82,"type":"if","locations":[{"start":{"line":82,"column":2},"end":{"line":82,"column":2}},{"start":{"line":82,"column":2},"end":{"line":82,"column":2}}]},"10":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":2},"end":{"line":87,"column":2}},{"start":{"line":87,"column":2},"end":{"line":87,"column":2}}]},"11":{"line":87,"type":"binary-expr","locations":[{"start":{"line":87,"column":6},"end":{"line":87,"column":20}},{"start":{"line":87,"column":24},"end":{"line":87,"column":36}},{"start":{"line":87,"column":40},"end":{"line":87,"column":58}}]},"12":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":4},"end":{"line":90,"column":4}},{"start":{"line":90,"column":4},"end":{"line":90,"column":4}}]}},"code":["/**"," * Module dependencies"," */","","var fs = require('fs');","var CaptainsLog = require('captains-log');","var sailsutil = require('sails-util');","var semver = require('semver');","var Err = require('../../../errors');","","","","/**"," * Check if the specified installation of Sails is valid for the specified project."," *"," * @param sailsPath"," * @param appPath"," */","","module.exports = function isLocalSailsValid(sailsPath, appPath) {","","  var sails = this;","","  // Has no package.json file","  if (!fs.existsSync(appPath + '/package.json')) {","    Err.warn.noPackageJSON();","  }","","  // Load this app's package.json and dependencies","  var appPackageJSON = sailsutil.getPackageSync(appPath);","  var appDependencies = appPackageJSON.dependencies;","","","  // Package.json exists, but doesn't list Sails as a dependency","  if (!(appDependencies && appDependencies.sails)) {","    Err.warn.notSailsApp();","    return;","  }","","  // Ensure the target Sails exists","  if (!fs.existsSync(sailsPath)) {","    return false;","  }","","  // Read the package.json in the local installation of Sails","  var sailsPackageJSON = sailsutil.getPackageSync(sailsPath);","","  // Local Sails has a corrupted package.json","  if (!sailsPackageJSON) {","    Err.warn.badLocalDependency(sailsPath, appDependencies.sails);","    return;","  }","","","  // Lookup sails dependency requirement in app's package.json","  var requiredSailsVersion = appDependencies.sails;","","  //","  // TODO: use npm's built-in version comparator instead of taking care of","  // all these edge cases:","  //","","  // If you're using a `git://` sails dependency, you probably know","  // what you're doing, but we'll let you know just in case.","  var expectsGitVersion = requiredSailsVersion.match(/^git:\\/\\/.+/);","  if (expectsGitVersion) {","    var log = sails.log ? sails.log : CaptainsLog();","","    log.blank();","    log.debug('NOTE:');","    log.debug('This app depends on an unreleased version of Sails:');","    log.debug(requiredSailsVersion);","    log.blank();","  }","","  // Ignore `latest` and `beta` (kind of like how we handle specified git:// deps)","  var expectsLatest = requiredSailsVersion === 'latest';","  if (expectsLatest) {","    // ...","  }","  var expectsBeta = requiredSailsVersion === 'beta';","  if (expectsBeta) {","    // ...","  }","","  // Error out if it has the wrong version in its package.json","  if (!expectsLatest && !expectsBeta && !expectsGitVersion) {","","    // Use semver for version comparison","    if (!semver.satisfies(sailsPackageJSON.version, requiredSailsVersion)) {","      Err.warn.incompatibleLocalSails(requiredSailsVersion, sailsPackageJSON.version);","    }","  }","","  // If we made it this far, the target Sails installation must be OK","  return true;","};",""],"l":{"5":1,"6":1,"7":1,"8":1,"9":1,"20":1,"22":0,"25":0,"26":0,"30":0,"31":0,"35":0,"36":0,"37":0,"41":0,"42":0,"46":0,"49":0,"50":0,"51":0,"56":0,"65":0,"66":0,"67":0,"69":0,"70":0,"71":0,"72":0,"73":0,"77":0,"78":0,"81":0,"82":0,"87":0,"90":0,"91":0,"96":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/errors/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/errors/index.js","s":{"1":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":2,"column":0},"end":{"line":5,"column":2}}},"branchMap":{},"code":["// Merge together error sub-modules","module.exports = {","  fatal: require('./fatal'),","  warn: require('./warn')","};",""],"l":{"2":1}},"/home/travis/build/npmtest/node-npmtest-sails/sails/errors/fatal.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/errors/fatal.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":1,"78":0,"79":0,"80":0,"81":0},"b":{"1":[0,0],"2":[0,0,0],"3":[0,0],"4":[0,0],"5":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"fnMap":{"1":{"name":"(anonymous_1)","line":18,"loc":{"start":{"line":18,"column":21},"end":{"line":18,"column":35}}},"2":{"name":"(anonymous_2)","line":25,"loc":{"start":{"line":25,"column":17},"end":{"line":25,"column":28}}},"3":{"name":"(anonymous_3)","line":31,"loc":{"start":{"line":31,"column":15},"end":{"line":31,"column":26}}},"4":{"name":"(anonymous_4)","line":37,"loc":{"start":{"line":37,"column":22},"end":{"line":37,"column":67}}},"5":{"name":"(anonymous_5)","line":49,"loc":{"start":{"line":49,"column":17},"end":{"line":49,"column":28}}},"6":{"name":"(anonymous_6)","line":57,"loc":{"start":{"line":57,"column":20},"end":{"line":57,"column":31}}},"7":{"name":"(anonymous_7)","line":68,"loc":{"start":{"line":68,"column":25},"end":{"line":68,"column":52}}},"8":{"name":"(anonymous_8)","line":80,"loc":{"start":{"line":80,"column":20},"end":{"line":80,"column":53}}},"9":{"name":"(anonymous_9)","line":116,"loc":{"start":{"line":116,"column":21},"end":{"line":116,"column":62}}},"10":{"name":"(anonymous_10)","line":125,"loc":{"start":{"line":125,"column":25},"end":{"line":125,"column":61}}},"11":{"name":"(anonymous_11)","line":131,"loc":{"start":{"line":131,"column":25},"end":{"line":131,"column":63}}},"12":{"name":"(anonymous_12)","line":145,"loc":{"start":{"line":145,"column":32},"end":{"line":145,"column":56}}},"13":{"name":"(anonymous_13)","line":151,"loc":{"start":{"line":151,"column":22},"end":{"line":151,"column":83}}},"14":{"name":"(anonymous_14)","line":165,"loc":{"start":{"line":165,"column":22},"end":{"line":165,"column":72}}},"15":{"name":"_terminateProcess","line":211,"loc":{"start":{"line":211,"column":0},"end":{"line":211,"column":39}}}},"statementMap":{"1":{"start":{"line":4,"column":0},"end":{"line":4,"column":31}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":31}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":29}},"4":{"start":{"line":10,"column":0},"end":{"line":10,"column":74}},"5":{"start":{"line":15,"column":0},"end":{"line":172,"column":2}},"6":{"start":{"line":19,"column":4},"end":{"line":19,"column":19}},"7":{"start":{"line":20,"column":4},"end":{"line":20,"column":39}},"8":{"start":{"line":21,"column":4},"end":{"line":21,"column":58}},"9":{"start":{"line":22,"column":4},"end":{"line":22,"column":25}},"10":{"start":{"line":26,"column":4},"end":{"line":26,"column":91}},"11":{"start":{"line":27,"column":4},"end":{"line":27,"column":51}},"12":{"start":{"line":28,"column":4},"end":{"line":28,"column":25}},"13":{"start":{"line":32,"column":4},"end":{"line":32,"column":98}},"14":{"start":{"line":33,"column":4},"end":{"line":33,"column":70}},"15":{"start":{"line":34,"column":4},"end":{"line":34,"column":25}},"16":{"start":{"line":38,"column":4},"end":{"line":41,"column":6}},"17":{"start":{"line":42,"column":4},"end":{"line":42,"column":43}},"18":{"start":{"line":43,"column":4},"end":{"line":43,"column":97}},"19":{"start":{"line":44,"column":4},"end":{"line":44,"column":25}},"20":{"start":{"line":50,"column":4},"end":{"line":50,"column":46}},"21":{"start":{"line":51,"column":4},"end":{"line":51,"column":72}},"22":{"start":{"line":52,"column":4},"end":{"line":52,"column":25}},"23":{"start":{"line":58,"column":4},"end":{"line":60,"column":58}},"24":{"start":{"line":61,"column":4},"end":{"line":61,"column":35}},"25":{"start":{"line":62,"column":4},"end":{"line":62,"column":20}},"26":{"start":{"line":69,"column":4},"end":{"line":69,"column":75}},"27":{"start":{"line":70,"column":4},"end":{"line":70,"column":94}},"28":{"start":{"line":71,"column":4},"end":{"line":71,"column":99}},"29":{"start":{"line":72,"column":4},"end":{"line":72,"column":25}},"30":{"start":{"line":82,"column":4},"end":{"line":85,"column":83}},"31":{"start":{"line":86,"column":4},"end":{"line":86,"column":24}},"32":{"start":{"line":87,"column":4},"end":{"line":87,"column":16}},"33":{"start":{"line":89,"column":4},"end":{"line":89,"column":53}},"34":{"start":{"line":90,"column":4},"end":{"line":90,"column":119}},"35":{"start":{"line":91,"column":4},"end":{"line":91,"column":80}},"36":{"start":{"line":92,"column":4},"end":{"line":92,"column":16}},"37":{"start":{"line":94,"column":4},"end":{"line":94,"column":56}},"38":{"start":{"line":95,"column":4},"end":{"line":95,"column":73}},"39":{"start":{"line":96,"column":4},"end":{"line":96,"column":78}},"40":{"start":{"line":97,"column":4},"end":{"line":97,"column":16}},"41":{"start":{"line":98,"column":4},"end":{"line":98,"column":124}},"42":{"start":{"line":99,"column":4},"end":{"line":99,"column":16}},"43":{"start":{"line":100,"column":4},"end":{"line":100,"column":85}},"44":{"start":{"line":101,"column":4},"end":{"line":101,"column":16}},"45":{"start":{"line":102,"column":4},"end":{"line":102,"column":91}},"46":{"start":{"line":103,"column":4},"end":{"line":103,"column":62}},"47":{"start":{"line":104,"column":4},"end":{"line":104,"column":16}},"48":{"start":{"line":105,"column":4},"end":{"line":105,"column":72}},"49":{"start":{"line":106,"column":4},"end":{"line":106,"column":61}},"50":{"start":{"line":107,"column":4},"end":{"line":107,"column":16}},"51":{"start":{"line":117,"column":4},"end":{"line":117,"column":41}},"52":{"start":{"line":119,"column":4},"end":{"line":119,"column":83}},"53":{"start":{"line":120,"column":4},"end":{"line":120,"column":50}},"54":{"start":{"line":121,"column":4},"end":{"line":121,"column":84}},"55":{"start":{"line":122,"column":4},"end":{"line":122,"column":32}},"56":{"start":{"line":126,"column":4},"end":{"line":126,"column":85}},"57":{"start":{"line":127,"column":4},"end":{"line":127,"column":79}},"58":{"start":{"line":128,"column":4},"end":{"line":128,"column":32}},"59":{"start":{"line":132,"column":4},"end":{"line":132,"column":106}},"60":{"start":{"line":133,"column":4},"end":{"line":133,"column":107}},"61":{"start":{"line":141,"column":4},"end":{"line":141,"column":32}},"62":{"start":{"line":146,"column":4},"end":{"line":146,"column":101}},"63":{"start":{"line":147,"column":4},"end":{"line":147,"column":85}},"64":{"start":{"line":148,"column":4},"end":{"line":148,"column":32}},"65":{"start":{"line":152,"column":4},"end":{"line":152,"column":103}},"66":{"start":{"line":153,"column":4},"end":{"line":153,"column":75}},"67":{"start":{"line":154,"column":4},"end":{"line":154,"column":130}},"68":{"start":{"line":156,"column":4},"end":{"line":156,"column":60}},"69":{"start":{"line":157,"column":4},"end":{"line":159,"column":5}},"70":{"start":{"line":158,"column":6},"end":{"line":158,"column":71}},"71":{"start":{"line":160,"column":4},"end":{"line":161,"column":112}},"72":{"start":{"line":162,"column":4},"end":{"line":162,"column":32}},"73":{"start":{"line":166,"column":4},"end":{"line":166,"column":89}},"74":{"start":{"line":167,"column":4},"end":{"line":167,"column":98}},"75":{"start":{"line":168,"column":4},"end":{"line":168,"column":34}},"76":{"start":{"line":170,"column":4},"end":{"line":170,"column":32}},"77":{"start":{"line":211,"column":0},"end":{"line":224,"column":1}},"78":{"start":{"line":212,"column":2},"end":{"line":221,"column":3}},"79":{"start":{"line":213,"column":4},"end":{"line":219,"column":7}},"80":{"start":{"line":220,"column":4},"end":{"line":220,"column":17}},"81":{"start":{"line":223,"column":2},"end":{"line":223,"column":28}}},"branchMap":{"1":{"line":84,"type":"binary-expr","locations":[{"start":{"line":84,"column":27},"end":{"line":84,"column":37}},{"start":{"line":84,"column":41},"end":{"line":84,"column":43}}]},"2":{"line":96,"type":"binary-expr","locations":[{"start":{"line":96,"column":14},"end":{"line":96,"column":28}},{"start":{"line":96,"column":32},"end":{"line":96,"column":48}},{"start":{"line":96,"column":52},"end":{"line":96,"column":77}}]},"3":{"line":117,"type":"binary-expr","locations":[{"start":{"line":117,"column":13},"end":{"line":117,"column":19}},{"start":{"line":117,"column":23},"end":{"line":117,"column":40}}]},"4":{"line":157,"type":"if","locations":[{"start":{"line":157,"column":4},"end":{"line":157,"column":4}},{"start":{"line":157,"column":4},"end":{"line":157,"column":4}}]},"5":{"line":212,"type":"if","locations":[{"start":{"line":212,"column":2},"end":{"line":212,"column":2}},{"start":{"line":212,"column":2},"end":{"line":212,"column":2}}]}},"code":["/**"," * Module dependencies"," */","var nodeutil = require('util');","var nodepath = require('path');","var chalk = require('chalk');","","// Build logger using best-available information","// when this module is initially required.","var log = require('captains-log')(require('../lib/app/configuration/rc'));","","/**"," * Fatal Errors"," */","module.exports = {","","  // Lift-time and load-time errors","  failedToLoadSails: function(err) {","    log.error(err);","    log.error('Could not load Sails.');","    log.error('Are you using the latest stable version?');","    _terminateProcess(1);","  },","","  noPackageJSON: function() {","    log.error('Cannot read package.json in the current directory (' + process.cwd() + ')');","    log.error('Are you sure this is a Sails app?');","    _terminateProcess(1);","  },","","  notSailsApp: function() {","    log.error('The package.json in the current directory does not list Sails as a dependency...');","    log.error('Are you sure `' + process.cwd() + '` is a Sails app?');","    _terminateProcess(1);","  },","","  badLocalDependency: function(pathTo_localSails, requiredVersion) {","    log.error(","      'The local Sails dependency installed at `' + pathTo.localSails + '` ' +","      'has a corrupted, missing, or un-parsable package.json file.'","    );","    log.error('You may consider running:');","    log.error('rm -rf ' + pathTo_localSails + ' && npm install sails@' + app.dependencies.sails);","    _terminateProcess(1);","  },","","  // TODO: replace the inline version of this error","  // app/loadHooks.js:42","  malformedHook: function() {","    log.error('Malformed hook! (' + id + ')');","    log.error('Hooks should be a function with one argument (`sails`)');","    _terminateProcess(1);","  },","","  // TODO: replace the inline version of this error","  // app/load.js:146","  hooksTookTooLong: function() {","    var hooksTookTooLongErr = 'Hooks are taking way too long to get ready...  ' +","      'Something might be amiss.\\nAre you using any custom hooks?\\nIf so, make sure the hook\\'s ' +","      '`initialize()` method is triggering its callback.';","    log.error(hooksTookTooLongErr);","    process.exit(1);","  },","","","","  // Invalid user module errors","  invalidCustomResponse: function(responseIdentity) {","    log.error('Cannot define custom response `' + responseIdentity + '`.');","    log.error('`res.' + responseIdentity + '` has special meaning in Connect/Express/Sails.');","    log.error('Please remove the `' + responseIdentity + '` file from the `responses` directory.');","    _terminateProcess(1);","  },","","","","  // This doesn't technically _need_ to be a fatal error- it just is","  // because certain grunt modules (e.g. grunt-contrib-watch) don't restart","  // when an error occurs.","  __GruntAborted__: function(consoleMsg, stackTrace) {","","    var gruntErr =","      '\\n------------------------------------------------------------------------\\n' +","      consoleMsg + '\\n' + (stackTrace || '') +","      '\\n------------------------------------------------------------------------';","    log.error(gruntErr);","    log.blank();","","    log.error('Looks like a Grunt error occurred--');","    log.error('Please fix it, then **restart Sails** to continue running tasks (e.g. watching for changes in assets)');","    log.error('Or if you\\'re stuck, check out the troubleshooting tips below.');","    log.blank();","","    log.error(chalk.underline('Troubleshooting tips:'));","    var relativePublicPath = (nodepath.resolve(process.cwd(), './.tmp'));","    var uid = process.getuid && process.getuid() || 'YOUR_COMPUTER_USER_NAME';","    log.error();","    log.error(' *-> Are \"grunt\" and related grunt task modules installed locally?  Run `npm install` if you\\'re not sure.');","    log.error();","    log.error(' *-> You might have a malformed LESS, SASS, CoffeeScript file, etc.');","    log.error();","    log.error(' *-> Or maybe you don\\'t have permissions to access the `.tmp` directory?');","    log.error('     e.g., `' + relativePublicPath + '`', '?');","    log.error();","    log.error('     If you think this might be the case, try running:');","    log.error('     sudo chown -R', uid, relativePublicPath);","    log.blank();","","    // See note above this function - for now, this will not","    // actually terminate the process.  The rest of Sails should","    // continue to run.","    // return _terminateProcess(1);","  },","","","  __UnknownPolicy__: function(policy, source, pathToPolicies) {","    source = source || 'config.policies';","","    log.error('Unknown policy, \"' + policy + '\", referenced in `' + source + '`.');","    log.error('Are you sure that policy exists?');","    log.error('It would be located at: `' + pathToPolicies + '/' + policy + '.js`');","    return _terminateProcess(1);","  },","","  __InvalidConnection__: function(connection, sourceModelId) {","    log.error('In model (' + sourceModelId + '), invalid connection ::', connection);","    log.error('Must contain an `adapter` key referencing the adapter to use.');","    return _terminateProcess(1);","  },","","  __UnknownConnection__: function(connectionId, sourceModelId) {","    log.error('Unknown connection, \"' + connectionId + '\", referenced in model `' + sourceModelId + '`.');","    log.error('Are you sure that connection exists?  It should be defined in `sails.config.connections`.');","","    // var probableAdapterModuleName = connectionId.toLowerCase();","    // if ( ! probableAdapterModuleName.match(/^(sails-|waterline-)/) ) {","    // \tprobableAdapterModuleName = 'sails-' + probableAdapterModuleName;","    // }","    // log.error('Otherwise, if you\\'re trying to use an adapter named `' + connectionId + '`, please run ' +","    // \t'`npm install ' + probableAdapterModuleName + '@' + sails.majorVersion + '.' + sails.minorVersion + '.x`');","    return _terminateProcess(1);","  },","","","  __ModelIsMissingConnection__: function(sourceModelId) {","    log.error(nodeutil.format('One of your models (%s) doesn\\'t have a connection.', sourceModelId));","    log.error('Do you have a default `connection` in your `config/models.js` file?');","    return _terminateProcess(1);","  },","","  __UnknownAdapter__: function(adapterId, sourceModelId, sailsMajorV, sailsMinorV) {","    log.error('Trying to use unknown adapter, \"' + adapterId + '\", in model `' + sourceModelId + '`.');","    log.error('Are you sure that adapter is installed in this Sails app?');","    log.error('If you wrote a custom adapter with identity=\"' + adapterId + '\", it should be in this app\\'s adapters directory.');","","    var probableAdapterModuleName = adapterId.toLowerCase();","    if (!probableAdapterModuleName.match(/^(sails-|waterline-)/)) {","      probableAdapterModuleName = 'sails-' + probableAdapterModuleName;","    }","    log.error('Otherwise, if you\\'re trying to use an adapter named `' + adapterId + '`, please run ' +","      '`npm install ' + probableAdapterModuleName + ' --save'/*'@' + sailsMajorV + '.' + sailsMinorV + '.x`'*/);","    return _terminateProcess(1);","  },","","  __InvalidAdapter__: function(attemptedModuleName, supplementalErrMsg) {","    log.error('There was an error attempting to require(\"' + attemptedModuleName + '\")');","    log.error('Is this a valid Sails/Waterline adapter?  The following error was encountered ::');","    log.error(supplementalErrMsg);","","    return _terminateProcess(1);","  }","};","","","","/**"," *"," * TODO: Make all of this more elegant."," * ========================================================"," * + Ideally we don't call `process.exit()` at all."," * We should consistently use `sails.lower()` for unhandleable core"," * errors and just trigger the appropriate callback w/ an error for"," * core lift/load and any CLI errors."," *"," * + Then we won't have to worry as much about dangling child processes"," * and things like that. Plus it's more testable that way."," *"," * In practice, the best way to do this may be an error domain or an"," * event emitted on the sails object (or both!)"," * ========================================================"," *"," *"," *"," * TODO: Merge w/ app/teardown.js"," * ========================================================"," * (probably achievable by doing the aforementioned cleanup)"," * ========================================================"," */","","","","/**"," * _terminateProcess"," *"," * Terminate the process as elegantly as possible."," * If process.env is 'test', throw instead."," *"," * @param  {[type]} code [console error code]"," * @param  {[type]} opts [currently unused]"," */","function _terminateProcess(code, opts) {","  if (process.env.NODE_ENV === 'test') {","    var Signal = new Error({","      type: 'terminate',","      code: code,","      options: {","        todo: 'put the stuff from the original errors in here'","      }","    });","    throw Signal;","  }","","  return process.exit(code);","}",""],"l":{"4":1,"5":1,"6":1,"10":1,"15":1,"19":0,"20":0,"21":0,"22":0,"26":0,"27":0,"28":0,"32":0,"33":0,"34":0,"38":0,"42":0,"43":0,"44":0,"50":0,"51":0,"52":0,"58":0,"61":0,"62":0,"69":0,"70":0,"71":0,"72":0,"82":0,"86":0,"87":0,"89":0,"90":0,"91":0,"92":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"117":0,"119":0,"120":0,"121":0,"122":0,"126":0,"127":0,"128":0,"132":0,"133":0,"141":0,"146":0,"147":0,"148":0,"152":0,"153":0,"154":0,"156":0,"157":0,"158":0,"160":0,"162":0,"166":0,"167":0,"168":0,"170":0,"211":1,"212":0,"213":0,"220":0,"223":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/configuration/rc.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/configuration/rc.js","s":{"1":1,"2":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":23}},"2":{"start":{"line":17,"column":0},"end":{"line":17,"column":29}}},"branchMap":{},"code":["/**"," * Module dependencies"," */","","var rc = require('rc');","","","/**"," * Locate and load a .sailsrc file if one exists."," *"," * NOTE: this occurs almost immediately when sails is required,"," * and since `rc` is synchronous, the examination of env variables,"," * cmdline opts, and .sailsrc files is immediate, and happens only once."," *"," * @type {Object}"," */","module.exports = rc('sails');",""],"l":{"5":1,"17":1}},"/home/travis/build/npmtest/node-npmtest-sails/sails/errors/warn.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/errors/warn.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0},"b":{},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"(anonymous_1)","line":17,"loc":{"start":{"line":17,"column":26},"end":{"line":17,"column":66}}},"2":{"name":"(anonymous_2)","line":34,"loc":{"start":{"line":34,"column":17},"end":{"line":34,"column":28}}},"3":{"name":"(anonymous_3)","line":40,"loc":{"start":{"line":40,"column":15},"end":{"line":40,"column":26}}},"4":{"name":"(anonymous_4)","line":46,"loc":{"start":{"line":46,"column":22},"end":{"line":46,"column":67}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":31}},"2":{"start":{"line":9,"column":0},"end":{"line":9,"column":74}},"3":{"start":{"line":15,"column":0},"end":{"line":55,"column":2}},"4":{"start":{"line":18,"column":4},"end":{"line":18,"column":65}},"5":{"start":{"line":19,"column":4},"end":{"line":19,"column":91}},"6":{"start":{"line":20,"column":4},"end":{"line":20,"column":15}},"7":{"start":{"line":21,"column":4},"end":{"line":21,"column":85}},"8":{"start":{"line":22,"column":4},"end":{"line":22,"column":111}},"9":{"start":{"line":23,"column":4},"end":{"line":23,"column":15}},"10":{"start":{"line":24,"column":4},"end":{"line":24,"column":102}},"11":{"start":{"line":25,"column":4},"end":{"line":25,"column":59}},"12":{"start":{"line":26,"column":4},"end":{"line":26,"column":15}},"13":{"start":{"line":27,"column":4},"end":{"line":27,"column":16}},"14":{"start":{"line":35,"column":4},"end":{"line":35,"column":90}},"15":{"start":{"line":36,"column":4},"end":{"line":36,"column":50}},"16":{"start":{"line":37,"column":4},"end":{"line":37,"column":15}},"17":{"start":{"line":41,"column":4},"end":{"line":41,"column":97}},"18":{"start":{"line":42,"column":4},"end":{"line":42,"column":69}},"19":{"start":{"line":43,"column":4},"end":{"line":43,"column":15}},"20":{"start":{"line":47,"column":4},"end":{"line":50,"column":6}},"21":{"start":{"line":51,"column":4},"end":{"line":51,"column":42}},"22":{"start":{"line":52,"column":4},"end":{"line":52,"column":89}},"23":{"start":{"line":53,"column":4},"end":{"line":53,"column":15}}},"branchMap":{},"code":["/**"," * Module dependencies"," */","","var nodepath = require('path');","","// Build logger using best-available information","// when this module is initially required.","var log = require('captains-log')(require('../lib/app/configuration/rc'));","","","/**"," * Warnings"," */","module.exports = {","","  incompatibleLocalSails: function(requiredVersion, localVersion) {","    log.warn('Trying to lift app using a local copy of `sails`');","    log.warn('(located in ' + nodepath.resolve(process.cwd(), 'node_modules/sails') + ')');","    log.warn();","    log.warn('But the package.json in the current directory indicates a dependency');","    log.warn('on Sails `' + requiredVersion + '`, and the locally installed Sails is `' + localVersion + '`!');","    log.warn();","    log.warn('If you run into compatibility issues, try installing ' + requiredVersion + ' locally:');","    log.warn('    $ npm install sails@' + requiredVersion);","    log.warn();","    log.blank();","  },","","","","  // Verbose-only warnings:","","  noPackageJSON: function() {","    log.warn('Cannot read package.json in the current directory (' + process.cwd() + ')');","    log.warn('Are you sure this is a Sails app?');","    log.warn();","  },","","  notSailsApp: function() {","    log.warn('The package.json in the current directory does not list Sails as a dependency...');","    log.warn('Are you sure `' + process.cwd() + '` is a Sails app?');","    log.warn();","  },","","  badLocalDependency: function(pathTo_localSails, requiredVersion) {","    log.warn(","      'The local Sails dependency installed at `' + pathTo_localSails + '` ' +","      'has a corrupted, missing, or un-parsable package.json file.'","    );","    log.warn('You may consider running:');","    log.warn('rm -rf ' + pathTo_localSails + ' && npm install sails@' + requiredVersion);","    log.warn();","  }","};",""],"l":{"5":1,"9":1,"15":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"35":0,"36":0,"37":0,"41":0,"42":0,"43":0,"47":0,"51":0,"52":0,"53":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/isSailsAppSync.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/isSailsAppSync.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"isSailsAppSync","line":17,"loc":{"start":{"line":17,"column":17},"end":{"line":17,"column":50}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":7,"column":36}},"2":{"start":{"line":17,"column":0},"end":{"line":32,"column":2}},"3":{"start":{"line":20,"column":2},"end":{"line":22,"column":3}},"4":{"start":{"line":21,"column":4},"end":{"line":21,"column":17}},"5":{"start":{"line":25,"column":2},"end":{"line":25,"column":57}},"6":{"start":{"line":26,"column":2},"end":{"line":26,"column":52}},"7":{"start":{"line":27,"column":2},"end":{"line":29,"column":3}},"8":{"start":{"line":28,"column":4},"end":{"line":28,"column":17}},"9":{"start":{"line":31,"column":2},"end":{"line":31,"column":14}}},"branchMap":{"1":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":2},"end":{"line":20,"column":2}},{"start":{"line":20,"column":2},"end":{"line":20,"column":2}}]},"2":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":2},"end":{"line":27,"column":2}},{"start":{"line":27,"column":2},"end":{"line":27,"column":2}}]},"3":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":8},"end":{"line":27,"column":23}},{"start":{"line":27,"column":27},"end":{"line":27,"column":48}}]}},"code":["/**"," * Module dependencies"," */","","var fs = require('fs'),","  path = require('path'),","  sailsutil = require('sails-util');","","","","/**"," * Check if the specified appPath contains something that looks like a Sails app."," *"," * @param {String} appPath"," */","","module.exports = function isSailsAppSync(appPath) {","","  // Has no package.json file","  if (!fs.existsSync(path.join(appPath, 'package.json'))) {","    return false;","  }","","  // Package.json exists, but doesn't list Sails as a dependency","  var appPackageJSON = sailsutil.getPackageSync(appPath);","  var appDependencies = appPackageJSON.dependencies;","  if (!(appDependencies && appDependencies.sails)) {","    return false;","  }","","  return true;","};",""],"l":{"5":1,"17":1,"20":0,"21":0,"25":0,"26":0,"27":0,"28":0,"31":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/inspect.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/inspect.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0},"b":{},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"inspect","line":19,"loc":{"start":{"line":19,"column":17},"end":{"line":19,"column":37}}},"2":{"name":"(anonymous_2)","line":29,"loc":{"start":{"line":29,"column":35},"end":{"line":29,"column":49}}},"3":{"name":"(anonymous_3)","line":32,"loc":{"start":{"line":32,"column":55},"end":{"line":32,"column":69}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":35}},"3":{"start":{"line":19,"column":0},"end":{"line":41,"column":2}},"4":{"start":{"line":20,"column":2},"end":{"line":20,"column":19}},"5":{"start":{"line":22,"column":2},"end":{"line":40,"column":5}},"6":{"start":{"line":29,"column":50},"end":{"line":29,"column":75}},"7":{"start":{"line":32,"column":70},"end":{"line":32,"column":93}}},"branchMap":{},"code":["/**"," * Module dependencies"," */","","var util = require('util');","var _ = require('@sailshq/lodash');","","","","/**"," * Sails.prototype.inspect()"," *"," * The string that should be returned when this `Sails` instance"," * is passed to `util.inspect()` (i.e. when logged w/ `console.log()`)"," *"," * @return {String}"," */","","module.exports = function inspect () {","  var sails = this;","","  return util.format('\\n'+","  '  |>   %s', this.toString()) + '\\n' +","  '\\\\___/  For help, see: http://sailsjs.org/documentation/concepts/'+","  '\\n\\n' +","  'Tip: Use `sails.config` to access your app\\'s runtime configuration.'+","  '\\n\\n' +","  util.format('%d Models:\\n', _(sails.models).toArray().value().length) +","  _(sails.models).toArray().filter(function (it) {return !it.junctionTable;}).pluck('globalId').value() +","  '\\n\\n' +","  util.format('%d Controllers:\\n', _(sails.controllers).toArray().value().length)+","  _(sails.controllers).toArray().pluck('globalId').map(function (it) {return it+'Controller';}).value() +","  '\\n\\n' +","  // 'Routes:\\n'+","  // _(sails.routes).toArray().filter(function (it) {return !it.junctionTable;}).pluck('globalId').map(function (it) {return it+'Controller';}).value() +","  // '\\n\\n' +","  util.format('%d Hooks:\\n', _(sails.hooks).toArray().value().length)+","  _(sails.hooks).toArray().pluck('identity').value() +","  '\\n' +","  '';","};",""],"l":{"5":1,"6":1,"19":1,"20":0,"22":0,"29":0,"32":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/toString.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/toString.js","s":{"1":1,"2":1,"3":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"toString","line":16,"loc":{"start":{"line":16,"column":17},"end":{"line":16,"column":38}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}},"2":{"start":{"line":16,"column":0},"end":{"line":18,"column":2}},"3":{"start":{"line":17,"column":2},"end":{"line":17,"column":145}}},"branchMap":{"1":{"line":17,"type":"cond-expr","locations":[{"start":{"line":17,"column":58},"end":{"line":17,"column":67}},{"start":{"line":17,"column":70},"end":{"line":17,"column":72}}]},"2":{"line":17,"type":"cond-expr","locations":[{"start":{"line":17,"column":110},"end":{"line":17,"column":138}},{"start":{"line":17,"column":141},"end":{"line":17,"column":143}}]},"3":{"line":17,"type":"binary-expr","locations":[{"start":{"line":17,"column":74},"end":{"line":17,"column":87}},{"start":{"line":17,"column":91},"end":{"line":17,"column":107}}]}},"code":["/**"," * Module dependencies"," */","","var util = require('util');","","","/**"," * Sails.prototype.toString()"," *"," * e.g."," * ('This is how `sails` looks when toString()ed: ' + sails)"," *"," * @return {String}"," */","module.exports = function toString () {","  return util.format('[a %sSails app%s]', this.isLifted ? 'lifted ' : '', this.isLifted && this.config.port ? ' on port '+this.config.port : '');","};",""],"l":{"5":1,"16":1,"17":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/toJSON.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/private/toJSON.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"toJSON","line":13,"loc":{"start":{"line":13,"column":17},"end":{"line":13,"column":36}}},"2":{"name":"(anonymous_2)","line":14,"loc":{"start":{"line":14,"column":24},"end":{"line":14,"column":50}}},"3":{"name":"(anonymous_3)","line":19,"loc":{"start":{"line":19,"column":32},"end":{"line":19,"column":61}}},"4":{"name":"(anonymous_4)","line":25,"loc":{"start":{"line":25,"column":32},"end":{"line":25,"column":62}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"2":{"start":{"line":13,"column":0},"end":{"line":42,"column":2}},"3":{"start":{"line":14,"column":2},"end":{"line":41,"column":9}},"4":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"5":{"start":{"line":16,"column":6},"end":{"line":16,"column":22}},"6":{"start":{"line":18,"column":4},"end":{"line":23,"column":5}},"7":{"start":{"line":19,"column":6},"end":{"line":22,"column":13}},"8":{"start":{"line":20,"column":8},"end":{"line":20,"column":25}},"9":{"start":{"line":21,"column":8},"end":{"line":21,"column":20}},"10":{"start":{"line":24,"column":4},"end":{"line":38,"column":5}},"11":{"start":{"line":25,"column":6},"end":{"line":37,"column":13}},"12":{"start":{"line":26,"column":8},"end":{"line":35,"column":9}},"13":{"start":{"line":27,"column":10},"end":{"line":34,"column":13}},"14":{"start":{"line":36,"column":8},"end":{"line":36,"column":20}},"15":{"start":{"line":40,"column":4},"end":{"line":40,"column":16}}},"branchMap":{"1":{"line":15,"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":15,"column":4}},{"start":{"line":15,"column":4},"end":{"line":15,"column":4}}]},"2":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":4},"end":{"line":18,"column":4}},{"start":{"line":18,"column":4},"end":{"line":18,"column":4}}]},"3":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":4},"end":{"line":24,"column":4}},{"start":{"line":24,"column":4},"end":{"line":24,"column":4}}]},"4":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":26,"column":8}},{"start":{"line":26,"column":8},"end":{"line":26,"column":8}}]}},"code":["/**"," * Module dependencies"," */","","var _ = require('@sailshq/lodash');","","","/**"," * [exports description]"," * @return {[type]} [description]"," */","","module.exports = function toJSON () {","  return _.reduce(this, function (pojo, val, key) {","    if (key === 'config') {","      pojo[key] = val;","    }","    if (key === 'hooks') {","      pojo[key] = _.reduce(val, function (memo, hook, ident) {","        memo.push(ident);","        return memo;","      }, []);","    }","    if (key === 'models') {","      pojo[key] = _.reduce(val, function (memo, model, ident) { //TODO: unused variable ident","        if (!model.junctionTable) {","          memo.push({","            attributes: model.attributes,","            identity: model.identity,","            globalId: model.globalId,","            connection: model.connection,","            schema: model.schema,","            tableName: model.tableName","          });","        }","        return memo;","      }, []);","    }","","    return pojo;","  }, {});","};",""],"l":{"5":1,"13":1,"14":0,"15":0,"16":0,"18":0,"19":0,"20":0,"21":0,"24":0,"25":0,"26":0,"27":0,"36":0,"40":0}},"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/configuration/load.js":{"path":"/home/travis/build/npmtest/node-npmtest-sails/sails/lib/app/configuration/load.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0]},"f":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"fnMap":{"1":{"name":"(anonymous_1)","line":11,"loc":{"start":{"line":11,"column":17},"end":{"line":11,"column":33}}},"2":{"name":"loadConfig","line":29,"loc":{"start":{"line":29,"column":9},"end":{"line":29,"column":33}}},"3":{"name":"(anonymous_3)","line":45,"loc":{"start":{"line":45,"column":22},"end":{"line":45,"column":35}}},"4":{"name":"(anonymous_4)","line":92,"loc":{"start":{"line":92,"column":10},"end":{"line":92,"column":35}}},"5":{"name":"(anonymous_5)","line":104,"loc":{"start":{"line":104,"column":34},"end":{"line":104,"column":47}}},"6":{"name":"(anonymous_6)","line":107,"loc":{"start":{"line":107,"column":58},"end":{"line":107,"column":78}}},"7":{"name":"(anonymous_7)","line":125,"loc":{"start":{"line":125,"column":10},"end":{"line":125,"column":32}}},"8":{"name":"configLoaded","line":173,"loc":{"start":{"line":173,"column":6},"end":{"line":173,"column":42}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":29}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":42}},"4":{"start":{"line":8,"column":0},"end":{"line":8,"column":27}},"5":{"start":{"line":11,"column":0},"end":{"line":187,"column":2}},"6":{"start":{"line":29,"column":2},"end":{"line":185,"column":4}},"7":{"start":{"line":32,"column":4},"end":{"line":32,"column":20}},"8":{"start":{"line":35,"column":4},"end":{"line":184,"column":9}},"9":{"start":{"line":48,"column":10},"end":{"line":48,"column":58}},"10":{"start":{"line":56,"column":10},"end":{"line":75,"column":13}},"11":{"start":{"line":79,"column":10},"end":{"line":79,"column":30}},"12":{"start":{"line":93,"column":12},"end":{"line":93,"column":61}},"13":{"start":{"line":94,"column":12},"end":{"line":94,"column":56}},"14":{"start":{"line":95,"column":12},"end":{"line":95,"column":17}},"15":{"start":{"line":106,"column":10},"end":{"line":106,"column":74}},"16":{"start":{"line":107,"column":10},"end":{"line":117,"column":13}},"17":{"start":{"line":108,"column":12},"end":{"line":108,"column":36}},"18":{"start":{"line":108,"column":21},"end":{"line":108,"column":36}},"19":{"start":{"line":110,"column":12},"end":{"line":110,"column":41}},"20":{"start":{"line":111,"column":12},"end":{"line":111,"column":84}},"21":{"start":{"line":112,"column":12},"end":{"line":112,"column":84}},"22":{"start":{"line":113,"column":12},"end":{"line":113,"column":84}},"23":{"start":{"line":114,"column":12},"end":{"line":114,"column":51}},"24":{"start":{"line":116,"column":12},"end":{"line":116,"column":17}},"25":{"start":{"line":128,"column":12},"end":{"line":128,"column":49}},"26":{"start":{"line":132,"column":12},"end":{"line":132,"column":82}},"27":{"start":{"line":133,"column":12},"end":{"line":133,"column":64}},"28":{"start":{"line":136,"column":12},"end":{"line":136,"column":85}},"29":{"start":{"line":139,"column":12},"end":{"line":139,"column":81}},"30":{"start":{"line":149,"column":12},"end":{"line":149,"column":61}},"31":{"start":{"line":150,"column":12},"end":{"line":164,"column":13}},"32":{"start":{"line":157,"column":14},"end":{"line":157,"column":63}},"33":{"start":{"line":162,"column":14},"end":{"line":162,"column":52}},"34":{"start":{"line":163,"column":14},"end":{"line":163,"column":65}},"35":{"start":{"line":166,"column":12},"end":{"line":166,"column":35}},"36":{"start":{"line":174,"column":8},"end":{"line":177,"column":9}},"37":{"start":{"line":175,"column":10},"end":{"line":175,"column":72}},"38":{"start":{"line":176,"column":10},"end":{"line":176,"column":25}},"39":{"start":{"line":181,"column":8},"end":{"line":181,"column":45}},"40":{"start":{"line":183,"column":8},"end":{"line":183,"column":13}}},"branchMap":{"1":{"line":48,"type":"binary-expr","locations":[{"start":{"line":48,"column":38},"end":{"line":48,"column":50}},{"start":{"line":48,"column":54},"end":{"line":48,"column":56}}]},"2":{"line":61,"type":"cond-expr","locations":[{"start":{"line":61,"column":37},"end":{"line":63,"column":13}},{"start":{"line":63,"column":16},"end":{"line":67,"column":25}}]},"3":{"line":63,"type":"cond-expr","locations":[{"start":{"line":63,"column":34},"end":{"line":65,"column":13}},{"start":{"line":65,"column":16},"end":{"line":67,"column":25}}]},"4":{"line":65,"type":"cond-expr","locations":[{"start":{"line":65,"column":35},"end":{"line":67,"column":13}},{"start":{"line":67,"column":16},"end":{"line":67,"column":25}}]},"5":{"line":70,"type":"binary-expr","locations":[{"start":{"line":70,"column":18},"end":{"line":70,"column":32}},{"start":{"line":70,"column":36},"end":{"line":70,"column":45}}]},"6":{"line":73,"type":"cond-expr","locations":[{"start":{"line":73,"column":42},"end":{"line":73,"column":54}},{"start":{"line":73,"column":58},"end":{"line":73,"column":99}}]},"7":{"line":73,"type":"cond-expr","locations":[{"start":{"line":73,"column":74},"end":{"line":73,"column":87}},{"start":{"line":73,"column":90},"end":{"line":73,"column":99}}]},"8":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":12},"end":{"line":108,"column":12}},{"start":{"line":108,"column":12},"end":{"line":108,"column":12}}]},"9":{"line":132,"type":"binary-expr","locations":[{"start":{"line":132,"column":36},"end":{"line":132,"column":57}},{"start":{"line":132,"column":61},"end":{"line":132,"column":81}}]},"10":{"line":133,"type":"binary-expr","locations":[{"start":{"line":133,"column":29},"end":{"line":133,"column":43}},{"start":{"line":133,"column":47},"end":{"line":133,"column":63}}]},"11":{"line":136,"type":"binary-expr","locations":[{"start":{"line":136,"column":49},"end":{"line":136,"column":66}},{"start":{"line":136,"column":70},"end":{"line":136,"column":83}}]},"12":{"line":150,"type":"if","locations":[{"start":{"line":150,"column":12},"end":{"line":150,"column":12}},{"start":{"line":150,"column":12},"end":{"line":150,"column":12}}]},"13":{"line":174,"type":"if","locations":[{"start":{"line":174,"column":8},"end":{"line":174,"column":8}},{"start":{"line":174,"column":8},"end":{"line":174,"column":8}}]}},"code":["/**"," * Module dependencies."," */","","var _ = require('@sailshq/lodash');","var async = require('async');","var CaptainsLog = require('captains-log');","var path = require('path');","","","module.exports = function(sails) {","","  /**","   * Expose Configuration loader","   *","   * Load command-line overrides","   *","   * TODO: consider merging this into the `app` directory","   *","   * For reference, config priority is:","   * --> implicit defaults","   * --> environment variables","   * --> user config files","   * --> local config file","   * --> configOverride ( in call to sails.lift() )","   * --> --cmdline args","   */","","  return function loadConfig(cb) {","","    // Save reference to context for use in closures","    var self = this;","","    // Commence with loading/validating/defaulting all the rest of the config","    async.auto({","","        /**","         * Until this point this point, `sails.config` is composed only of","         * configuration overrides passed into `sails.lift(overrides)`","         * (or `sails.load(overrides)`-- same thing)","         *","         * This step clones this into an \"overrides\" object, negotiating cmdline","         * shortcuts into the properly namespced sails configuration options.","         */","        mapOverrides: function(cb) {","","          // Clone the `overrides` that were passed in.","          var overrides = _.cloneDeep(sails.config || {});","","          // TODO: bring the rconf stuff from bin/sails-lift in here","","          // Command-line arguments take highest precedence","          // overrides = _.merge(overrides, argv);","","          // Map Sails options from overrides","          overrides = _.merge(overrides, {","","            // `--verbose` command-line argument","            // `--silly` command-line argument","            // `--silent` command-line argument","            log: overrides.verbose ? {","              level: 'verbose'","            } : overrides.silly ? {","              level: 'silly'","            } : overrides.silent ? {","              level: 'silent'","            } : undefined,","","            // `--port=?` command-line argument","            port: overrides.port || undefined,","","            // `--prod` command-line argument","            environment: overrides.prod ? 'production' : (overrides.dev ? 'development' : undefined)","","          });","","","          // Pass on overrides object","          cb(null, overrides);","        },","","","","        /**","         * Immediately instantiate the default logger in case a log-worthy event occurs","         * Even though the app might actually use its own custom logger, we don't know","         * all of the user configurations yet.","         *","         * Makes sails.log accessible for the first time","         */","        logger: ['mapOverrides',","          function(cb, async_data) {","            var logConfigSoFar = async_data.mapOverrides.log;","            sails.log = new CaptainsLog(logConfigSoFar);","            cb();","          }","        ],","","","        /**","         * Expose version/dependency info for the currently-running","         * Sails on the `sails` object (from its `package.json`)","         */","        versionAndDependencyInfo: function(cb) {","","          var pathToThisVersionOfSails = path.join(__dirname, '../../..');","          sails.util.getPackage(pathToThisVersionOfSails, function(err, json) {","            if (err) return cb(err);","","            sails.version = json.version;","            sails.majorVersion = sails.version.split('.')[0].replace(/[^0-9]/g, '');","            sails.minorVersion = sails.version.split('.')[1].replace(/[^0-9]/g, '');","            sails.patchVersion = sails.version.split('.')[2].replace(/[^0-9]/g, '');","            sails.dependencies = json.dependencies;","","            cb();","          });","        },","","","        /**","         * Ensure that environment variables are applied to important configs","         */","        mixinDefaults: ['mapOverrides',","          function(cb, results) {","","            // Get overrides","            var overrides = results.mapOverrides; //_.cloneDeep(results.mapOverrides);","","            // Apply environment variables","            // (if the config values are not set in overrides)","            overrides.environment = overrides.environment || process.env.NODE_ENV;","            overrides.port = overrides.port || process.env.PORT;","","            // Generate implicit, built-in framework defaults for the app","            var implicitDefaults = self.defaults(overrides.appPath || process.cwd());","","            // Extend copy of implicit defaults with user config","            var mergedConfig = _.merge(_.cloneDeep(implicitDefaults), overrides);","","","            // Set the NODE_ENV environment variable so express and other modules","            // which expect NODE_ENV to be set mirror the configured Sails environment","            // setting (i.e. `sails.config.environment`).","            //","            // Note:","            // Setting an environment var explicitly to \"undefined\" sets it to the","            // *string* \"undefined\".  So we only bother setting it if it is truthy.","            sails.log.verbose('Setting Node environment...');","            if (mergedConfig.environment) {","              // If we end up setting NODE_ENV, we first save the original value of NODE_ENV","              // as `sails._originalNodeEnv`, so that we can potentially revert to it when","              // lowering the app.  This way if a Sails app is loaded subsequently in the same","              // process (e.g. tests), it does not end up using an unexpected environment due","              // to NODE_ENV being set from previous lifts/loads. See the implementation of","              // `.lower()` for further explanation.","              sails._originalNodeEnv = process.env['NODE_ENV'];","              // Note that we also set a flag indicating that we set the `NODE_ENV` at all.","              // (we could just compare the current NODE_ENV with _originalNodeEnv in `.lower()`,","              //  but it's not guaranteed to be accurate, since NODE_ENV could have been set again","              //  for some reason at runtime; e.g. multiple test apps lifting/lowering/popping/locking)","              sails._setNodeEnvAutomatically = true;","              process.env['NODE_ENV'] = mergedConfig.environment;","            }","","            cb(null, mergedConfig);","          }","        ]","","      },","","","      function configLoaded(err, results) {","        if (err) {","          sails.log.error('Error encountered loading config ::\\n', err);","          return cb(err);","        }","","        // Override the previous contents of sails.config with the new, validated","        // config w/ defaults and overrides mixed in the appropriate order.","        sails.config = results.mixinDefaults;","","        cb();","      });","  };","","};",""],"l":{"5":1,"6":1,"7":1,"8":1,"11":1,"29":2,"32":0,"35":0,"48":0,"56":0,"79":0,"93":0,"94":0,"95":0,"106":0,"107":0,"108":0,"110":0,"111":0,"112":0,"113":0,"114":0,"116":0,"128":0,"132":0,"133":0,"136":0,"139":0,"149":0,"150":0,"157":0,"162":0,"163":0,"166":0,"174":0,"175":0,"176":0,"181":0,"183":0}}}